<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta
      name="description"
      content="Bewerbung Document Generator - Erstellen Sie professionelle Bewerbungsunterlagen">
    <meta name="author" content="Mykola Vutov">
    <title>Bewerbung Document Generator</title>

    <!-- Configuration and Utilities -->
    <script src="config.js?v=20250914"></script>
    <script src="utils.js?v=20250914"></script>

    <!-- HTML to DOCX conversion library -->
    <script src="./html-docx.js?v=20250914"></script>

    <!-- Translation API - використовуємо MyMemory API напряму -->

    <script>
      // Check if html-docx-js loaded successfully
      if (typeof htmlDocx === "undefined") {
        console.error("html-docx-js failed to load from local file")
        window.htmlDocx = {
          asBlob: function () {
            throw new Error(
              "html-docx-js library not loaded. Please check if html-docx.js file exists."
            )
          }
        }
      } else {
        console.log("html-docx-js loaded successfully from local file")
      }

      // Alternative DOCX generation function using simple text conversion
      window.generateSimpleDOCX = function (htmlContent, filename) {
        try {
          // Create a simple text version
          const tempDiv = document.createElement("div")
          tempDiv.innerHTML = htmlContent
          const textContent = tempDiv.textContent || tempDiv.innerText || ""

          // Create a simple RTF-like content
          const rtfContent = `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}
{\\colortbl;\\red0\\green0\\blue0;}
\\f0\\fs24 ${textContent.replace(/\n/g, "\\par ").replace(/\s+/g, " ")}}`

          // Create blob and download
          const blob = new Blob([rtfContent], {type: "application/rtf"})
          const url = URL.createObjectURL(blob)
          const link = document.createElement("a")
          link.href = url
          link.download = filename.replace(".docx", ".rtf")
          document.body.appendChild(link)
          link.click()
          document.body.removeChild(link)
          URL.revokeObjectURL(url)

          return true
        } catch (error) {
          console.error("Error generating simple DOCX:", error)
          return false
        }
      }
    </script>

    <!-- Preload critical fonts -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap&v=20250914"
      as="style">
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap&v=20250914">

    <style>
      /* CSS Custom Properties for theming */
      :root {
        --color-primary: #1a5490;
        --color-secondary: #2c5aa0;
        --color-accent: #3b82f6;
        --color-success: #10b981;
        --color-info: #0ea5e9;
        --color-warning: #f59e0b;
        --color-error: #ef4444;
        --color-text: #1a1a1a;
        --color-text-light: #666666;
        --color-text-muted: #9ca3af;
        --color-border: #e5e7eb;
        --color-background: #ffffff;
        --color-surface: #f8fafc;
        --color-surface-light: #f1f5f9;
        --font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        --font-size-base: 16px;
        --font-size-sm: 14px;
        --font-size-lg: 18px;
        --line-height-base: 1.6;
        --spacing-xs: 0.25rem;
        --spacing-sm: 0.5rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-2xl: 3rem;
        --border-radius: 0.375rem;
        --border-radius-lg: 0.5rem;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      }

      [data-theme="dark"] {
        --color-background: #1a1a1a;
        --color-surface: #2d2d2d;
        --color-text: #ffffff;
        --color-text-light: #cccccc;
        --color-text-muted: #999999;
        --color-border: #404040;
        --color-hover: #3a3a3a;
      }

      /* Молочний бекграунд превью для темної теми */
      [data-theme="dark"] .preview-container {
        background: linear-gradient(135deg,
          #f8f6f0 0%,
          #faf8f3 25%,
          #fcfaf5 50%,
          #fefcf7 75%,
          #fffef9 100%
        );
        border: 1px solid rgba(248, 246, 240, 0.8);
        box-shadow:
          0 8px 25px rgba(0, 0, 0, 0.15),
          0 4px 12px rgba(0, 0, 0, 0.1),
          inset 0 1px 0 rgba(255, 255, 255, 0.9),
          inset 0 0 20px rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      [data-theme="dark"] .preview-section {
        background: linear-gradient(135deg, #2d2d2d 0%, #333333 100%);
        border: 1px solid #404040;
      }

      [data-theme="dark"] .preview-section h2 {
        color: #ffffff;
        border-bottom-color: #404040;
      }

      /* Паперовий ефект для документів в темній темі */
      [data-theme="dark"] .document-page {
        background: linear-gradient(135deg,
          #ffffff 0%,
          #fefefe 25%,
          #fdfdfd 50%,
          #fcfcfc 75%,
          #fbfbfb 100%
        );
        border: none;
        box-shadow:
          0 15px 35px rgba(0, 0, 0, 0.25),
          0 8px 20px rgba(0, 0, 0, 0.15),
          0 4px 8px rgba(0, 0, 0, 0.1),
          inset 0 1px 0 rgba(255, 255, 255, 1),
          inset 0 0 0 1px rgba(255, 255, 255, 0.8);
        border-radius: 12px;
      }

      /* Покращені візуальні індикатори для темної теми */
      [data-theme="dark"] .document-page:not(:last-child)::after {
        background: linear-gradient(90deg,
          transparent 0%,
          rgba(59, 130, 246, 0.2) 20%,
          rgba(59, 130, 246, 0.4) 40%,
          rgba(59, 130, 246, 0.6) 50%,
          rgba(59, 130, 246, 0.4) 60%,
          rgba(59, 130, 246, 0.2) 80%,
          transparent 100%
        );
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
        height: 8px;
      }

      [data-theme="dark"] .document-page::before {
        background: rgba(59, 130, 246, 0.1);
        border-color: rgba(59, 130, 246, 0.2);
        color: rgba(59, 130, 246, 0.8);
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
      }

      /* Theme transition */
      .theme-transitioning {
        transition: all 0.3s ease;
      }

      .theme-transitioning * {
        transition: all 0.3s ease;
      }

      /* Dark theme */
      @media (prefers-color-scheme: dark) {
        :root {
          --color-text: #f8fafc;
          --color-text-light: #94a3b8;
          --color-text-muted: #6b7280;
          --color-border: #374151;
          --color-background: #111827;
          --color-surface: #1f2937;
          --color-surface-light: #374151;
        }
      }

      /* Reset and base styles */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family);
        font-size: var(--font-size-base);
        line-height: var(--line-height-base);
        color: var(--color-text);
        background-color: var(--color-background);
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Typography */
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
        font-weight: 600;
        line-height: 1.25;
      }

      h1 {
        font-size: 2.5rem;
        color: var(--color-primary);
        margin-bottom: var(--spacing-lg);
      }

      h2 {
        font-size: 1.5rem;
        color: var(--color-secondary);
        margin-bottom: var(--spacing-md);
        border-bottom: 2px solid var(--color-border);
        padding-bottom: var(--spacing-sm);
      }

      p {
        margin: 0 0 var(--spacing-md) 0;
      }

      /* Layout */
      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: var(--spacing-md);
      }

      .header {
        position: sticky;
        top: 0;
        z-index: 1000;
        text-align: center;
        margin-bottom: var(--spacing-lg);
        padding: var(--spacing-md) 0;
        background: linear-gradient(135deg, var(--color-primary), #4a9eff);
        color: white;
        border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
        min-height: 70px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .header h1 {
        font-size: 1.8rem;
        margin-bottom: var(--spacing-xs);
        line-height: 1.2;
      }

      .header p {
        font-size: var(--font-size-sm);
        margin: 0;
        opacity: 0.9;
      }

      /* Mobile menu button */
      .mobile-menu-btn {
        display: none;
        position: absolute;
        top: var(--spacing-md);
        right: var(--spacing-md);
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 1000;
        transition: all 0.3s ease;
      }

      .mobile-menu-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .mobile-menu-btn.active {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Mobile menu overlay */
      .mobile-menu-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .mobile-menu-overlay.active {
        opacity: 1;
      }

      /* Mobile menu panel */
      .mobile-menu-panel {
        position: fixed;
        top: 0;
        right: -100%;
        width: 280px;
        height: 100%;
        background: var(--color-background);
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        transition: right 0.3s ease;
        overflow-y: auto;
        padding: var(--spacing-xl) var(--spacing-lg);
      }

      .mobile-menu-panel.active {
        right: 0;
      }

      .mobile-menu-panel h3 {
        color: var(--color-primary);
        margin-bottom: var(--spacing-lg);
        font-size: var(--font-size-lg);
      }

      .mobile-menu-section {
        margin-bottom: var(--spacing-lg);
      }

      .mobile-menu-section h4 {
        color: var(--color-text);
        margin-bottom: var(--spacing-sm);
        font-size: var(--font-size-base);
        font-weight: 600;
      }

      .mobile-menu-buttons {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .mobile-menu-buttons .btn {
        justify-content: flex-start;
        text-align: left;
        padding: var(--spacing-sm) var(--spacing-md);
      }

      .control-panel {
        background: var(--color-surface);
        padding: var(--spacing-lg);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-sm);
        margin-bottom: var(--spacing-xl);
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-2xl);
        margin-bottom: var(--spacing-2xl);
        align-items: stretch;
        min-height: 100vh;
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }
      }

      /* Form styles */
      .form-section {
        background: var(--color-surface);
        padding: var(--spacing-xl);
        border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) var(--border-radius-lg);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border: 1px solid var(--color-border);
        transition: all 0.3s ease;
        margin-bottom: var(--spacing-lg);
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .form-section:hover {
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        transform: translateY(-1px);
      }

      .form-group {
        margin-bottom: var(--spacing-lg);
      }

      /* Section headers */
      .form-section h2 {
        color: var(--primary-color);
        font-size: var(--font-size-xl);
        font-weight: 600;
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-sm);
        border-bottom: 2px solid var(--color-border);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .form-section h2::before {
        content: "";
        width: 4px;
        height: 24px;
        background: linear-gradient(180deg, var(--primary-color), #4a9eff);
        border-radius: 2px;
      }

      .form-group label {
        display: block;
        font-weight: 500;
        color: var(--color-text);
        margin-bottom: var(--spacing-sm);
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: var(--spacing-sm) var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius);
        font-family: var(--font-family);
        font-size: var(--font-size-base);
        background: var(--color-background);
        color: var(--color-text);
        transition:
          border-color 0.2s ease,
          box-shadow 0.2s ease;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgb(26 84 144 / 0.1);
      }

      .form-group textarea {
        min-height: 120px;
        resize: vertical;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-md);
      }

      @media (max-width: 640px) {
        .form-row {
          grid-template-columns: 1fr;
          gap: var(--spacing-sm);
        }
      }

      @media (max-width: 480px) {
        .form-row {
          grid-template-columns: 1fr;
          gap: var(--spacing-xs);
        }

        .form-group label {
          font-size: var(--font-size-sm);
          margin-bottom: var(--spacing-xs);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          font-size: var(--font-size-sm);
          padding: var(--spacing-sm);
        }
      }

      /* Mobile-specific form improvements */
      @media (max-width: 640px) {
        .form-group input,
        .form-group select,
        .form-group textarea {
          padding: var(--spacing-md);
          font-size: 16px; /* Prevents zoom on iOS */
          border-radius: var(--border-radius-lg);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
          border-color: var(--color-primary);
          box-shadow: 0 0 0 3px rgba(26, 84, 144, 0.1);
          outline: none;
        }

        .form-group textarea {
          min-height: 100px;
        }
      }

      @media (max-width: 480px) {
        .form-group input,
        .form-group select,
        .form-group textarea {
          padding: var(--spacing-sm) var(--spacing-md);
          font-size: 16px;
          border-radius: var(--border-radius);
        }

        .form-group textarea {
          min-height: 80px;
        }
      }

      /* Button styles */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-sm) var(--spacing-lg);
        border: 2px solid transparent;
        border-radius: 12px;
        font-family: var(--font-family);
        font-size: var(--font-size-base);
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
        gap: var(--spacing-sm);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s ease;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary {
        background: var(--color-primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--color-secondary);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-secondary {
        background: var(--color-surface-light);
        color: var(--color-text);
        border: 1px solid var(--color-border);
      }

      .btn-secondary:hover {
        background: var(--color-border);
      }

      .btn-success {
        background: var(--color-success);
        color: white;
      }

      .btn-success:hover {
        background: #059669;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-info {
        background: var(--color-info);
        color: white;
      }

      .btn-info:hover {
        background: #0284c7;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-group {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-xl);
        justify-content: center;
        flex-wrap: wrap;
      }

      .form-actions {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
        justify-content: center;
        flex-wrap: wrap;
        padding: var(--spacing-lg);
        background: var(--color-surface);
        border-radius: var(--border-radius);
        border: 1px solid var(--color-border);
      }

      @media (max-width: 640px) {
        .btn-group {
          flex-direction: column;
          gap: var(--spacing-sm);
        }

        .btn-group .btn {
          width: 100%;
        }
      }

      @media (max-width: 480px) {
        .btn-group {
          flex-direction: column;
          gap: var(--spacing-xs);
        }

        .btn-group .btn {
          width: 100%;
          padding: var(--spacing-sm) var(--spacing-md);
          font-size: var(--font-size-sm);
        }
      }

      /* Preview section */
      .preview-section {
        background: var(--color-surface);
        padding: var(--spacing-xl);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-sm);
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .preview-tabs {
        display: flex;
        border-bottom: 1px solid var(--color-border);
        margin-bottom: var(--spacing-lg);
      }

      .preview-tab {
        padding: var(--spacing-sm) var(--spacing-lg);
        border: none;
        background: none;
        color: var(--color-text-light);
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.2s ease;
      }

      .preview-tab.active {
        color: var(--color-primary);
        border-bottom-color: var(--color-primary);
      }

      .preview-content {
        /* A4 пропорції: 210x297mm або 1:1.414 */
        aspect-ratio: 210 / 297;
        max-width: 100%;
        width: 100%;
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius);
        padding: var(--spacing-lg);
        background: white;
        overflow-y: auto;
        text-align: left;
        position: relative;
        -webkit-overflow-scrolling: touch;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin: 0 auto;
        display: flex;
        flex-direction: column;
      }

      /* Mobile preview improvements */
      @media (max-width: 640px) {
        .preview-content {
          aspect-ratio: 210 / 297;
          padding: var(--spacing-md);
          font-size: var(--font-size-sm);
          line-height: 1.5;
        }

        .preview-content h1 {
          font-size: 1.5rem;
          margin-bottom: var(--spacing-md);
        }

        .preview-content h2 {
          font-size: 1.25rem;
          margin-bottom: var(--spacing-sm);
        }

        .preview-content h3 {
          font-size: 1.1rem;
          margin-bottom: var(--spacing-sm);
        }

        .preview-content p {
          margin-bottom: var(--spacing-sm);
        }

        .preview-content ul,
        .preview-content ol {
          margin-bottom: var(--spacing-sm);
          padding-left: var(--spacing-lg);
        }

        .preview-content li {
          margin-bottom: var(--spacing-xs);
        }
      }

      @media (max-width: 480px) {
        .preview-content {
          aspect-ratio: 210 / 297;
          padding: var(--spacing-sm);
          font-size: var(--font-size-sm);
        }

        .preview-content h1 {
          font-size: 1.25rem;
          margin-bottom: var(--spacing-sm);
        }

        .preview-content h2 {
          font-size: 1.1rem;
          margin-bottom: var(--spacing-sm);
        }

        .preview-content h3 {
          font-size: 1rem;
          margin-bottom: var(--spacing-sm);
        }
      }

      .preview-content h3 {
        margin-bottom: var(--spacing-lg);
        color: var(--color-primary);
        text-align: center;
        font-size: 1.2rem;
      }

      .preview-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        min-height: 400px;
        color: var(--color-text-muted);
        font-size: var(--font-size-lg);
        text-align: center;
        flex-direction: column;
        gap: var(--spacing-md);
      }

      .preview-placeholder .icon {
        font-size: 3rem;
        opacity: 0.5;
      }

      .preview-icon {
        font-size: 4rem;
        opacity: 0.7;
        margin-bottom: var(--spacing-md);
        color: var(--color-primary);
      }

      .preview-placeholder h3 {
        color: var(--color-primary);
        margin-bottom: var(--spacing-md);
        font-size: 1.5rem;
        font-weight: 600;
      }

      .preview-actions {
        margin-top: var(--spacing-lg);
        display: flex;
        justify-content: center;
        gap: var(--spacing-md);
      }

      .preview-placeholder {
        text-align: center;
        padding: var(--spacing-2xl);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 400px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        border-radius: var(--border-radius-lg);
        border: 2px dashed var(--color-border);
      }

      /* Photo Upload Styles */
      .photo-upload-section {
        margin-bottom: var(--spacing-xl);
        padding: var(--spacing-lg);
        background: var(--color-surface-light);
        border-radius: var(--border-radius);
        border: 2px dashed var(--color-border);
        transition: all 0.3s ease;
      }

      .photo-upload-section:hover {
        border-color: var(--color-primary);
        background: var(--color-hover);
      }

      .photo-upload-container {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
        align-items: center;
      }

      .photo-upload-area {
        cursor: pointer;
        border: 2px dashed var(--color-primary);
        border-radius: var(--border-radius);
        padding: var(--spacing-lg);
        text-align: center;
        transition: all 0.3s ease;
        background: var(--color-background);
        min-width: 200px;
        min-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .photo-upload-area:hover {
        border-color: var(--color-secondary);
        background: var(--color-hover);
        transform: translateY(-2px);
      }

      .photo-preview {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .photo-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
        color: var(--color-text-muted);
      }

      .photo-icon {
        font-size: 2rem;
        opacity: 0.7;
      }

      .photo-preview img {
        max-width: 100%;
        max-height: 120px;
        border-radius: var(--border-radius);
        object-fit: cover;
        box-shadow: var(--shadow-sm);
      }

      .photo-remove-btn {
        margin-top: var(--spacing-sm);
        font-size: var(--font-size-sm);
        padding: var(--spacing-sm) var(--spacing-md);
      }

      /* Document preview styles */
      .preview-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: center;
        padding: 20px;
        overflow-y: visible;
        max-height: none;
        width: 100%;
      }

      .document-page {
        width: 210mm;
        min-height: 297mm;
        max-height: 297mm;
        background: white;
        padding: 20mm;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        position: relative;
        margin-bottom: 20px;
        page-break-after: always;
        overflow: hidden;
        display: block;
      }

      /* Візуальне розділення сторінок по вертикалі */
      .document-page::before {
        content: '';
        position: absolute;
        left: -10px;
        top: 10%;
        bottom: 10%;
        width: 2px;
        background: linear-gradient(180deg,
          transparent 0%,
          rgba(26, 84, 144, 0.1) 10%,
          rgba(26, 84, 144, 0.3) 50%,
          rgba(26, 84, 144, 0.1) 90%,
          transparent 100%
        );
        border-radius: 1px;
      }

      .document-page::after {
        content: '';
        position: absolute;
        right: -10px;
        top: 10%;
        bottom: 10%;
        width: 2px;
        background: linear-gradient(180deg,
          transparent 0%,
          rgba(26, 84, 144, 0.1) 10%,
          rgba(26, 84, 144, 0.3) 50%,
          rgba(26, 84, 144, 0.1) 90%,
          transparent 100%
        );
        border-radius: 1px;
      }

      /* Додаткові візуальні індикатори сторінок */
      .document-page:not(:first-child)::before {
        content: '';
        position: absolute;
        top: -10px;
        left: 50%;
        width: 40px;
        height: 2px;
        transform: translateX(-50%);
        background: linear-gradient(90deg,
          transparent 0%,
          rgba(26, 84, 144, 0.4) 50%,
          transparent 100%
        );
        border-radius: 1px;
      }

      .document-page:not(:last-child)::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        width: 40px;
        height: 2px;
        transform: translateX(-50%);
        background: linear-gradient(90deg,
          transparent 0%,
          rgba(26, 84, 144, 0.4) 50%,
          transparent 100%
        );
        border-radius: 1px;
      }

      /* Автоматичне розділення на сторінки */
      .auto-paginate {
        column-width: 170mm;
        column-gap: 0;
        column-fill: auto;
        height: 257mm; /* 297mm - 40mm padding */
        overflow: visible;
      }

      .auto-paginate > * {
        break-inside: avoid;
        margin-bottom: 5mm;
      }

      .auto-paginate h1,
      .auto-paginate h2 {
        break-after: avoid;
      }

      .document-page:last-child {
        margin-bottom: 40px;
      }

      /* Візуальний розрив між сторінками A4 */
      .document-page {
        margin-bottom: 35px;
        border-radius: 12px;
        position: relative;
      }

      .document-page:not(:last-child)::after {
        content: '';
        position: absolute;
        bottom: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 6px;
        background: linear-gradient(90deg,
          transparent 0%,
          rgba(26, 84, 144, 0.15) 20%,
          rgba(26, 84, 144, 0.3) 40%,
          rgba(26, 84, 144, 0.4) 50%,
          rgba(26, 84, 144, 0.3) 60%,
          rgba(26, 84, 144, 0.15) 80%,
          transparent 100%
        );
        border-radius: 3px;
        box-shadow: 0 2px 4px rgba(26, 84, 144, 0.1);
      }

      /* Номери сторінок */
      .document-page::before {
        counter-increment: page-counter;
        content: "Сторінка " counter(page-counter);
        position: absolute;
        bottom: -30px;
        right: 15mm;
        font-size: 11px;
        color: rgba(26, 84, 144, 0.6);
        font-weight: 500;
        background: rgba(255, 255, 255, 0.9);
        padding: 2px 8px;
        border-radius: 12px;
        border: 1px solid rgba(26, 84, 144, 0.1);
      }

      .preview-container {
        counter-reset: page-counter;
      }

      .document-preview {
        font-family: "Times New Roman", serif;
        font-size: 11pt;
        line-height: 1.5;
        color: #000;
        background: transparent;
        padding: 0;
        border: none;
        border-radius: 0;
        box-shadow: none;
        max-width: none;
        margin: 0;
        height: fit-content;
        position: relative;
      }

      /* Пагінація через CSS */
      @media screen {
        .document-preview.paginated {
          column-count: 1;
          column-fill: auto;
          height: 257mm;
          overflow: visible;
        }

        .document-preview.paginated > div,
        .document-preview.paginated > section,
        .document-preview.paginated > article {
          break-inside: avoid;
          page-break-inside: avoid;
        }
      }

      /* Стандартні відступи для друку */
      @media print {
        .document-page {
          padding: 20mm 15mm;
          margin: 0;
          border: none;
          box-shadow: none;
          border-radius: 0;
          page-break-after: always;
        }
        .preview-container {
          padding: 0;
          gap: 0;
        }
      }

      /* Print styles for document preview */
      @media print {
        .document-preview {
          margin: 0;
          padding: 20mm;
          border: none;
          box-shadow: none;
          border-radius: 0;
          max-width: none;
          min-height: auto;
        }

        .document-preview .sender-section {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 8mm;
          padding-bottom: 3mm;
        }

        .document-preview .sender-info {
          font-size: 11pt;
          color: #333;
          flex: 1;
        }

        .document-preview .date {
          text-align: right;
          font-size: 11pt;
          color: #333;
          margin-left: 20mm;
          white-space: nowrap;
          flex-shrink: 0;
        }
      }

      .document-preview .sender-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8mm;
        padding-bottom: 3mm;
      }

      .document-preview .sender-info {
        font-size: 11pt;
        color: #333;
        font-weight: normal;
        text-align: left;
        flex: 1;
      }

      .document-preview .date {
        text-align: right;
        font-size: 11pt;
        color: #333;
        margin-left: 20mm;
        white-space: nowrap;
      }

      .document-preview .recipient {
        margin-bottom: 15mm;
        font-size: 11pt;
        line-height: 1.4;
        text-align: left;
        margin-top: 8mm;
      }

      .document-preview .subject {
        font-weight: bold;
        margin: 15mm 0;
        font-size: 12pt;
        line-height: 1.4;
        color: #000;
      }

      .document-preview .content p {
        margin-bottom: 6mm;
        text-align: justify;
        font-size: 12pt;
        line-height: 1.6;
        color: #000;
      }

      .document-preview .signature {
        margin-top: 25mm;
        font-size: 12pt;
      }

      .document-preview .signature p {
        margin-bottom: 3mm;
      }

      .document-preview h1 {
        color: #1a5490;
        font-size: 22pt;
        border-bottom: 2px solid #1a5490;
        padding-bottom: 4mm;
        margin-bottom: 8mm;
        font-weight: bold;
        text-align: center;
      }

      .document-preview h2 {
        color: #2c5aa0;
        font-size: 14pt;
        margin-top: 6mm;
        margin-bottom: 3mm;
        border-bottom: 1px solid #2c5aa0;
        padding-bottom: 1mm;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5pt;
      }

      .document-preview .grid {
        display: grid;
        grid-template-columns: 40mm 1fr;
        gap: 3mm;
        margin: 3mm 0;
        font-size: 11pt;
        line-height: 1.4;
      }

      .document-preview .label {
        font-weight: bold;
        color: #333;
        font-size: 11pt;
      }

      .document-preview ul {
        margin: 3mm 0;
        padding-left: 5mm;
        font-size: 11pt;
        line-height: 1.4;
      }

      .document-preview li {
        margin: 1.5mm 0;
        color: #000;
      }

      .document-preview .experience-item {
        margin-bottom: 6mm;
        padding: 4mm;
        background: #f9f9f9;
        border-left: 3px solid #2c5aa0;
        font-size: 11pt;
        line-height: 1.4;
      }

      .document-preview .experience-item strong {
        color: #1a5490;
        font-size: 12pt;
      }

      .document-preview .experience-item em {
        color: #666;
        font-style: italic;
        font-size: 10pt;
      }

      /* ===== СТИЛІ РЕЗЮМЕ 2025 ===== */

      /* 1. Сучасний професійний */
      .resume-style-modern-professional .document-page {
        background: linear-gradient(135deg, #f8f9fc 0%, #ffffff 100%);
        border: none;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        padding: 20mm 15mm;
      }

      .resume-style-modern-professional .document-preview {
        background: transparent;
      }

      .resume-style-modern-professional .document-preview h1 {
        color: #2c3e50;
        font-family: 'Arial', sans-serif;
        font-weight: 700;
        border-bottom: 3px solid #3498db;
        padding-bottom: 15px;
      }

      .resume-style-modern-professional .document-preview h2 {
        color: #34495e;
        background: linear-gradient(90deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 8px 15px;
        margin-left: -15px;
        margin-right: -15px;
        margin-top: 25px;
      }

      /* 2. Мінімалістичний */
      .resume-style-minimalist .document-page {
        background: #ffffff;
        border: 1px solid #e1e8ed;
        padding: 25mm 20mm;
      }

      .resume-style-minimalist .document-preview {
        background: transparent;
        font-family: 'Helvetica Neue', Arial, sans-serif;
      }

      .resume-style-minimalist .document-preview h1 {
        color: #1a1a1a;
        font-weight: 300;
        font-size: 32px;
        letter-spacing: 2px;
        border-bottom: 1px solid #e1e8ed;
        text-align: left;
      }

      .resume-style-minimalist .document-preview h2 {
        color: #666;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: none;
        margin-top: 30px;
        font-weight: 400;
      }

      /* 3. Креативний синій */
      .resume-style-creative-blue .document-page {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20mm 15mm;
      }

      .resume-style-creative-blue .document-preview {
        background: transparent;
        color: white;
      }

      .resume-style-creative-blue .document-preview h1 {
        color: white;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        border-bottom: 2px solid rgba(255,255,255,0.3);
      }

      .resume-style-creative-blue .document-preview h2 {
        color: #f1c40f;
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 10px 20px;
        display: inline-block;
      }

      /* 4. Елегантний серіф */
      .resume-style-elegant-serif .document-page {
        background: #fefefe;
        border: 2px solid #8b4513;
        padding: 25mm 20mm;
      }

      .resume-style-elegant-serif .document-preview {
        background: transparent;
        font-family: 'Georgia', 'Times New Roman', serif;
      }

      .resume-style-elegant-serif .document-preview h1 {
        color: #8b4513;
        font-family: 'Georgia', serif;
        font-style: italic;
        text-align: center;
        border-bottom: double 3px #8b4513;
      }

      .resume-style-elegant-serif .document-preview h2 {
        color: #654321;
        font-style: italic;
        border-bottom: 1px solid #d2b48c;
        text-align: center;
      }

      /* 5. Технологічний */
      .resume-style-tech-modern .document-page {
        background: #0d1117;
        border: 1px solid #30363d;
        padding: 20mm 15mm;
      }

      .resume-style-tech-modern .document-preview {
        background: transparent;
        color: #c9d1d9;
        font-family: 'Consolas', 'Monaco', monospace;
      }

      .resume-style-tech-modern .document-preview h1 {
        color: #58a6ff;
        font-family: 'Consolas', monospace;
        border-bottom: 2px solid #21262d;
        text-shadow: 0 0 10px rgba(88, 166, 255, 0.3);
      }

      .resume-style-tech-modern .document-preview h2 {
        color: #7c3aed;
        background: #161b22;
        border: 1px solid #30363d;
        padding: 8px 12px;
        font-family: monospace;
      }

      /* 6. Класичний офіційний */
      .resume-style-classic-formal .document-page {
        background: white;
        border: 2px solid #000;
        padding: 25mm 20mm;
      }

      .resume-style-classic-formal .document-preview {
        background: transparent;
        font-family: 'Times New Roman', serif;
      }

      .resume-style-classic-formal .document-preview h1 {
        color: #000;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        border-bottom: 2px solid #000;
        margin-bottom: 20px;
      }

      .resume-style-classic-formal .document-preview h2 {
        color: #000;
        font-size: 16px;
        font-weight: bold;
        text-transform: uppercase;
        border-bottom: 1px solid #000;
        margin-top: 25px;
      }

      /* 7. Художній градієнт */
      .resume-style-artistic-gradient .document-page {
        background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
        border: none;
        border-radius: 20px;
        padding: 20mm 15mm;
      }

      .resume-style-artistic-gradient .document-preview {
        background: transparent;
      }

      .resume-style-artistic-gradient .document-preview h1 {
        background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
        text-align: center;
      }

      .resume-style-artistic-gradient .document-preview h2 {
        background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        border: none;
        text-align: center;
        font-weight: 600;
      }

      /* 8. Корпоративний чистий */
      .resume-style-corporate-clean .document-page {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 20mm 15mm;
      }

      .resume-style-corporate-clean .document-preview {
        background: transparent;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      .resume-style-corporate-clean .document-preview h1 {
        color: #495057;
        background: #007bff;
        color: white;
        text-align: center;
        padding: 20px;
        margin: -30px -30px 30px -30px;
        font-weight: 500;
      }

      .resume-style-corporate-clean .document-preview h2 {
        color: #007bff;
        border-left: 4px solid #007bff;
        padding-left: 15px;
        border-bottom: none;
        background: #e7f3ff;
        padding: 10px 15px;
        margin-left: -15px;
        margin-right: -15px;
      }

      /* 9. Стартап сміливий */
      .resume-style-startup-bold .document-page {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transform: rotate(-1deg);
        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        padding: 20mm 15mm;
      }

      .resume-style-startup-bold .document-preview {
        background: transparent;
        color: white;
      }

      .resume-style-startup-bold .document-preview h1 {
        color: #ffd700;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 3px;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        border: none;
        text-align: center;
        animation: pulse 2s infinite;
      }

      .resume-style-startup-bold .document-preview h2 {
        color: #ff6b6b;
        background: rgba(0,0,0,0.2);
        border-radius: 25px;
        padding: 12px 20px;
        text-transform: uppercase;
        font-weight: 700;
        text-align: center;
        border: 2px solid #ff6b6b;
      }

      /* 10. Академічний традиційний */
      .resume-style-academic-traditional .document-page {
        background: #fffef7;
        border: 3px double #8b4513;
        padding: 25mm 20mm;
      }

      .resume-style-academic-traditional .document-preview {
        background: transparent;
        font-family: 'Times New Roman', serif;
        line-height: 1.8;
      }

      .resume-style-academic-traditional .document-preview h1 {
        color: #2c1810;
        font-family: 'Times New Roman', serif;
        text-align: center;
        font-size: 28px;
        margin-bottom: 10px;
        border: none;
      }

      .resume-style-academic-traditional .document-preview h2 {
        color: #8b4513;
        font-size: 16px;
        text-align: center;
        font-variant: small-caps;
        border-top: 1px solid #8b4513;
        border-bottom: 1px solid #8b4513;
        padding: 8px 0;
        margin: 25px 0 15px 0;
        letter-spacing: 2px;
      }

      /* Дві колонки layout */
      .layout-two-column .document-preview {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 15mm;
        align-items: start;
        height: 100%;
      }

      .layout-two-column .document-preview .left-column {
        background: rgba(0,0,0,0.05);
        padding: 10mm;
        border-radius: 5mm;
        height: fit-content;
      }

      .layout-two-column .document-preview .right-column {
        padding: 0;
        height: 100%;
        overflow: hidden;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.8; }
        100% { opacity: 1; }
      }

      /* Status messages */
      .status-message {
        padding: var(--spacing-md);
        border-radius: var(--border-radius);
        margin-bottom: var(--spacing-lg);
        font-weight: 500;
        cursor: pointer;
        transition: opacity 0.3s ease;
      }

      .status-message:hover {
        opacity: 0.8;
      }

      .status-success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
      }

      .status-error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
      }

      .status-info {
        background: #dbeafe;
        color: #1e40af;
        border: 1px solid #93c5fd;
      }

      /* Loading spinner */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid var(--color-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Header Controls */
      .header-controls {
        position: absolute;
        top: var(--spacing-lg);
        right: var(--spacing-lg);
        z-index: 10;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
        align-items: flex-end;
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        backdrop-filter: blur(10px);
      }

      .header-controls .control-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-xs);
      }

      /* Header Data Buttons */
      .header-data-buttons {
        display: flex;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-md);
        justify-content: center;
        flex-wrap: wrap;
        align-items: center;
        width: 100%;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Print-style buttons */
      .btn-print {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        color: #495057;
        border: 2px solid #e9ecef;
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-size-base);
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
        min-width: 90px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
      }

      .btn-print::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.5s ease;
      }

      .btn-print:hover::before {
        left: 100%;
      }

      .btn-print:hover {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
        border-color: #007bff;
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4);
        border-radius: 15px;
      }

      .btn-print:active {
        transform: translateY(-1px) scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        border-radius: 12px;
      }

      .header-data-buttons .btn-sm {
        margin: 0;
      }

      /* Dark theme adaptation */
      [data-theme="dark"] .button-group {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      [data-theme="dark"] .btn-print {
        background: linear-gradient(135deg, #343a40 0%, #495057 100%);
        color: #e9ecef;
        border: 2px solid #6c757d;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      [data-theme="dark"] .btn-print:hover {
        background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
        color: white;
        border-color: #007bff;
        box-shadow: 0 8px 20px rgba(0, 86, 179, 0.5);
        transform: translateY(-3px) scale(1.05);
        border-radius: 15px;
      }

      /* Mobile styles for header buttons */
      @media (max-width: 768px) {
        .header-data-buttons {
          gap: var(--spacing-sm);
          margin-top: var(--spacing-md);
          padding: 0 var(--spacing-md);
          width: 100%;
          max-width: 100%;
        }

        .header-data-buttons .btn-print {
          min-width: 70px;
          padding: var(--spacing-sm) var(--spacing-md);
          font-size: 0.9rem;
          border-radius: 10px;
          flex: 1;
          max-width: calc(25% - var(--spacing-sm));
        }

        .header-data-buttons .btn-print span {
          display: none;
        }
      }

      @media (max-width: 640px) {
        .header-data-buttons {
          gap: var(--spacing-xs);
          margin-top: var(--spacing-sm);
          padding: 0 var(--spacing-sm);
          flex-wrap: wrap;
          justify-content: center;
          width: 100%;
        }

        .header-data-buttons .btn-print {
          min-width: 60px;
          padding: var(--spacing-sm);
          font-size: 0.85rem;
          border-radius: 8px;
          flex: 1;
          max-width: calc(25% - var(--spacing-xs));
        }

        .header-data-buttons .btn-print span {
          display: none;
        }
      }

      @media (max-width: 480px) {
        .header-data-buttons {
          gap: 4px;
          margin-top: var(--spacing-sm);
          padding: 0 8px;
          flex-wrap: wrap;
          justify-content: center;
          width: 100%;
        }

        .header-data-buttons .btn-print {
          min-width: 50px;
          padding: var(--spacing-xs) var(--spacing-sm);
          font-size: 0.8rem;
          border-radius: 6px;
          flex: 1;
          max-width: calc(25% - 4px);
        }

        .header-data-buttons .btn-print span {
          display: none;
        }
      }

      @media (max-width: 360px) {
        .header-data-buttons {
          gap: 2px;
          margin-top: var(--spacing-xs);
          padding: 0 4px;
          flex-wrap: wrap;
          justify-content: center;
          width: 100%;
        }

        .header-data-buttons .btn-print {
          min-width: 45px;
          padding: 6px 8px;
          font-size: 0.75rem;
          border-radius: 5px;
          flex: 1;
          max-width: calc(25% - 2px);
        }

        .header-data-buttons .btn-print span {
          display: none;
        }
      }

      .language-flags {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
        align-items: center;
      }

      .language-flag {
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: var(--border-radius);
        padding: var(--spacing-xs) var(--spacing-sm);
        color: white;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        cursor: pointer;
        min-width: 40px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .language-flag:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-1px);
      }

      .language-flag.active {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.6);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      /* Theme Toggle */
      .theme-toggle,
      .translate-toggle {
        background: var(--primary-color);
        color: white;
        border: 2px solid var(--primary-color);
        border-radius: 50%;
        width: 44px;
        height: 44px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .translate-toggle {
        background: linear-gradient(135deg, #28a745, #20c997);
        border-color: #28a745;
        box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);
      }

      .translate-toggle.active {
        background: linear-gradient(135deg, #20c997, #17a2b8);
        border-color: #17a2b8;
        box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
        transform: scale(1.05);
      }

      .theme-toggle:hover,
      .translate-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        background: var(--color-hover);
        border-color: var(--color-hover);
      }

      .translate-toggle:hover {
        background: linear-gradient(135deg, #218838, #1e7e34);
        border-color: #1e7e34;
        transform: scale(1.1);
        box-shadow: 0 5px 20px rgba(33, 136, 56, 0.4);
      }

      .translate-toggle.active:hover {
        background: linear-gradient(135deg, #17a2b8, #138496);
        border-color: #138496;
      }

      .theme-toggle:active {
        transform: scale(0.95);
      }

      .theme-icon {
        transition: all 0.3s ease;
        font-size: 18px;
        display: block;
      }

      .theme-toggle:hover .theme-icon {
        transform: rotate(180deg);
      }

      /* Form Tabs */
      .form-tabs {
        display: flex;
        text-align: center;
        border-bottom: 2px solid var(--color-border);
        margin-bottom: var(--spacing-lg);
        background: var(--color-surface);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        overflow: hidden;
      }

      .form-tab-button {
        flex: 1;
        padding: var(--spacing-md) var(--spacing-lg);
        border: none;
        background: transparent;
        color: var(--color-text-light);
        font-size: var(--font-size-lg);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
      }

      .form-tab-button:hover {
        background: var(--color-hover);
        color: var(--color-text);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .form-tab-button.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
        background: var(--color-background);
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.15);
        font-weight: 600;
      }

      .form-tab-button.active::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--primary-color), #4a9eff);
      }

      /* Header positioning for language selector */
      .header {
        /* position: relative; */
        text-align: center;
        margin-bottom: var(--spacing-2xl);
        padding: var(--spacing-xl) 0;
        background: var(--color-surface);
        border-radius: var(--border-radius-lg);
      } 

      /* Footer */
      .footer {
        text-align: center;
        padding: var(--spacing-xl) 0;
        color: var(--color-text-light);
        border-top: 1px solid var(--color-border);
        margin-top: var(--spacing-2xl);
      }

      /* Resume Style Selector */
      .resume-style-selector {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-lg);
        margin: var(--spacing-lg) 0;
        background: var(--color-surface);
        padding: var(--spacing-md);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-sm);
        flex-wrap: wrap;
      }

      .resume-style-selector label {
        color: var(--color-text);
        font-weight: 500;
        white-space: nowrap;
      }

      .style-dropdown {
        background: var(--color-background);
        border: 2px solid var(--color-border);
        border-radius: var(--border-radius);
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-size);
        color: var(--color-text);
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 200px;
      }

      .style-dropdown:hover {
        border-color: var(--primary-color);
      }

      .style-dropdown:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(26, 84, 144, 0.1);
      }

      .layout-toggle {
        display: flex;
        gap: var(--spacing-md);
        align-items: center;
      }

      .layout-toggle label {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        cursor: pointer;
        font-weight: 400;
      }

      .layout-toggle input[type="radio"] {
        margin: 0;
        cursor: pointer;
      }

      /* Responsive design */

      /* Large tablets and small desktops */
      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
          gap: var(--spacing-lg);
        }

        .form-section,
        .preview-section {
          padding: var(--spacing-lg);
        }
      }

      /* Tablets */
      @media (max-width: 768px) {
        .container {
          padding: var(--spacing-md);
        }

        h1 {
          font-size: 2rem;
        }

        .form-section,
        .preview-section {
          padding: var(--spacing-lg);
        }

        .header {
          flex-direction: column;
          gap: var(--spacing-md);
          text-align: center;
        }

        .header-controls {
          justify-content: center;
          flex-wrap: wrap;
        }

        .language-flags {
          margin-bottom: var(--spacing-sm);
        }

        .preview-tabs {
          flex-wrap: wrap;
        }

        .preview-tab {
          flex: 1;
          min-width: 120px;
        }
      }

      /* Mobile landscape */
      @media (max-width: 640px) {
        .container {
          padding: var(--spacing-sm);
        }

        .form-section,
        .preview-section {
          padding: var(--spacing-md);
          margin-bottom: var(--spacing-md);
        }

        .form-group {
          margin-bottom: var(--spacing-md);
        }

        .btn {
          padding: var(--spacing-sm) var(--spacing-md);
          font-size: var(--font-size-sm);
        }

        .preview-content {
          min-height: 400px;
          padding: var(--spacing-md);
        }
      }

      /* Mobile portrait */
      @media (max-width: 480px) {
        .container {
          padding: var(--spacing-xs);
        }

        h1 {
          font-size: 1.5rem;
          margin-bottom: var(--spacing-md);
        }

        .form-section,
        .preview-section {
          padding: var(--spacing-sm);
          border-radius: var(--border-radius);
        }

        .form-section h2 {
          font-size: var(--font-size-lg);
          margin-bottom: var(--spacing-md);
        }

        .btn-group {
          flex-direction: column;
          gap: var(--spacing-sm);
        }

        .btn {
          width: 100%;
          justify-content: center;
        }

        .preview-tabs {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .preview-tab {
          white-space: nowrap;
          min-width: 100px;
        }

        .preview-content {
          min-height: 350px;
          padding: var(--spacing-sm);
          font-size: var(--font-size-sm);
        }

        .language-flags {
          gap: var(--spacing-xs);
        }

        .language-flag {
          padding: var(--spacing-xs);
          font-size: 1.2rem;
        }

        /* Show mobile menu button */
        .mobile-menu-btn {
          display: block;
        }

        /* Hide desktop controls on mobile */
        .header-controls {
          display: none;
        }

        .form-tabs {
          display: none;
        }
      }

      /* Small mobile devices */
      @media (max-width: 360px) {
        .container {
          padding: 0.5rem;
        }

        h1 {
          font-size: 1.25rem;
        }

        .form-section,
        .preview-section {
          padding: 0.75rem;
        }

        .preview-content {
          min-height: 300px;
          padding: 0.75rem;
        }
      }

      /* Мобільна адаптація 2025 - Touch-оптимізований інтерфейс */
      @media (max-width: 768px) {
        .header-controls .control-group {
          gap: 8px;
        }

        .language-flag {
          width: 36px;
          height: 36px;
          padding: 4px;
          font-size: 14px;
          border-radius: 8px;
        }

        .theme-toggle,
        .translate-toggle {
          width: 40px;
          height: 40px;
          font-size: 16px;
        }

        .photo-upload-area {
          min-height: 120px;
          padding: 12px;
          border-radius: 12px;
          border: 2px dashed var(--color-border);
        }

        .photo-preview {
          width: 80px;
          height: 100px;
          border-radius: 8px;
        }

        .btn-group {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .btn-group .btn {
          flex: 1;
        }
      }

      /* Мобільне меню - покращений дизайн */
      @media (max-width: 640px) {
        .mobile-menu-panel {
          width: 90%;
          max-width: 320px;
          right: -100%;
          background: var(--color-background);
          backdrop-filter: blur(20px);
          border-radius: 20px 0 0 20px;
          box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
          border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mobile-menu-section {
          margin-bottom: 24px;
        }

        .mobile-menu-section h4 {
          color: var(--color-primary);
          font-size: 16px;
          margin-bottom: 12px;
          font-weight: 600;
        }

        .mobile-menu-buttons .btn {
          border-radius: 12px;
          padding: 12px 16px;
          font-size: 16px;
          margin-bottom: 8px;
          background: var(--color-surface);
          border: 1px solid var(--color-border);
          transition: all 0.3s ease;
        }

        .mobile-menu-buttons .btn:hover {
          background: var(--color-primary);
          color: white;
          transform: translateX(4px);
        }

        /* Компактний прев'ю */
        .preview-section {
          order: -1; /* Переносимо прев'ю вгору на мобільних */
          margin-bottom: 20px;
        }

        /* Мобільні візуальні індикатори */
        .document-page::before,
        .document-page::after {
          display: none;
        }

        .document-page:not(:first-child)::before {
          display: block;
          width: 30px;
          height: 1px;
        }

        .document-page:not(:last-child)::after {
          display: block;
          width: 30px;
          height: 1px;
        }

        [data-theme="dark"] .preview-container {
          background: linear-gradient(135deg, #f5f3ef 0%, #f8f6f2 50%, #faf8f4 100%);
          border: 1px solid rgba(255, 255, 255, 0.8);
          margin: 8px;
          padding: 12px;
        }

        [data-theme="dark"] .document-page {
          box-shadow:
            0 8px 20px rgba(0, 0, 0, 0.2),
            0 4px 8px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        /* Пливаюча кнопка для генерації */
        .floating-generate-btn {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 60px;
          height: 60px;
          background: linear-gradient(135deg, var(--color-primary), #4a9eff);
          color: white;
          border: none;
          border-radius: 50%;
          font-size: 24px;
          box-shadow: 0 8px 25px rgba(26, 84, 144, 0.3);
          z-index: 1000;
          cursor: pointer;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          display: none;
        }

        .floating-generate-btn.show {
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .floating-generate-btn:hover {
          transform: scale(1.1);
          box-shadow: 0 12px 35px rgba(26, 84, 144, 0.4);
        }
      }

      /* Focus styles for accessibility */
      *:focus {
        outline: 2px solid var(--color-primary);
        outline-offset: 2px;
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <button class="mobile-menu-btn" id="mobileMenuBtn" title="Menu öffnen"> ☰ </button>
        <div class="header-controls">
          <div class="control-group">
            <button id="themeToggle" class="theme-toggle" title="Theme wechseln">
              <span class="theme-icon">🌙</span>
            </button>
          </div>
          <div class="control-group">
            <div class="language-flags">
              <button class="language-flag active" data-lang="de" title="Deutsch"> 🇩🇪 </button>
              <button class="language-flag" data-lang="en" title="English"> 🇺🇸 </button>
              <button class="language-flag" data-lang="uk" title="Українська"> 🇺🇦 </button>
            </div>
          </div>
          <div class="control-group">
            <button id="translateButton" class="translate-toggle" title="Перекласти текст">
              <span class="translate-icon">🌍</span>
            </button>
          </div>
        </div>
        <h1 data-translate="header.title">📄 Bewerbung Document Generator</h1>
        <p data-translate="header.subtitle">
          Erstellen Sie professionelle Bewerbungsunterlagen mit modernem Design
        </p>
        <div class="form-tabs">
          <button
            class="form-tab-button active"
            onclick="switchFormTab('bewerbung').catch(console.error)"
            data-translate="tabs.bewerbung">
            📝 Anschreiben
          </button>
          <button
            class="form-tab-button"
            onclick="switchFormTab('lebenslauf').catch(console.error)"
            data-translate="tabs.lebenslauf">
            👤 Lebenslauf
          </button>
        </div>

        <!-- Селектор стилів резюме -->
        <div class="resume-style-selector">
          <label for="resumeStyle" data-translate="style.selector">Стиль резюме:</label>
          <select id="resumeStyle" class="style-dropdown">
            <option value="modern-professional">Сучасний професійний</option>
            <option value="minimalist">Мінімалістичний</option>
            <option value="creative-blue">Креативний синій</option>
            <option value="elegant-serif">Елегантний серіф</option>
            <option value="tech-modern">Технологічний</option>
            <option value="classic-formal">Класичний офіційний</option>
            <option value="artistic-gradient">Художній градієнт</option>
            <option value="corporate-clean">Корпоративний чистий</option>
            <option value="startup-bold">Стартап сміливий</option>
            <option value="academic-traditional">Академічний традиційний</option>
          </select>
          <div class="layout-toggle">
            <label>
              <input type="radio" name="layout" value="single-column" checked>
              <span data-translate="layout.single">Одна колонка</span>
            </label>
            <label>
              <input type="radio" name="layout" value="two-column">
              <span data-translate="layout.two">Дві колонки</span>
            </label>
          </div>
        </div>

        <div class="header-data-buttons">
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="generateDocuments()"
            data-translate="buttons.generateDocuments"
            title="Створити всі документи">
            📄 <span data-translate="buttons.create">Створити</span>
          </button>
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="generatePDFOnly()"
            data-translate="buttons.createPDF"
            title="Створити PDF документ">
            📄 <span data-translate="buttons.pdf">PDF</span>
          </button>
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="generateDOCXOnly()"
            data-translate="buttons.createWord"
            title="Створити Word документ">
            📝 <span data-translate="buttons.word">Word</span>
          </button>
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="printDocument()"
            data-translate="buttons.printDocument"
            title="Друкувати документ">
            🖨️ <span data-translate="buttons.print">Друк</span>
          </button>
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="saveLebenslaufData()"
            data-translate="buttons.saveForm"
            title="Зберегти дані">
            💾 <span data-translate="buttons.save">Зберегти</span>
          </button>
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="loadDataFromJSON()"
            data-translate="buttons.loadForm"
            title="Завантажити дані">
            📂 <span data-translate="buttons.load">Завантажити</span>
          </button>
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="clearAllCache()"
            data-translate="buttons.clearCache"
            title="Очистити кеш">
            🗑️ <span data-translate="buttons.clear">Очистити</span>
          </button>
          <button
            type="button"
            class="btn btn-print btn-sm"
            onclick="showCurrentDataInfo()"
            data-translate="buttons.currentData"
            title="Поточні дані">
            📄 <span data-translate="buttons.data">Дані</span>
          </button>
        </div>
      </header>

      <!-- Mobile Menu Overlay -->
      <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

      <!-- Mobile Menu Panel -->
      <div class="mobile-menu-panel" id="mobileMenuPanel">
        <h3 data-translate="mobile.menu">📱 Menu</h3>

        <div class="mobile-menu-section">
          <h4 data-translate="mobile.language">🌐 Sprache</h4>
          <div class="mobile-menu-buttons">
            <button class="btn btn-secondary language-flag active" data-lang="de" title="Deutsch">
              🇩🇪 Deutsch
            </button>
            <button class="btn btn-secondary language-flag" data-lang="en" title="English">
              🇺🇸 English
            </button>
            <button class="btn btn-secondary language-flag" data-lang="uk" title="Українська">
              🇺🇦 Українська
            </button>
          </div>
        </div>

        <div class="mobile-menu-section">
          <h4 data-translate="mobile.theme">🎨 Theme</h4>
          <div class="mobile-menu-buttons">
            <button class="btn btn-secondary" id="mobileThemeToggle" title="Theme wechseln">
              <span class="theme-icon">🌙</span>
              <span data-translate="mobile.theme.toggle">Theme wechseln</span>
            </button>
          </div>
        </div>

        <div class="mobile-menu-section">
          <h4 data-translate="mobile.documents">📄 Dokumente</h4>
          <div class="mobile-menu-buttons">
            <button
              class="btn btn-primary form-tab-button active"
              onclick="switchFormTab('bewerbung').catch(console.error)"
              data-translate="tabs.bewerbung">
              📝 Anschreiben
            </button>
            <button
              class="btn btn-primary form-tab-button"
              onclick="switchFormTab('lebenslauf').catch(console.error)"
              data-translate="tabs.lebenslauf">
              👤 Lebenslauf
            </button>
          </div>
        </div>

        <div class="mobile-menu-section">
          <h4 data-translate="mobile.actions">⚡ Aktionen</h4>
          <div class="mobile-menu-buttons">
            <button
              class="btn btn-success"
              onclick="generateDocuments()"
              data-translate="buttons.generateDocuments">
              📄 <span data-translate="buttons.create">Створити</span>
            </button>
            <button
              class="btn btn-danger"
              onclick="generatePDFOnly()"
              data-translate="buttons.createPDF">
              📄 <span data-translate="buttons.pdf">PDF</span>
            </button>
            <button
              class="btn btn-info"
              onclick="generateDOCXOnly()"
              data-translate="buttons.createWord">
              📝 <span data-translate="buttons.word">Word</span>
            </button>
            <button
              class="btn btn-secondary"
              onclick="printDocument()"
              data-translate="buttons.printDocument">
              🖨️ <span data-translate="buttons.print">Друк</span>
            </button>
          </div>
        </div>

        <div class="mobile-menu-section">
          <h4 data-translate="mobile.data">💾 Дані</h4>
          <div class="mobile-menu-buttons">
            <button
              class="btn btn-success"
              onclick="saveLebenslaufData()"
              data-translate="buttons.saveForm">
              💾 <span data-translate="buttons.save">Зберегти</span>
            </button>
            <button
              class="btn btn-info"
              onclick="loadDataFromJSON()"
              data-translate="buttons.loadForm">
              📂 <span data-translate="buttons.load">Завантажити</span>
            </button>
            <button
              class="btn btn-warning"
              onclick="clearAllCache()"
              data-translate="buttons.clearCache">
              🗑️ <span data-translate="buttons.clear">Очистити</span>
            </button>
            <button
              class="btn btn-secondary"
              onclick="showCurrentDataInfo()"
              data-translate="buttons.currentData">
              📄 <span data-translate="buttons.data">Дані</span>
            </button>
          </div>
        </div>
      </div>

      <main class="main-content">
        <!-- Form Tabs -->

        <section class="form-section" id="bewerbungFormSection">
          <h2 data-translate="form.personalData">📝 Persönliche Daten</h2>
          <form id="bewerbungForm">
            <div class="form-group">
              <label for="fullName" data-translate="form.fullName">Vollständiger Name *</label>
              <input
                type="text"
                id="fullName"
                name="fullName"
                required
                placeholder="Vollständiger Name *">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="address" data-translate="form.address">Adresse *</label>
                <input type="text" id="address" name="address" required placeholder="Adresse *">
              </div>
              <div class="form-group">
                <label for="phone" data-translate="form.phone">Telefon *</label>
                <input type="tel" id="phone" name="phone" required placeholder="Telefon *">
              </div>
            </div>

            <div class="form-group">
              <label for="email" data-translate="form.email">E-Mail *</label>
              <input type="email" id="email" name="email" required placeholder="E-Mail *">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="birthDate" data-translate="form.birthDate">Geburtsdatum *</label>
                <input
                  type="date"
                  id="birthDate"
                  name="birthDate"
                  required
                  placeholder="Geburtsdatum *">
              </div>
              <div class="form-group">
                <label for="nationality" data-translate="form.nationality"
                  >Staatsangehörigkeit *</label
                >
                <input
                  type="text"
                  id="nationality"
                  name="nationality"
                  required
                  placeholder="Staatsangehörigkeit *">
              </div>
            </div>

            <h2 data-translate="form.professionalInfo"> 💼 Berufliche Informationen </h2>

            <div class="form-group">
              <label for="position" data-translate="form.position">Beworbene Position *</label>
              <input
                type="text"
                id="position"
                name="position"
                required
                placeholder="Beworbene Position *">
            </div>

            <div class="form-group">
              <label for="company" data-translate="form.company">Unternehmen *</label>
              <input type="text" id="company" name="company" required placeholder="Unternehmen *">
            </div>

            <div class="form-group">
              <label for="jobNumber" data-translate="form.jobNumber">Ausschreibungsnummer</label>
              <input type="text" id="jobNumber" name="jobNumber" value="">
            </div>

            <h3 data-translate="form.contactPerson">👤 Kontaktperson</h3>

            <div class="form-group">
              <label for="contactName" data-translate="form.contactName"
                >Name der Kontaktperson *</label
              >
              <input
                type="text"
                id="contactName"
                name="contactName"
                required
                placeholder="Kontaktperson">
            </div>

            <div class="form-group">
              <label for="contactAddress" data-translate="form.contactAddress"
                >Adresse der Kontaktperson *</label
              >
              <input
                type="text"
                id="contactAddress"
                name="contactAddress"
                required
                placeholder="Adresse der Kontaktperson">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="contactPhone" data-translate="form.contactPhone"
                  >Telefon der Kontaktperson</label
                >
                <input
                  type="tel"
                  id="contactPhone"
                  name="contactPhone"
                  placeholder="Telefon der Kontaktperson">
              </div>
              <div class="form-group">
                <label for="contactEmail" data-translate="form.contactEmail"
                  >E-Mail der Kontaktperson</label
                >
                <input
                  type="email"
                  id="contactEmail"
                  name="contactEmail"
                  placeholder="E-Mail der Kontaktperson">
              </div>
            </div>

            <h2 data-translate="form.letterContent">📋 Anschreiben Inhalt</h2>

            <div class="form-group">
              <label for="subject" data-translate="form.subject">Betreff des Anschreibens *</label>
              <input
                type="text"
                id="subject"
                name="subject"
                required
                placeholder="Betreff des Anschreibens"
                data-translate-content="content.subject">
            </div>

            <div class="form-group">
              <label for="subjectColor" data-translate="form.subjectColor"
                >Farbe des Betreffs</label
              >
              <input
                type="color"
                id="subjectColor"
                name="subjectColor"
                value="#1a5490"
                style="
                  width: 60px;
                  height: 40px;
                  border: none;
                  border-radius: 4px;
                  cursor: pointer;
                ">
            </div>

            <div class="form-group">
              <label for="greeting" data-translate="form.greeting">Anrede *</label>
              <input
                type="text"
                id="greeting"
                name="greeting"
                required
                placeholder="Anrede"
                data-translate="form.greetingPlaceholder">
            </div>

            <div class="form-group">
              <label for="motivation" data-translate="form.motivation"
                >Motivation und Interesse *</label
              >
              <textarea
                id="motivation"
                name="motivation"
                required
                placeholder="Beschreiben Sie Ihre Motivation für diese Position..."
                data-translate-content="content.motivation">
mit großem Interesse habe ich Ihre Stellenanzeige für einen Mitarbeiter im Stationsservice gelesen. Die Möglichkeit, in einem renommierten Krankenhaus wie dem Universitätsklinikum Magdeburg zu arbeiten und dabei Menschen zu helfen, motiviert mich sehr, mich bei Ihnen zu bewerben.</textarea
              >
            </div>

            <div class="form-group">
              <label for="qualifications" data-translate="form.qualifications"
                >Qualifikationen und Erfahrungen *</label
              >
              <textarea
                id="qualifications"
                name="qualifications"
                required
                placeholder="Beschreiben Sie Ihre relevanten Qualifikationen..."
                data-translate-content="content.qualifications">
Als zuverlässige und verantwortungsbewusste Person bringe ich die erforderlichen Eigenschaften für diese Position mit. Hygiene und Sauberkeit haben für mich höchste Priorität, was ich als grundlegend für die Arbeit im Gesundheitswesen betrachte. In meiner bisherigen Arbeit habe ich immer gut im Team gearbeitet. Ich kann gut organisieren und bin kommunikativ, freundlich zu allen Menschen und auch in stressigen Situationen ruhig und effizient bleiben.</textarea
              >
            </div>

            <div class="form-group">
              <label for="tasks" data-translate="form.tasks">Aufgabenverständnis *</label>
              <textarea
                id="tasks"
                name="tasks"
                required
                placeholder="Beschreiben Sie Ihr Verständnis der Aufgaben..."
                data-translate-content="content.tasks">
Die in Ihrer Ausschreibung genannten Aufgaben - von der Speiseversorgung über Hol- und Bringdienste bis zur hygienischen Aufbereitung - entsprechen genau meinen Fähigkeiten. Ich verstehe die Wichtigkeit dieser Tätigkeiten für das Wohlbefinden der Patienten und bin bereit, mit großer Sorgfalt und Empathie zu arbeiten.</textarea
              >
            </div>

            <div class="form-group">
              <label for="future" data-translate="form.future">Zukunftspläne</label>
              <textarea
                id="future"
                name="future"
                placeholder="Beschreiben Sie Ihre Zukunftspläne..."
                data-translate-content="content.future">
Besonders ansprechend finde ich Ihr Angebot der Fort- und Weiterbildungsmöglichkeiten sowie die Aussicht auf einen sicheren Arbeitsplatz. Ich bin motiviert, mich kontinuierlich weiterzuentwickeln und langfristig Teil Ihres Teams zu werden.</textarea
              >
            </div>

            <div class="form-group">
              <label for="availability" data-translate="form.availability">Verfügbarkeit *</label>
              <textarea
                id="availability"
                name="availability"
                required
                placeholder="Beschreiben Sie Ihre Verfügbarkeit..."
                data-translate="form.availabilityPlaceholder"
                data-translate-content="content.availability">
Ich stehe Ihnen ab sofort zur Verfügung und bin flexibel bezüglich der Arbeitszeiten. Über die Möglichkeit, mich in einem persönlichen Gespräch vorstellen zu dürfen, würde ich mich sehr freuen.</textarea
              >
            </div>
            <h2 data-translate="form.signatureSection">📝 Unterschrift</h2>
            <div class="form-group">
              <label for="closing" data-translate="form.closing">Abschluss *</label>
              <textarea
                id="closing"
                name="closing"
                required
                placeholder="Vielen Dank im Voraus für Ihre Antwort!..."
                data-translate-content="content.closing"
                style="min-height: 100px">
Vielen Dank im Voraus für Ihre Antwort!
Mit freundlichen Grüßen,
Mykola Vutov</textarea
              >
            </div>
            <div class="form-group">
              <label for="signature" data-translate="form.signature"
                >Unterschrift und Anlagen *</label
              >
              <textarea
                id="signature"
                name="signature"
                required
                placeholder="Mit freundlichen Grüßen,..."
                data-translate-content="content.signature"
                style="min-height: 150px">
Anlagen:
- Lebenslauf
- Zeugnisse</textarea
              >
            </div>

            <!-- Photo Upload Section for Anschreiben -->
            <div class="form-group photo-upload-section">
              <label for="anschreibenPhoto" data-translate="lebenslauf.photo">📷 Foto</label>
              <div class="photo-upload-container">
                <input
                  type="file"
                  id="anschreibenPhoto"
                  name="anschreibenPhoto"
                  accept="image/*"
                  style="display: none">
                <div
                  class="photo-upload-area"
                  onclick="console.log('Anschreiben photo upload area clicked'); document.getElementById('anschreibenPhoto').click()">
                  <div class="photo-preview" id="anschreibenPhotoPreview">
                    <div class="photo-placeholder">
                      <span class="photo-icon">📷</span>
                      <span data-translate="lebenslauf.photoPlaceholder">Foto hochladen</span>
                    </div>
                  </div>
                </div>
                <button
                  type="button"
                  id="removeAnschreibenPhoto"
                  class="btn btn-secondary"
                  style="display: none">
                  <span data-translate="lebenslauf.removePhoto">Foto entfernen</span>
                </button>
              </div>
            </div>
          </form>
        </section>

        <!-- Lebenslauf Form Section -->
        <section class="form-section" id="lebenslaufSection" style="display: none">
          <h2 data-translate="lebenslauf.personalData">📝 Persönliche Daten</h2>

          <!-- Photo Upload Section -->
          <div class="form-group photo-upload-section">
            <label for="lebenslaufPhoto" data-translate="lebenslauf.photo">📷 Foto</label>
            <div class="photo-upload-container">
              <input
                type="file"
                id="lebenslaufPhoto"
                name="lebenslaufPhoto"
                accept="image/*"
                style="display: none">
              <div
                class="photo-upload-area"
                onclick="console.log('Photo upload area clicked'); document.getElementById('lebenslaufPhoto').click()">
                <div class="photo-preview" id="photoPreview">
                  <div class="photo-placeholder">
                    <span class="photo-icon">📷</span>
                    <span data-translate="lebenslauf.photoPlaceholder">Foto hochladen</span>
                  </div>
                </div>
              </div>
              <button
                type="button"
                class="btn btn-secondary photo-remove-btn"
                id="removePhoto"
                style="display: none">
                <span data-translate="lebenslauf.removePhoto">Foto entfernen</span>
              </button>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="lebenslaufFullName" data-translate="form.fullName"
                >Vollständiger Name *</label
              >
              <input type="text" id="lebenslaufFullName" name="lebenslaufFullName" required>
            </div>
            <div class="form-group">
              <label for="lebenslaufAddress" data-translate="form.address">Adresse *</label>
              <input type="text" id="lebenslaufAddress" name="lebenslaufAddress" required>
            </div>
            <div class="form-group">
              <label for="lebenslaufPhone" data-translate="form.phone">Telefon *</label>
              <input type="tel" id="lebenslaufPhone" name="lebenslaufPhone" required>
            </div>
            <div class="form-group">
              <label for="lebenslaufEmail" data-translate="form.email">E-Mail *</label>
              <input type="email" id="lebenslaufEmail" name="lebenslaufEmail" required>
            </div>
            <div class="form-group">
              <label for="lebenslaufBirthDate" data-translate="form.birthDate"
                >Geburtsdatum *</label
              >
              <input type="date" id="lebenslaufBirthDate" name="lebenslaufBirthDate" required>
            </div>
            <div class="form-group">
              <label for="lebenslaufNationality" data-translate="form.nationality"
                >Staatsangehörigkeit *</label
              >
              <input type="text" id="lebenslaufNationality" name="lebenslaufNationality" required>
            </div>
          </div>

          <h2 data-translate="lebenslauf.professionalSummary"> 💼 Berufliche Qualifikation </h2>
          <div class="form-group">
            <label for="lebenslaufSummary" data-translate="form.motivation"
              >Berufliche Zusammenfassung *</label
            >
            <textarea
              id="lebenslaufSummary"
              name="lebenslaufSummary"
              rows="4"
              placeholder="Beschreiben Sie Ihre berufliche Qualifikation..."
              required></textarea>
          </div>

          <h2 data-translate="lebenslauf.skills">🎯 Kernkompetenzen</h2>
          <div class="form-group">
            <label for="lebenslaufSkills" data-translate="form.qualifications"
              >Fähigkeiten und Kompetenzen *</label
            >
            <textarea
              id="lebenslaufSkills"
              name="lebenslaufSkills"
              rows="6"
              placeholder="Liste Ihrer Kernkompetenzen (eine pro Zeile)..."
              required></textarea>
          </div>

          <h2 data-translate="lebenslauf.experience">💼 Berufserfahrung</h2>
          <div class="form-group">
            <label for="lebenslaufExperience" data-translate="form.qualifications"
              >Berufserfahrung *</label
            >
            <textarea
              id="lebenslaufExperience"
              name="lebenslaufExperience"
              rows="8"
              placeholder="Position | Unternehmen&#10;Zeitraum&#10;Beschreibung&#10;&#10;Position | Unternehmen&#10;Zeitraum&#10;Beschreibung"
              required></textarea>
          </div>

          <h2 data-translate="lebenslauf.education">🎓 Ausbildung</h2>
          <div class="form-group">
            <label for="lebenslaufEducation" data-translate="form.qualifications"
              >Ausbildung *</label
            >
            <textarea
              id="lebenslaufEducation"
              name="lebenslaufEducation"
              rows="4"
              placeholder="Abschluss&#10;Institution&#10;Zeitraum"
              required></textarea>
          </div>

          <h2 data-translate="lebenslauf.languages">🌍 Sprachkenntnisse</h2>
          <div class="form-group">
            <label for="lebenslaufLanguages" data-translate="form.qualifications">Sprachen *</label>
            <textarea
              id="lebenslaufLanguages"
              name="lebenslaufLanguages"
              rows="4"
              placeholder="Sprache - Niveau&#10;Sprache - Niveau"
              required></textarea>
          </div>

          <h2 data-translate="lebenslauf.additionalQualifications">
            ⭐ Zusätzliche Qualifikationen
          </h2>
          <div class="form-group">
            <label for="lebenslaufAdditional" data-translate="form.qualifications"
              >Weitere Qualifikationen</label
            >
            <textarea
              id="lebenslaufAdditional"
              name="lebenslaufAdditional"
              rows="4"
              placeholder="Zusätzliche Qualifikationen (eine pro Zeile)..."></textarea>
          </div>

          <!-- Lebenslauf Form Buttons -->
          <div class="form-actions"> </div>
        </section>

        <section class="preview-section">
          <h2 data-translate="preview.title">📋 Live Preview</h2>
          <div class="preview-container" id="previewContent">
            <div class="preview-placeholder">
              <div class="preview-icon">📄</div>
              <h3>Документ готовий до перегляду</h3>
              <p data-translate="preview.placeholder">
                Заповніть поля форми, щоб побачити попередній перегляд документів
              </p>
              <div class="preview-actions">
                <button class="btn btn-primary btn-sm" onclick="generatePreview()">
                  🔄 Оновити перегляд
                </button>
              </div>
            </div>
          </div>
        </section>
      </main>

      <div
        id="statusMessage"
        class="status-message"
        style="display: none"
        onclick="clearStatus()"
        title="Klicken zum Schließen"></div>

      <footer class="footer">
        <p data-translate="footer.copyright">
          &copy; 2025 Bewerbung Document Generator | Erstellt mit modernen Web-Standards
        </p>
      </footer>
    </div>

    <script>
      // Form data management
      let formData = {}
      let globalPhotoData = null // Global variable to store photo data
      let currentPreviewType = "bewerbung" // Track current preview type

      // Save form data to localStorage
      function saveFormData() {
        try {
          const dataToSave = {
            formData: formData,
            globalPhotoData: globalPhotoData,
            currentPreviewType: currentPreviewType
          }
          localStorage.setItem("resumeFormData", JSON.stringify(dataToSave))
          console.log("Form data saved to localStorage")
          console.log(
            "Saved data includes photo:",
            dataToSave.formData.lebenslaufPhoto ? "Yes" : "No"
          )
          console.log("Saved globalPhotoData:", dataToSave.globalPhotoData ? "Yes" : "No")
        } catch (error) {
          console.error("Error saving form data:", error)
        }
      }

      // Load form data from localStorage
      function loadFormData() {
        try {
          const savedData = localStorage.getItem("resumeFormData")
          if (savedData) {
            const parsedData = JSON.parse(savedData)
            formData = parsedData.formData || {}
            globalPhotoData = parsedData.globalPhotoData || null
            currentPreviewType = parsedData.currentPreviewType || "bewerbung"

            // Restore form values
            restoreFormValues()

            console.log("Form data loaded from localStorage")
            console.log("Loaded formData includes photo:", formData.lebenslaufPhoto ? "Yes" : "No")
            console.log("Loaded globalPhotoData:", globalPhotoData ? "Yes" : "No")
            return true
          }
        } catch (error) {
          console.error("Error loading form data:", error)
        }
        return false
      }

      // Load data from localStorage if available
      function loadFromLocalStorage(type, lang) {
        const storageKey = `${type}_data_${lang}`
        const data = localStorage.getItem(storageKey)
        if (data) {
          try {
            return JSON.parse(data)
          } catch (e) {
            console.error("Error parsing localStorage data:", e)
          }
        }
        return null
      }

      // Load data from JSON files based on current language and tab
      async function loadDataFromJSON() {
        try {
          const currentLang = currentLanguage || "uk"

          // Check current active tab
          const lebenslaufTab = document.querySelector(".form-tab-button[onclick*='lebenslauf']")
          const bewerbungTab = document.querySelector(".form-tab-button[onclick*='bewerbung']")
          const isLebenslaufActive = lebenslaufTab && lebenslaufTab.classList.contains("active")
          const isBewerbungActive = bewerbungTab && bewerbungTab.classList.contains("active")

          let dataFile, successMessage, errorMessage

          if (isLebenslaufActive) {
            // Load Lebenslauf data
            dataFile =
              currentLang === "de"
                ? "./data/lebenslauf_data_de.json"
                : currentLang === "en"
                  ? "./data/lebenslauf_data_en.json"
                  : "./data/lebenslauf_data.json" // Ukrainian default

            successMessage =
              currentLang === "uk"
                ? "✅ Дані резюме успішно завантажено!"
                : currentLang === "de"
                  ? "✅ Lebenslauf-Daten erfolgreich geladen!"
                  : "✅ Resume data loaded successfully!"

            errorMessage =
              currentLang === "uk"
                ? "❌ Помилка завантаження даних резюме"
                : currentLang === "de"
                  ? "❌ Fehler beim Laden der Lebenslauf-Daten"
                  : "❌ Error loading resume data"

            showStatus(
              currentLang === "uk"
                ? "Завантаження даних резюме..."
                : currentLang === "de"
                  ? "Lebenslauf-Daten werden geladen..."
                  : "Loading resume data...",
              "info"
            )

            try {
              const response = await fetch(dataFile)
              if (response.ok) {
                const data = await response.json()
                await populateFormWithLebenslaufData(data)
                showStatus(successMessage, "success")
                return
              } else {
                throw new Error(`Failed to load data: ${response.status}`)
              }
            } catch (fetchError) {
              console.warn("Server not available, trying localStorage:", fetchError.message)
              
              // Try to load from localStorage
              const localData = loadFromLocalStorage("lebenslauf", currentLang)
              if (localData) {
                await populateFormWithLebenslaufData(localData)
                const localSuccessMessage =
                  currentLang === "uk"
                    ? "✅ Дані Lebenslauf завантажено з локального сховища"
                    : currentLang === "de"
                      ? "✅ Lebenslauf-Daten aus lokalem Speicher geladen"
                      : "✅ Lebenslauf data loaded from local storage"
                showStatus(localSuccessMessage, "warning")
                return
              } else {
                throw new Error("No data available locally or from server")
              }
            }
          } else if (isBewerbungActive) {
            // Load Anschreiben data
            dataFile =
              currentLang === "de"
                ? "./data/anschreiben_data_de.json"
                : currentLang === "en"
                  ? "./data/anschreiben_data_en.json"
                  : "./data/anschreiben_data.json" // Ukrainian default

            successMessage =
              currentLang === "uk"
                ? "✅ Дані листа заявки успішно завантажено!"
                : currentLang === "de"
                  ? "✅ Anschreiben-Daten erfolgreich geladen!"
                  : "✅ Cover letter data loaded successfully!"

            errorMessage =
              currentLang === "uk"
                ? "❌ Помилка завантаження даних листа заявки"
                : currentLang === "de"
                  ? "❌ Fehler beim Laden der Anschreiben-Daten"
                  : "❌ Error loading cover letter data"

            showStatus(
              currentLang === "uk"
                ? "Завантаження даних листа заявки..."
                : currentLang === "de"
                  ? "Anschreiben-Daten werden geladen..."
                  : "Loading cover letter data...",
              "info"
            )

            try {
              const response = await fetch(dataFile)
              if (response.ok) {
                const data = await response.json()
                await populateFormWithAnschreibenData(data)
                showStatus(successMessage, "success")
                return
              } else {
                throw new Error(`Failed to load data: ${response.status}`)
              }
            } catch (fetchError) {
              console.warn("Server not available, trying localStorage:", fetchError.message)
              
              // Try to load from localStorage
              const localData = loadFromLocalStorage("anschreiben", currentLang)
              if (localData) {
                await populateFormWithAnschreibenData(localData)
                const localSuccessMessage =
                  currentLang === "uk"
                    ? "✅ Дані Anschreiben завантажено з локального сховища"
                    : currentLang === "de"
                      ? "✅ Anschreiben-Daten aus lokalem Speicher geladen"
                      : "✅ Anschreiben data loaded from local storage"
                showStatus(localSuccessMessage, "warning")
                return
              } else {
                throw new Error("No data available locally or from server")
              }
            }
          } else {
            // No active tab
            const noTabMessage =
              currentLang === "uk"
                ? "❌ Перейдіть на вкладку 'Anschreiben' або 'Lebenslauf' для завантаження даних"
                : currentLang === "de"
                  ? "❌ Wechseln Sie zum 'Anschreiben' oder 'Lebenslauf' Tab, um Daten zu laden"
                  : "❌ Switch to 'Anschreiben' or 'Lebenslauf' tab to load data"

            showStatus(noTabMessage, "error")
            return
          }
        } catch (error) {
          console.error("Error loading data from JSON:", error)
          const currentLang = currentLanguage || "uk"
          const errorMessage =
            currentLang === "uk"
              ? "❌ Помилка завантаження даних з JSON файлу"
              : currentLang === "de"
                ? "❌ Fehler beim Laden der Daten aus der JSON-Datei"
                : "❌ Error loading data from JSON file"

          showStatus(errorMessage, "error")
        }
      }

      // Restore form values from formData
      function restoreFormValues() {
        // Restore main form values
        const form = document.getElementById("bewerbungForm")
        if (form) {
          Object.keys(formData).forEach(key => {
            const input = form.querySelector(`[name="${key}"]`)
            if (input && input.type !== "file") {
              input.value = formData[key] || ""
            }
          })
        }

        // Restore Lebenslauf form values
        const lebenslaufSection = document.getElementById("lebenslaufSection")
        if (lebenslaufSection) {
          Object.keys(formData).forEach(key => {
            const input = lebenslaufSection.querySelector(`[name="${key}"]`)
            if (input && input.type !== "file") {
              input.value = formData[key] || ""
            }
          })
        }

        // Restore photo if exists
        if (globalPhotoData && typeof globalPhotoData === "string") {
          console.log("Restoring photo from globalPhotoData:", globalPhotoData)
          const photoPreview = document.getElementById("photoPreview")
          if (photoPreview) {
            photoPreview.innerHTML = `<img src="${globalPhotoData}" alt="Uploaded photo" />`
            const removePhotoBtn = document.getElementById("removePhotoBtn")
            if (removePhotoBtn) {
              removePhotoBtn.style.display = "block"
            }
          }
        } else {
          console.log("No globalPhotoData to restore or not a string:", typeof globalPhotoData)
        }

        // Restore Anschreiben photo if exists
        if (formData.anschreibenPhoto && typeof formData.anschreibenPhoto === "string") {
          console.log("Restoring Anschreiben photo from formData:", formData.anschreibenPhoto)
          const anschreibenPhotoPreview = document.getElementById("anschreibenPhotoPreview")
          if (anschreibenPhotoPreview) {
            anschreibenPhotoPreview.innerHTML = `<img src="${formData.anschreibenPhoto}" alt="Uploaded photo" />`
            const removeAnschreibenPhotoBtn = document.getElementById("removeAnschreibenPhoto")
            if (removeAnschreibenPhotoBtn) {
              removeAnschreibenPhotoBtn.style.display = "block"
            }
          }
        } else {
          console.log(
            "No anschreibenPhoto to restore or not a string:",
            typeof formData.anschreibenPhoto
          )
        }
      }

      // Save Lebenslauf data to JSON file
      async function saveLebenslaufData() {
        // Check current active tab
        const lebenslaufTab = document.querySelector(".form-tab-button[onclick*='lebenslauf']")
        const bewerbungTab = document.querySelector(".form-tab-button[onclick*='bewerbung']")
        const isLebenslaufActive = lebenslaufTab && lebenslaufTab.classList.contains("active")
        const isBewerbungActive = bewerbungTab && bewerbungTab.classList.contains("active")

        // If user is on Bewerbung tab, redirect to save Anschreiben data instead
        if (isBewerbungActive) {
          const currentLang = currentLanguage || "uk"
          const redirectMessage =
            currentLang === "uk"
              ? "ℹ️ Ви на вкладці 'Bewerbung'. Зберігаю дані листа заявки..."
              : currentLang === "de"
                ? "ℹ️ Sie sind auf dem 'Bewerbung' Tab. Speichere Anschreiben-Daten..."
                : "ℹ️ You are on 'Bewerbung' tab. Saving cover letter data..."

          showStatus(redirectMessage, "info")
          await saveAnschreibenData()
          return
        }

        // If user is on neither tab, show error
        if (!isLebenslaufActive) {
          const currentLang = currentLanguage || "uk"
          const errorMessage =
            currentLang === "uk"
              ? "❌ Перейдіть на вкладку 'Lebenslauf' або 'Bewerbung' для збереження даних"
              : currentLang === "de"
                ? "❌ Wechseln Sie zum 'Lebenslauf' oder 'Bewerbung' Tab, um Daten zu speichern"
                : "❌ Switch to 'Lebenslauf' or 'Bewerbung' tab to save data"

          showStatus(errorMessage, "error")
          return
        }

        // Get current language
        const currentLang = currentLanguage || "uk"
        console.log("Saving Lebenslauf data for language:", currentLang)

        const lebenslaufData = {
          fullName: document.getElementById("lebenslaufFullName")?.value || "",
          birthDate: document.getElementById("lebenslaufBirthDate")?.value || "",
          address: document.getElementById("lebenslaufAddress")?.value || "",
          phone: document.getElementById("lebenslaufPhone")?.value || "",
          email: document.getElementById("lebenslaufEmail")?.value || "",
          nationality: document.getElementById("lebenslaufNationality")?.value || "",
          residenceStatus: document.getElementById("lebenslaufResidenceStatus")?.value || "",
          summary: document.getElementById("lebenslaufSummary")?.value || "",
          skills: document.getElementById("lebenslaufSkills")?.value || "",
          experience: document.getElementById("lebenslaufExperience")?.value || "",
          education: document.getElementById("lebenslaufEducation")?.value || "",
          languages: document.getElementById("lebenslaufLanguages")?.value || "",
          additional: document.getElementById("lebenslaufAdditional")?.value || "",
          photo: globalPhotoData || null,
          lastUpdated: new Date().toISOString(),
          lang: currentLang
        }

        console.log("Saving data for language:", currentLang, "Data:", lebenslaufData)

        try {
          console.log(`Saving Lebenslauf data for language: ${currentLang}`)

          // Try to send data to our API server
          try {
            const response = await fetch("http://localhost:3001/api/save-lebenslauf", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify(lebenslaufData)
            })

            if (response.ok) {
              const result = await response.json()
              console.log("Lebenslauf data saved successfully:", result)

              // Show success message in current language
              const fileName = result.fileName
              const wasCreated = result.wasCreated
              const successMessage =
                getTranslation("messages.dataSaved") ||
                (currentLang === "uk"
                  ? `✅ Lebenslauf дані ${wasCreated ? "створено" : "оновлено"} у файлі ${fileName}!`
                  : currentLang === "de"
                    ? `✅ Lebenslauf Daten ${wasCreated ? "erstellt" : "aktualisiert"} in Datei ${fileName}!`
                    : `✅ Lebenslauf data ${wasCreated ? "created" : "updated"} in file ${fileName}!`)

              showStatus(successMessage, "success")
              return // Success - exit function
            } else {
              const errorData = await response.json()
              throw new Error(errorData.error || "Failed to save data")
            }
          } catch (fetchError) {
            console.warn("Server not available, saving to localStorage:", fetchError.message)
            
            // Fallback: Save to localStorage
            const storageKey = `lebenslauf_data_${currentLang}`
            localStorage.setItem(storageKey, JSON.stringify(lebenslaufData))
            
            // Also update the main formData
            Object.assign(formData, lebenslaufData)
            saveFormData()
            
            const successMessage =
              currentLang === "uk"
                ? "✅ Дані Lebenslauf збережено локально (сервер недоступний)"
                : currentLang === "de"
                  ? "✅ Lebenslauf-Daten lokal gespeichert (Server nicht verfügbar)"
                  : "✅ Lebenslauf data saved locally (server unavailable)"
            
            showStatus(successMessage, "warning")
          }
        } catch (error) {
          console.error("Error saving Lebenslauf data:", error)
          const errorMessage =
            getTranslation("messages.saveError") ||
            (currentLang === "uk"
              ? "Помилка збереження даних Lebenslauf"
              : currentLang === "de"
                ? "Fehler beim Speichern der Lebenslauf-Daten"
                : "Error saving Lebenslauf data")

          showStatus(errorMessage, "error")
        }
      }

      // Save Anschreiben data to JSON file
      async function saveAnschreibenData() {
        // Check current active tab
        const lebenslaufTab = document.querySelector(".form-tab-button[onclick*='lebenslauf']")
        const bewerbungTab = document.querySelector(".form-tab-button[onclick*='bewerbung']")
        const isLebenslaufActive = lebenslaufTab && lebenslaufTab.classList.contains("active")
        const isBewerbungActive = bewerbungTab && bewerbungTab.classList.contains("active")

        // If user is on Lebenslauf tab, redirect to save Lebenslauf data instead
        if (isLebenslaufActive) {
          const currentLang = currentLanguage || "uk"
          const redirectMessage =
            currentLang === "uk"
              ? "ℹ️ Ви на вкладці 'Lebenslauf'. Зберігаю дані резюме..."
              : currentLang === "de"
                ? "ℹ️ Sie sind auf dem 'Lebenslauf' Tab. Speichere Lebenslauf-Daten..."
                : "ℹ️ You are on 'Lebenslauf' tab. Saving resume data..."

          showStatus(redirectMessage, "info")
          await saveLebenslaufData()
          return
        }

        // If user is on neither tab, show error
        if (!isBewerbungActive) {
          const currentLang = currentLanguage || "uk"
          const errorMessage =
            currentLang === "uk"
              ? "❌ Перейдіть на вкладку 'Lebenslauf' або 'Bewerbung' для збереження даних"
              : currentLang === "de"
                ? "❌ Wechseln Sie zum 'Lebenslauf' oder 'Bewerbung' Tab, um Daten zu speichern"
                : "❌ Switch to 'Lebenslauf' or 'Bewerbung' tab to save data"

          showStatus(errorMessage, "error")
          return
        }

        // Get current language
        const currentLang = currentLanguage || "uk"
        console.log("Saving Anschreiben data for language:", currentLang)

        // Collect Anschreiben data from form fields
        const anschreibenData = {
          // Personal data
          fullName: document.getElementById("fullName")?.value || "",
          address: document.getElementById("address")?.value || "",
          phone: document.getElementById("phone")?.value || "",
          email: document.getElementById("email")?.value || "",
          birthDate: document.getElementById("birthDate")?.value || "",
          nationality: document.getElementById("nationality")?.value || "",

          // Job application specific
          position: document.getElementById("position")?.value || "",
          company: document.getElementById("company")?.value || "",
          motivation: document.getElementById("motivation")?.value || "",
          qualifications: document.getElementById("qualifications")?.value || "",

          // Additional fields that might be relevant for Anschreiben
          experience: document.getElementById("experience")?.value || "",
          education: document.getElementById("education")?.value || "",
          languages: document.getElementById("languages")?.value || "",
          additional: document.getElementById("additional")?.value || "",

          // Metadata
          lastUpdated: new Date().toISOString(),
          lang: currentLang
        }

        console.log("Saving Anschreiben data for language:", currentLang, "Data:", anschreibenData)

        try {
          // Try to send data to our API server
          try {
            const response = await fetch("http://localhost:3001/api/save-anschreiben", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify(anschreibenData)
            })

            if (response.ok) {
              const result = await response.json()
              console.log("Anschreiben data saved successfully:", result)

              // Show success message in current language
              const fileName = result.fileName
              const wasCreated = result.wasCreated
              const successMessage =
                getTranslation("messages.dataSaved") ||
                (currentLang === "uk"
                  ? `✅ Anschreiben дані ${wasCreated ? "створено" : "оновлено"} у файлі ${fileName}!`
                  : currentLang === "de"
                    ? `✅ Anschreiben Daten ${wasCreated ? "erstellt" : "aktualisiert"} in Datei ${fileName}!`
                    : `✅ Anschreiben data ${wasCreated ? "created" : "updated"} in file ${fileName}!`)

              showStatus(successMessage, "success")
              return // Success - exit function
            } else {
              const errorData = await response.json()
              throw new Error(errorData.error || "Failed to save data")
            }
          } catch (fetchError) {
            console.warn("Server not available, saving to localStorage:", fetchError.message)
            
            // Fallback: Save to localStorage
            const storageKey = `anschreiben_data_${currentLang}`
            localStorage.setItem(storageKey, JSON.stringify(anschreibenData))
            
            // Also update the main formData
            Object.assign(formData, anschreibenData)
            saveFormData()
            
            const successMessage =
              currentLang === "uk"
                ? "✅ Дані Anschreiben збережено локально (сервер недоступний)"
                : currentLang === "de"
                  ? "✅ Anschreiben-Daten lokal gespeichert (Server nicht verfügbar)"
                  : "✅ Anschreiben data saved locally (server unavailable)"
            
            showStatus(successMessage, "warning")
          }
        } catch (error) {
          console.error("Error saving Anschreiben data:", error)
          const errorMessage =
            getTranslation("messages.saveError") ||
            (currentLang === "uk"
              ? "Помилка збереження даних Anschreiben"
              : currentLang === "de"
                ? "Fehler beim Speichern der Anschreiben-Daten"
                : "Error saving Anschreiben data")

          showStatus(errorMessage, "error")
        }
      }

      // Show current JSON data info
      async function showCurrentDataInfo() {
        const currentLang = currentLanguage || "uk"

        try {
          // Get info for both Lebenslauf and Anschreiben files
          const [lebenslaufResponse, anschreibenResponse] = await Promise.all([
            fetch(`http://localhost:3001/api/file-info/lebenslauf/${currentLang}`),
            fetch(`http://localhost:3001/api/file-info/anschreiben/${currentLang}`)
          ])

          const lebenslaufInfo = await lebenslaufResponse.json()
          const anschreibenInfo = await anschreibenResponse.json()

          let infoMessage = ""

          if (lebenslaufInfo.exists) {
            infoMessage +=
              currentLang === "uk"
                ? `📄 Lebenslauf (${lebenslaufInfo.fileName}):\n👤 ${lebenslaufInfo.data.fullName}\n📧 ${lebenslaufInfo.data.email}\n📅 ${new Date(lebenslaufInfo.data.lastUpdated).toLocaleString()}\n\n`
                : currentLang === "de"
                  ? `📄 Lebenslauf (${lebenslaufInfo.fileName}):\n👤 ${lebenslaufInfo.data.fullName}\n📧 ${lebenslaufInfo.data.email}\n📅 ${new Date(lebenslaufInfo.data.lastUpdated).toLocaleString()}\n\n`
                  : `📄 Lebenslauf (${lebenslaufInfo.fileName}):\n👤 ${lebenslaufInfo.data.fullName}\n📧 ${lebenslaufInfo.data.email}\n📅 ${new Date(lebenslaufInfo.data.lastUpdated).toLocaleString()}\n\n`
          } else {
            infoMessage +=
              currentLang === "uk"
                ? `📄 Lebenslauf: Файл не існує\n\n`
                : currentLang === "de"
                  ? `📄 Lebenslauf: Datei existiert nicht\n\n`
                  : `📄 Lebenslauf: File does not exist\n\n`
          }

          if (anschreibenInfo.exists) {
            infoMessage +=
              currentLang === "uk"
                ? `📄 Anschreiben (${anschreibenInfo.fileName}):\n👤 ${anschreibenInfo.data.fullName}\n📧 ${anschreibenInfo.data.email}\n📅 ${new Date(anschreibenInfo.data.lastUpdated).toLocaleString()}`
                : currentLang === "de"
                  ? `📄 Anschreiben (${anschreibenInfo.fileName}):\n👤 ${anschreibenInfo.data.fullName}\n📧 ${anschreibenInfo.data.email}\n📅 ${new Date(anschreibenInfo.data.lastUpdated).toLocaleString()}`
                  : `📄 Anschreiben (${anschreibenInfo.fileName}):\n👤 ${anschreibenInfo.data.fullName}\n📧 ${anschreibenInfo.data.email}\n📅 ${new Date(anschreibenInfo.data.lastUpdated).toLocaleString()}`
          } else {
            infoMessage +=
              currentLang === "uk"
                ? `📄 Anschreiben: Файл не існує`
                : currentLang === "de"
                  ? `📄 Anschreiben: Datei existiert nicht`
                  : `📄 Anschreiben: File does not exist`
          }

          showStatus(infoMessage, "info")
        } catch (error) {
          console.error("Error loading data info:", error)
          const errorMessage =
            currentLang === "uk"
              ? "❌ Не вдалося завантажити інформацію про дані"
              : currentLang === "de"
                ? "❌ Fehler beim Laden der Dateninformationen"
                : "❌ Failed to load data information"

          showStatus(errorMessage, "error")
        }
      }

      // Clear all cache and reset form
      function clearAllCache() {
        try {
          // Clear localStorage
          localStorage.removeItem("resumeFormData")
          localStorage.removeItem("formData")

          // Reset form data
          formData = {}
          globalPhotoData = null

          // Clear all form fields
          const allInputs = document.querySelectorAll("input, textarea, select")
          allInputs.forEach(input => {
            if (input.type !== "file") {
              input.value = ""
            }
          })

          // Clear photo preview
          const photoPreview = document.getElementById("photoPreview")
          if (photoPreview) {
            photoPreview.innerHTML = '<div class="photo-placeholder">📷<br>Kein Foto</div>'
          }

          // Hide remove photo button
          const removePhotoBtn = document.getElementById("removePhotoBtn")
          if (removePhotoBtn) {
            removePhotoBtn.style.display = "none"
          }

          console.log("All cache cleared and form reset")

          // Show success message in current language
          const currentLang = currentLanguage || "uk"
          const successMessage =
            getTranslation("messages.cacheCleared") ||
            (currentLang === "uk"
              ? "Кеш очищено та форма скинута!"
              : currentLang === "de"
                ? "Cache gelöscht und Formular zurückgesetzt!"
                : "Cache cleared and form reset!")

          showStatus(successMessage, "success")

          // Update preview
          showPreview(currentPreviewType)
        } catch (error) {
          console.error("Error clearing cache:", error)
          showStatus("Помилка очищення кешу", "error")
        }
      }

      // Initialize form with default values

      // Update theme variables
      function updateThemeVariables(theme) {
        const root = document.documentElement
        if (theme === "dark") {
          root.style.setProperty("--color-background", "#1a1a1a")
          root.style.setProperty("--color-surface", "#2d2d2d")
          root.style.setProperty("--color-text", "#ffffff")
          root.style.setProperty("--color-text-light", "#cccccc")
          root.style.setProperty("--color-text-muted", "#999999")
          root.style.setProperty("--color-border", "#404040")
          root.style.setProperty("--color-hover", "#3a3a3a")
        } else {
          root.style.setProperty("--color-background", "#ffffff")
          root.style.setProperty("--color-surface", "#f8fafc")
          root.style.setProperty("--color-text", "#1f2937")
          root.style.setProperty("--color-text-light", "#6b7280")
          root.style.setProperty("--color-text-muted", "#9ca3af")
          root.style.setProperty("--color-border", "#e5e7eb")
          root.style.setProperty("--color-hover", "#f3f4f6")
        }
      }

      // Populate form with Anschreiben data
      async function populateFormWithAnschreibenData(data) {
        console.log("=== populateFormWithAnschreibenData called ===")
        console.log("Data received:", data)

        // Populate main form fields
        if (data.USER) {
          console.log("Populating USER fields:", data.USER)
          setFormValue(document, "fullName", data.USER.FULL_NAME)
          setFormValue(document, "address", data.USER.ADDRESS)
          setFormValue(document, "phone", data.USER.PHONE)
          setFormValue(document, "email", data.USER.EMAIL)
          setFormValue(document, "birthDate", data.USER.BIRTH_DATE)
          setFormValue(document, "nationality", data.USER.NATIONALITY)
        } else {
          console.log("No USER data found")
        }

        if (data.POSITION) {
          setFormValue(document, "position", data.POSITION.NAME)
          setFormValue(document, "company", data.POSITION.COMPANY)
          setFormValue(document, "jobNumber", data.POSITION.JOB_NUMBER)
          setFormValue(document, "contactName", data.POSITION.CONTACT_NAME)
          setFormValue(document, "contactAddress", data.POSITION.CONTACT_ADDRESS)
          setFormValue(document, "contactPhone", data.POSITION.CONTACT_PHONE)
          setFormValue(document, "contactEmail", data.POSITION.CONTACT_EMAIL)
        }

        if (data.LETTER) {
          setFormValue(document, "subject", data.LETTER.SUBJECT)
          setFormValue(document, "subjectColor", data.LETTER.SUBJECT_COLOR)
          setFormValue(document, "greeting", data.LETTER.GREETING)
          setFormValue(document, "motivation", data.LETTER.MOTIVATION || data.CONTENT?.motivation)
          setFormValue(
            document,
            "qualifications",
            data.LETTER.QUALIFICATIONS || data.CONTENT?.qualifications
          )
          setFormValue(document, "tasks", data.LETTER.TASKS || data.CONTENT?.tasks)
          setFormValue(document, "future", data.LETTER.FUTURE || data.CONTENT?.future)
          setFormValue(
            document,
            "availability",
            data.LETTER.AVAILABILITY || data.CONTENT?.availability
          )
          setFormValue(document, "closing", data.LETTER.CLOSING)
          setFormValue(document, "signature", data.LETTER.SIGNATURE)
        }

        // Update form data
        updateFormData()

        console.log("Form data after populateFormWithAnschreibenData:", formData)
        console.log("Full name after update:", formData.fullName)
        console.log("Address after update:", formData.address)

        // Show preview
        console.log("About to show preview for bewerbung")
        await showPreview("bewerbung")
      }

      // Populate form with Lebenslauf data
      async function populateFormWithLebenslaufData(data) {
        console.log("=== populateFormWithLebenslaufData called ===")
        console.log("Current language:", currentLanguage)
        console.log("Data received:", data)
        console.log("Data type:", typeof data)
        console.log("Data keys:", Object.keys(data))
        console.log("Sample data values:")
        console.log("  fullName:", data.fullName)
        console.log("  nationality:", data.nationality)
        console.log("  summary:", data.summary?.substring(0, 50) + "...")
        console.log("Stack trace:", new Error().stack)

        try {
          // Switch to Lebenslauf tab
          console.log("Switching to lebenslauf tab...")
          await switchFormTab("lebenslauf")
          console.log("Switched to lebenslauf tab successfully")
        } catch (switchError) {
          console.error("Error switching to lebenslauf tab:", switchError)
          // Don't throw the error, just log it and continue
          console.log("Continuing without tab switch...")
        }

        // Personal info - populate both forms (data is direct, not nested in personalInfo)
        console.log("Checking data.fullName:", data.fullName)
        if (data.fullName) {
          console.log("Populating personal info fields...")

          // Bewerbung form
          const bewerbungForm = document.getElementById("bewerbungForm")
          console.log("Bewerbung form found:", !!bewerbungForm)

          setFormValue(bewerbungForm, "fullName", data.fullName)
          setFormValue(bewerbungForm, "address", data.address)
          setFormValue(bewerbungForm, "phone", data.phone)
          setFormValue(bewerbungForm, "email", data.email)
          setFormValue(bewerbungForm, "birthDate", data.birthDate)
          setFormValue(bewerbungForm, "nationality", data.nationality)
          setFormValue(bewerbungForm, "residenceStatus", data.residenceStatus)

          // Lebenslauf form
          console.log("Populating Lebenslauf form fields...")
          setFormValue(document, "lebenslaufFullName", data.fullName)
          setFormValue(document, "lebenslaufAddress", data.address)
          setFormValue(document, "lebenslaufPhone", data.phone)
          setFormValue(document, "lebenslaufEmail", data.email)
          setFormValue(document, "lebenslaufBirthDate", data.birthDate)
          setFormValue(document, "lebenslaufNationality", data.nationality)

          console.log("Personal info fields populated")
        } else {
          console.log("No fullName found in data, skipping personal info")
        }

        // Professional summary
        console.log("Checking data.summary:", data.summary)
        if (data.summary) {
          console.log("Setting summary field")
          setFormValue(document, "lebenslaufSummary", data.summary)
        }

        // Skills
        console.log("Checking data.skills:", data.skills)
        if (data.skills) {
          const skillsText = Array.isArray(data.skills) ? data.skills.join("\n") : data.skills
          console.log("Setting skills field:", skillsText)
          setFormValue(document, "lebenslaufSkills", skillsText)
        }

        // Experience
        console.log("Checking data.experience:", data.experience)
        if (data.experience) {
          const experienceText = Array.isArray(data.experience)
            ? data.experience
                .map(exp => `${exp.position} | ${exp.company}\n${exp.period}\n${exp.description}`)
                .join("\n\n")
            : data.experience
          console.log("Setting experience field:", experienceText)
          setFormValue(document, "lebenslaufExperience", experienceText)
        }

        // Education
        console.log("Checking data.education:", data.education)
        if (data.education) {
          const educationText = Array.isArray(data.education)
            ? data.education
                .map(edu => `${edu.degree}\n${edu.institution}\n${edu.period}`)
                .join("\n\n")
            : data.education
          console.log("Setting education field:", educationText)
          setFormValue(document, "lebenslaufEducation", educationText)
        }

        // Languages
        console.log("Checking data.languages:", data.languages)
        if (data.languages) {
          const languagesText = Array.isArray(data.languages)
            ? data.languages.map(lang => `${lang.language} - ${lang.level}`).join("\n")
            : data.languages
          console.log("Setting languages field:", languagesText)
          setFormValue(document, "lebenslaufLanguages", languagesText)
        }

        // Additional qualifications
        console.log("Checking data.additional:", data.additional)
        if (data.additional) {
          const additionalText = Array.isArray(data.additional)
            ? data.additional.join("\n")
            : data.additional
          console.log("Setting additional field:", additionalText)
          setFormValue(document, "lebenslaufAdditional", additionalText)
        }

        // Photo - Handle photo from JSON data
        console.log("Checking data.photo:", data.photo ? "Photo exists" : "No photo")
        if (data.photo && typeof data.photo === "string") {
          console.log("=== LOADING PHOTO FROM JSON DATA ===")
          console.log("Photo data type:", typeof data.photo)
          console.log("Photo data length:", data.photo.length)
          console.log("Photo starts with data:image/:", data.photo.startsWith("data:image/"))
          
          // Save photo to global variable and formData
          globalPhotoData = data.photo
          formData.lebenslaufPhoto = data.photo
          formData.photo = data.photo
          
          // Display photo in preview
          const photoPreview = document.getElementById("photoPreview")
          if (photoPreview) {
            console.log("Updating photo preview with loaded image")
            photoPreview.innerHTML = `<img src="${data.photo}" alt="Uploaded photo" style="max-width: 100%; max-height: 200px; border-radius: 8px;" />`
            
            // Show remove button
            const removePhotoBtn = document.getElementById("removePhoto")
            if (removePhotoBtn) {
              removePhotoBtn.style.display = "block"
              console.log("Remove photo button shown")
            }
          } else {
            console.log("Photo preview element not found")
          }
          
          console.log("Photo loaded from JSON and saved to globalPhotoData and formData")
          saveFormData() // Save to localStorage
        } else {
          console.log("No valid photo data in JSON file")
        }

        // Update preview
        console.log("Updating preview...")
        try {
          await showPreview("lebenslauf")
          console.log("Preview updated successfully")
        } catch (previewError) {
          console.error("Error updating preview:", previewError)
          throw previewError
        }
      }

      // Helper function to set form values
      function setFormValue(form, fieldName, value) {
        let field
        if (form === document) {
          field = document.getElementById(fieldName)
        } else {
          field = form.querySelector(`[name="${fieldName}"]`)
        }

        if (field) {
          const oldValue = field.value
          console.log(`🔄 setFormValue: ${fieldName}`)
          console.log(`   Old value: "${oldValue}"`)
          console.log(`   New value: "${value}"`)
          console.log(`   Current language: ${currentLanguage}`)
          console.log(`   Stack trace:`, new Error().stack.split("\n")[1])
          field.value = value
          // Trigger input event to update form data
          field.dispatchEvent(new Event("input", {bubbles: true}))
          console.log(`Field ${fieldName} value after setting:`, field.value)
        } else {
          console.log(`Field ${fieldName} not found`)
        }
      }

      // Switch between form tabs
      async function switchFormTab(tabName) {
        console.log("Switching to tab:", tabName)

        // Update tab buttons
        const tabButtons = document.querySelectorAll(".form-tab-button")
        console.log("Found tab buttons:", tabButtons.length)
        tabButtons.forEach(button => button.classList.remove("active"))

        const activeButton = document.querySelector(
          `[onclick="switchFormTab('${tabName}').catch(console.error)"]`
        )
        console.log("Active button found:", activeButton)
        if (activeButton) {
          activeButton.classList.add("active")
        }

        // Show/hide form sections
        const bewerbungSection = document.getElementById("bewerbungFormSection")
        const lebenslaufSection = document.getElementById("lebenslaufSection")

        console.log("Bewerbung section:", bewerbungSection)
        console.log("Lebenslauf section:", lebenslaufSection)

        if (tabName === "bewerbung") {
          if (bewerbungSection) bewerbungSection.style.display = "block"
          if (lebenslaufSection) lebenslaufSection.style.display = "none"
        } else if (tabName === "lebenslauf") {
          if (bewerbungSection) bewerbungSection.style.display = "none"
          if (lebenslaufSection) lebenslaufSection.style.display = "block"
        }

        // Update current preview type
        currentPreviewType = tabName

        // Update preview to show corresponding document
        console.log("About to show preview for tab:", tabName)
        console.log("Current preview type set to:", currentPreviewType)
        console.log(
          "Current formData.lebenslaufPhoto:",
          formData.lebenslaufPhoto ? "Present" : "Missing"
        )

        // Update form data before showing preview
        updateFormData()

        // Save current state
        saveFormData()

        setTimeout(async () => {
          await showPreview(tabName)
        }, 100)
      }

      // Update form data from all form inputs
      function updateFormData() {
        console.log("=== updateFormData called ===")

        // Preserve existing photo data before updating
        const existingPhoto = formData.lebenslaufPhoto || globalPhotoData
        const existingAnschreibenPhoto = formData.anschreibenPhoto
        console.log("Existing photo data:", existingPhoto ? "Present" : "Missing")
        console.log(
          "Existing anschreiben photo data:",
          existingAnschreibenPhoto ? "Present" : "Missing"
        )
        console.log("Global photo data:", globalPhotoData ? "Present" : "Missing")

        // Update from main form
        const form = document.getElementById("bewerbungForm")
        if (form) {
          const formDataObj = new FormData(form)
          const newFormData = Object.fromEntries(formDataObj)
          console.log("Main form data:", newFormData)
          console.log("FormData entries:")
          for (let [key, value] of formDataObj.entries()) {
            console.log(`${key}: ${value}`)
          }
          formData = {...formData, ...newFormData}
          console.log("Updated formData:", formData)
        }

        // Update from Lebenslauf section
        const lebenslaufSection = document.getElementById("lebenslaufSection")
        if (lebenslaufSection) {
          const lebenslaufInputs = lebenslaufSection.querySelectorAll("input, textarea, select")
          console.log("Found Lebenslauf inputs:", lebenslaufInputs.length)
          lebenslaufInputs.forEach(input => {
            if (input.name) {
              console.log(`Updating ${input.name}:`, input.value)
              formData[input.name] = input.value

              // Also map to main form fields for compatibility
              if (input.name === "lebenslaufFullName") {
                formData.fullName = input.value
              } else if (input.name === "lebenslaufAddress") {
                formData.address = input.value
              } else if (input.name === "lebenslaufPhone") {
                formData.phone = input.value
              } else if (input.name === "lebenslaufEmail") {
                formData.email = input.value
              } else if (input.name === "lebenslaufBirthDate") {
                formData.birthDate = input.value
              } else if (input.name === "lebenslaufNationality") {
                formData.nationality = input.value
              }
            }
          })
        }

        // Restore photo data if it existed
        if (existingPhoto) {
          formData.lebenslaufPhoto = existingPhoto
          console.log("Photo data restored:", formData.lebenslaufPhoto ? "Yes" : "No")
          console.log("Restored photo data:", formData.lebenslaufPhoto)
          console.log("Restored photo data type:", typeof formData.lebenslaufPhoto)
          console.log(
            "Restored photo data length:",
            formData.lebenslaufPhoto ? formData.lebenslaufPhoto.length : 0
          )
        } else {
          console.log("No existing photo to restore")
        }

        // Restore Anschreiben photo data if it existed
        if (existingAnschreibenPhoto) {
          formData.anschreibenPhoto = existingAnschreibenPhoto
          console.log("Anschreiben photo data restored:", formData.anschreibenPhoto ? "Yes" : "No")
          console.log("Restored anschreiben photo data:", formData.anschreibenPhoto)
          console.log("Restored anschreiben photo data type:", typeof formData.anschreibenPhoto)
          console.log(
            "Restored anschreiben photo data length:",
            formData.anschreibenPhoto ? formData.anschreibenPhoto.length : 0
          )
        } else {
          console.log("No existing anschreiben photo to restore")
        }

        console.log("=== UPDATE FORM DATA DEBUG ===")
        console.log("Final formData after updateFormData:", formData)
        console.log("Final globalPhotoData after updateFormData:", globalPhotoData)
        console.log("Photo in formData after updateFormData:", formData.lebenslaufPhoto)
        console.log("Photo exists check:", formData.lebenslaufPhoto ? "Yes" : "No")
        console.log("Photo type:", typeof formData.lebenslaufPhoto)
        console.log("Photo length:", formData.lebenslaufPhoto ? formData.lebenslaufPhoto.length : 0)
        console.log(
          "Photo starts with data:image/:",
          formData.lebenslaufPhoto && typeof formData.lebenslaufPhoto === "string"
            ? formData.lebenslaufPhoto.startsWith("data:image/")
            : false
        )
        console.log(
          "Photo starts with blob:",
          formData.lebenslaufPhoto && typeof formData.lebenslaufPhoto === "string"
            ? formData.lebenslaufPhoto.startsWith("blob:")
            : false
        )

        // Save form data to localStorage
        saveFormData()
      }

      // Debounce function to prevent too many updates
      function debounce(func, wait) {
        let timeout
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout)
            func(...args)
          }
          clearTimeout(timeout)
          timeout = setTimeout(later, wait)
        }
      }

      // Auto-update preview when user types
      async function updatePreviewOnInput() {
        console.log("=== updatePreviewOnInput called ===")
        console.log("Timestamp:", new Date().toISOString())
        updateFormData()

        console.log("Current preview type:", currentPreviewType)
        console.log("Form data after update:", formData)
        console.log("Birth date:", formData.birthDate)
        console.log("Full name:", formData.fullName)
        console.log("Address:", formData.address)
        console.log("Lebenslauf photo:", formData.lebenslaufPhoto ? "Present" : "Missing")
        console.log("Anschreiben photo:", formData.anschreibenPhoto ? "Present" : "Missing")
        console.log("Global photo data:", globalPhotoData ? "Present" : "Missing")

        // Detailed photo analysis
        if (formData.lebenslaufPhoto) {
          console.log("Lebenslauf photo details:")
          console.log("- Type:", typeof formData.lebenslaufPhoto)
          console.log("- Length:", formData.lebenslaufPhoto.length)
          if (typeof formData.lebenslaufPhoto === "string") {
            console.log(
              "- Starts with data:image/:",
              formData.lebenslaufPhoto.startsWith("data:image/")
            )
            console.log("- Starts with blob:", formData.lebenslaufPhoto.startsWith("blob:"))
          } else {
            console.log("- Not a string, cannot check startsWith")
          }
        }

        if (formData.anschreibenPhoto) {
          console.log("Anschreiben photo details:")
          console.log("- Type:", typeof formData.anschreibenPhoto)
          console.log("- Length:", formData.anschreibenPhoto.length)
          if (typeof formData.anschreibenPhoto === "string") {
            console.log(
              "- Starts with data:image/:",
              formData.anschreibenPhoto.startsWith("data:image/")
            )
            console.log("- Starts with blob:", formData.anschreibenPhoto.startsWith("blob:"))
          } else {
            console.log("- Not a string, cannot check startsWith")
          }
        }

        // Determine which preview to show based on active tab
        const activeTab = document.querySelector(".form-tab-button.active")
        let previewType = currentPreviewType

        if (activeTab) {
          if (
            activeTab.textContent.includes("Anschreiben") ||
            activeTab.textContent.includes("Cover Letter") ||
            activeTab.textContent.includes("Лист заявки")
          ) {
            previewType = "bewerbung"
          } else if (
            activeTab.textContent.includes("Lebenslauf") ||
            activeTab.textContent.includes("Resume") ||
            activeTab.textContent.includes("Резюме")
          ) {
            previewType = "lebenslauf"
          }
        }

        console.log("Active tab:", activeTab ? activeTab.textContent : "none")
        console.log("Preview type determined:", previewType)

        // Update preview with current data using the determined type
        await showPreview(previewType)
      }

      // Debounced version of preview update
      const debouncedUpdatePreview = debounce(updatePreviewOnInput, 300)

      // Photo upload functionality
      function initializePhotoUpload() {
        console.log("=== initializePhotoUpload called ===")
        console.log("Current timestamp:", new Date().toISOString())
        console.log("Document ready state:", document.readyState)

        const photoInput = document.getElementById("lebenslaufPhoto")
        const photoPreview = document.getElementById("photoPreview")
        const removePhotoBtn = document.getElementById("removePhoto")

        console.log("Photo input found:", !!photoInput)
        console.log("Photo input element:", photoInput)
        console.log("Photo preview found:", !!photoPreview)
        console.log("Photo preview element:", photoPreview)
        console.log("Remove photo button found:", !!removePhotoBtn)
        console.log("Remove photo button element:", removePhotoBtn)

        // Check if elements are in DOM
        console.log("Photo input in DOM:", document.contains(photoInput))
        console.log("Photo preview in DOM:", document.contains(photoPreview))

        if (photoInput && photoPreview) {
          console.log("Adding event listener to photo input")
          photoInput.addEventListener("change", function (e) {
            console.log("=== PHOTO INPUT CHANGE EVENT TRIGGERED ===")
            console.log("Event:", e)
            console.log("Target:", e.target)
            console.log("Files:", e.target.files)
            console.log("Files length:", e.target.files ? e.target.files.length : "no files")

            const file = e.target.files[0]
            console.log("Selected file:", file)
            if (file) {
              // Show loading indicator
              photoPreview.innerHTML = `
                <div class="photo-loading" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px;">
                  <div class="loading-spinner" style="width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px;"></div>
                  <span style="color: #6c757d; font-size: 14px;">Завантаження фото...</span>
                </div>
              `

              // Validate file type
              if (!file.type.startsWith("image/")) {
                const errorMsg =
                  getTranslation("errors.invalidFileType") || "Будь ласка, виберіть файл зображення"
                alert(errorMsg)
                return
              }

              // Validate file size (max 5MB)
              if (file.size > 5 * 1024 * 1024) {
                const errorMsg =
                  getTranslation("errors.fileTooLarge") ||
                  "Файл занадто великий. Максимальний розмір: 5MB"
                alert(errorMsg)
                return
              }

              // Additional validation
              if (file.size === 0) {
                alert("Файл порожній")
                return
              }

              console.log("Processing photo file:", file.name, file.type, file.size)

              const reader = new FileReader()

              reader.onload = function (e) {
                try {
                  console.log("=== PHOTO LOADED SUCCESSFULLY ===")
                  console.log("Event:", e)
                  console.log("Target:", e.target)
                  console.log("Result type:", typeof e.target.result)
                  console.log(
                    "Result length:",
                    e.target.result ? e.target.result.length : "no result"
                  )

                  const result = e.target.result

                  // Validate that we got a proper data URL
                  if (!result || typeof result !== "string" || !result.startsWith("data:image/")) {
                    throw new Error("Invalid image data received")
                  }

                  console.log("Photo data URL length:", result.length)
                  console.log("Photo data URL starts with:", result.substring(0, 50))

                  // Show success indicator
                  photoPreview.innerHTML = `
                    <div class="photo-success" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; background: #d4edda; border: 2px solid #c3e6cb; border-radius: 8px;">
                      <div style="color: #155724; font-size: 24px; margin-bottom: 10px;">✅</div>
                      <span style="color: #155724; font-size: 14px;">Фото завантажено успішно!</span>
                    </div>
                  `

                  // Wait a moment then show the actual image
                  setTimeout(() => {
                    console.log("=== DISPLAYING PHOTO ===")
                    console.log("Setting photoPreview.innerHTML with image")
                    photoPreview.innerHTML = `<img src="${result}" alt="Uploaded photo" style="max-width: 100%; max-height: 200px; border-radius: 8px;" />`
                    console.log("Photo preview updated, checking if image is visible")

                    // Check if image is actually visible
                    const img = photoPreview.querySelector("img")
                    console.log("Image element:", img)
                    console.log("Image src:", img ? img.src : "no image")
                    console.log("Image complete:", img ? img.complete : "no image")
                    console.log("Image naturalWidth:", img ? img.naturalWidth : "no image")
                    console.log("Image naturalHeight:", img ? img.naturalHeight : "no image")

                    if (removePhotoBtn) {
                      removePhotoBtn.style.display = "block"
                      console.log("Remove photo button shown")
                    }
                  }, 1000)

                  // Update form data with photo
                  formData.lebenslaufPhoto = result
                  globalPhotoData = result // Also save to global variable
                  console.log("=== PHOTO UPLOAD DEBUG ===")
                  console.log("Photo uploaded and saved to formData and globalPhotoData")
                  console.log("Current formData after photo upload:", formData)
                  console.log("Current globalPhotoData after photo upload:", globalPhotoData)
                  console.log("Photo type:", typeof result)
                  console.log("Photo length:", result.length)
                  console.log("Photo starts with data:image/:", result.startsWith("data:image/"))
                  saveFormData() // Save to localStorage
                  updatePreviewOnInput()
                } catch (error) {
                  console.error("Error displaying photo:", error)
                  const errorMsg =
                    getTranslation("errors.photoDisplayError") || "Помилка при відображенні фото"
                  alert(errorMsg)
                }
              }

              reader.onerror = function (error) {
                console.error("Error reading file:", error)
                const errorMsg =
                  getTranslation("errors.fileReadError") || "Помилка при читанні файлу"
                alert(errorMsg)
              }

              reader.onabort = function (error) {
                console.error("File read aborted:", error)
                alert("Читання файлу перервано")
              }

              try {
                console.log("Starting to read file as data URL...")
                reader.readAsDataURL(file)
              } catch (error) {
                console.error("Error starting file read:", error)

                // Fallback: try using URL.createObjectURL
                try {
                  console.log("Trying fallback method with URL.createObjectURL...")
                  const objectURL = URL.createObjectURL(file)
                  console.log("Object URL created:", objectURL)

                  photoPreview.innerHTML = `<img src="${objectURL}" alt="Uploaded photo" />`
                  if (removePhotoBtn) {
                    removePhotoBtn.style.display = "block"
                  }

                  // Update form data with object URL
                  formData.lebenslaufPhoto = objectURL
                  globalPhotoData = objectURL // Also save to global variable
                  console.log("Photo uploaded using fallback method and saved to globalPhotoData")
                  console.log("Current formData after fallback photo upload:", formData)
                  console.log(
                    "Current globalPhotoData after fallback photo upload:",
                    globalPhotoData
                  )
                  saveFormData() // Save to localStorage
                  updatePreviewOnInput()
                } catch (fallbackError) {
                  console.error("Fallback method also failed:", fallbackError)
                  const errorMsg =
                    getTranslation("errors.fileUploadError") || "Помилка при завантаженні файлу"
                  alert(errorMsg)
                }
              }
            }
          })
        }

        if (removePhotoBtn) {
          removePhotoBtn.addEventListener("click", function () {
            photoInput.value = ""

            // Clean up object URL if it exists
            if (
              formData.lebenslaufPhoto &&
              typeof formData.lebenslaufPhoto === "string" &&
              formData.lebenslaufPhoto.startsWith("blob:")
            ) {
              URL.revokeObjectURL(formData.lebenslaufPhoto)
            }

            photoPreview.innerHTML = `
                    <div class="photo-placeholder">
                      <span class="photo-icon">📷</span>
                      <span data-translate="lebenslauf.photoPlaceholder">Foto hochladen</span>
                    </div>
                  `
            removePhotoBtn.style.display = "none"

            // Remove photo from form data
            delete formData.lebenslaufPhoto
            globalPhotoData = null // Also clear global variable
            saveFormData() // Save to localStorage
            updatePreviewOnInput()
          })
        }

        console.log("=== initializePhotoUpload completed ===")
        console.log("Event listener added:", photoInput ? "Yes" : "No")
        console.log("Photo preview element ready:", photoPreview ? "Yes" : "No")
      }

      // Photo upload functionality for Anschreiben
      function initializeAnschreibenPhotoUpload() {
        console.log("=== initializeAnschreibenPhotoUpload called ===")
        console.log("Current timestamp:", new Date().toISOString())
        console.log("Document ready state:", document.readyState)

        const photoInput = document.getElementById("anschreibenPhoto")
        const photoPreview = document.getElementById("anschreibenPhotoPreview")
        const removePhotoBtn = document.getElementById("removeAnschreibenPhoto")

        console.log("Anschreiben photo input found:", !!photoInput)
        console.log("Anschreiben photo input element:", photoInput)
        console.log("Anschreiben photo preview found:", !!photoPreview)
        console.log("Anschreiben photo preview element:", photoPreview)
        console.log("Anschreiben remove photo button found:", !!removePhotoBtn)
        console.log("Anschreiben remove photo button element:", removePhotoBtn)

        // Check if elements are in DOM
        console.log("Anschreiben photo input in DOM:", document.contains(photoInput))
        console.log("Anschreiben photo preview in DOM:", document.contains(photoPreview))

        if (photoInput && photoPreview) {
          console.log("Adding event listener to Anschreiben photo input")
          photoInput.addEventListener("change", function (e) {
            console.log("=== ANSCHREIBEN PHOTO INPUT CHANGE EVENT TRIGGERED ===")
            console.log("Event:", e)
            console.log("Target:", e.target)
            console.log("Files:", e.target.files)
            console.log("Files length:", e.target.files ? e.target.files.length : "no files")

            const file = e.target.files[0]
            console.log("Selected Anschreiben file:", file)
            if (file) {
              // Validate file type
              if (!file.type.startsWith("image/")) {
                const errorMsg =
                  getTranslation("errors.invalidFileType") || "Будь ласка, виберіть файл зображення"
                alert(errorMsg)
                return
              }

              // Validate file size (max 5MB)
              if (file.size > 5 * 1024 * 1024) {
                const errorMsg =
                  getTranslation("errors.fileTooLarge") || "Файл занадто великий. Максимум 5MB"
                alert(errorMsg)
                return
              }

              console.log("Anschreiben photo file selected:", file.name, file.size, file.type)

              // Show loading indicator
              photoPreview.innerHTML = `
                <div class="photo-loading" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px;">
                  <div class="loading-spinner" style="width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px;"></div>
                  <span style="color: #6c757d; font-size: 14px;">Завантаження фото...</span>
                </div>
              `

              // Try to read file as data URL first
              const reader = new FileReader()
              reader.onload = function (e) {
                try {
                  console.log("=== ANSCHREIBEN PHOTO LOADED SUCCESSFULLY ===")
                  const result = e.target.result
                  console.log("Anschreiben photo data URL length:", result.length)
                  console.log("Anschreiben photo data URL starts with:", result.substring(0, 50))

                  // Show success indicator
                  photoPreview.innerHTML = `
                    <div class="photo-success" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; background: #d4edda; border: 2px solid #c3e6cb; border-radius: 8px;">
                      <div style="color: #155724; font-size: 24px; margin-bottom: 10px;">✅</div>
                      <span style="color: #155724; font-size: 14px;">Фото завантажено успішно!</span>
                    </div>
                  `

                  // Wait a moment then show the actual image
                  setTimeout(() => {
                    console.log("=== DISPLAYING ANSCHREIBEN PHOTO ===")
                    photoPreview.innerHTML = `<img src="${result}" alt="Uploaded photo" style="max-width: 100%; max-height: 200px; border-radius: 8px;" />`
                    console.log("Anschreiben photo preview updated")
                  }, 1000)
                  if (removePhotoBtn) {
                    removePhotoBtn.style.display = "block"
                  }

                  // Update form data with photo
                  formData.anschreibenPhoto = result
                  console.log("=== ANSCHREIBEN PHOTO UPLOAD DEBUG ===")
                  console.log("Anschreiben photo uploaded and saved to formData")
                  console.log("Current formData after anschreiben photo upload:", formData)
                  console.log("Photo type:", typeof result)
                  console.log("Photo length:", result.length)
                  console.log("Photo starts with data:image/:", result.startsWith("data:image/"))
                  saveFormData() // Save to localStorage
                  updatePreviewOnInput()
                } catch (error) {
                  console.error("Error displaying anschreiben photo:", error)
                  const errorMsg =
                    getTranslation("errors.photoDisplayError") || "Помилка при відображенні фото"
                  alert(errorMsg)
                }
              }

              reader.onerror = function () {
                console.log("FileReader failed, trying fallback method...")
                try {
                  console.log("Trying fallback method with URL.createObjectURL...")
                  const objectURL = URL.createObjectURL(file)
                  console.log("Object URL created:", objectURL)

                  photoPreview.innerHTML = `<img src="${objectURL}" alt="Uploaded photo" />`
                  if (removePhotoBtn) {
                    removePhotoBtn.style.display = "block"
                  }

                  // Update form data with object URL
                  formData.anschreibenPhoto = objectURL
                  console.log("Anschreiben photo uploaded using fallback method")
                  console.log("Current formData after fallback anschreiben photo upload:", formData)
                  saveFormData() // Save to localStorage
                  updatePreviewOnInput()
                } catch (fallbackError) {
                  console.error("Fallback method also failed:", fallbackError)
                  const errorMsg =
                    getTranslation("errors.fileUploadError") || "Помилка при завантаженні файлу"
                  alert(errorMsg)
                }
              }

              reader.readAsDataURL(file)
            }
          })
        }

        if (removePhotoBtn) {
          removePhotoBtn.addEventListener("click", function () {
            photoInput.value = ""

            // Clean up object URL if it exists
            if (
              formData.anschreibenPhoto &&
              typeof formData.anschreibenPhoto === "string" &&
              formData.anschreibenPhoto.startsWith("blob:")
            ) {
              URL.revokeObjectURL(formData.anschreibenPhoto)
            }

            photoPreview.innerHTML = `
                    <div class="photo-placeholder">
                      <span class="photo-icon">📷</span>
                      <span data-translate="lebenslauf.photoPlaceholder">Foto hochladen</span>
                    </div>
                  `
            removePhotoBtn.style.display = "none"

            // Remove photo from form data
            delete formData.anschreibenPhoto
            saveFormData() // Save to localStorage
            updatePreviewOnInput()
          })
        }

        console.log("=== initializeAnschreibenPhotoUpload completed ===")
        console.log("Anschreiben event listener added:", photoInput ? "Yes" : "No")
        console.log("Anschreiben photo preview element ready:", photoPreview ? "Yes" : "No")
      }

      // Function to remove Anschreiben photo (called from HTML)
      function removeAnschreibenPhoto() {
        const photoInput = document.getElementById("anschreibenPhoto")
        const photoPreview = document.getElementById("anschreibenPhotoPreview")
        const removePhotoBtn = document.getElementById("removeAnschreibenPhoto")

        if (photoInput) photoInput.value = ""

        // Clean up object URL if it exists
        if (
          formData.anschreibenPhoto &&
          typeof formData.anschreibenPhoto === "string" &&
          formData.anschreibenPhoto.startsWith("blob:")
        ) {
          URL.revokeObjectURL(formData.anschreibenPhoto)
        }

        if (photoPreview) {
          photoPreview.innerHTML = `
            <div class="photo-placeholder">
              <span class="photo-icon">📷</span>
              <span data-translate="lebenslauf.photoPlaceholder">Foto hochladen</span>
            </div>
          `
        }

        if (removePhotoBtn) {
          removePhotoBtn.style.display = "none"
        }

        // Remove photo from form data
        delete formData.anschreibenPhoto
        saveFormData() // Save to localStorage
        updatePreviewOnInput()
      }

      function initializeForm() {
        // Try to load saved data first
        const dataLoaded = loadFormData()

        if (!dataLoaded) {
          // If no saved data, initialize with form values
          const form = document.getElementById("bewerbungForm")
          const formDataObj = new FormData(form)
          formData = Object.fromEntries(formDataObj)
        }

        // Add event listeners for real-time preview updates
        addFormEventListeners()
      }

      // Add event listeners to form fields for real-time updates
      function addFormEventListeners() {
        // Remove existing listeners first to avoid duplicates
        removeFormEventListeners()

        // Add listeners to all forms and sections
        const sections = [
          document.getElementById("bewerbungForm"),
          document.getElementById("lebenslaufSection")
        ]

        sections.forEach(section => {
          if (section) {
            const inputs = section.querySelectorAll("input, textarea, select")
            console.log(`Adding listeners to ${section.id}:`, inputs.length, "inputs")
            inputs.forEach(input => {
              // Add multiple event listeners for better tracking
              input.addEventListener("input", e => {
                console.log(`Input event on ${input.name || input.id}:`, e.target.value)
                debouncedUpdatePreview()
              })
              input.addEventListener("change", e => {
                console.log(`Change event on ${input.name || input.id}:`, e.target.value)
                debouncedUpdatePreview()
              })
              input.addEventListener("keyup", e => {
                console.log(`Keyup event on ${input.name || input.id}:`, e.target.value)
                debouncedUpdatePreview()
              })
              input.addEventListener("paste", () => {
                console.log(`Paste event on ${input.name || input.id}`)
                // Small delay to allow paste content to be processed
                setTimeout(debouncedUpdatePreview, 10)
              })
            })
          }
        })
      }

      // Remove existing event listeners to prevent duplicates
      function removeFormEventListeners() {
        const sections = [
          document.getElementById("bewerbungForm"),
          document.getElementById("lebenslaufSection")
        ]

        sections.forEach(section => {
          if (section) {
            const inputs = section.querySelectorAll("input, textarea, select")
            inputs.forEach(input => {
              // Clone the input to remove all event listeners
              const newInput = input.cloneNode(true)
              input.parentNode.replaceChild(newInput, input)
            })
          }
        })
      }

      // Show status message
      function showStatus(message, type = "info") {
        const statusEl = document.getElementById("statusMessage")

        // Clear any existing timeout
        if (statusEl.timeoutId) {
          clearTimeout(statusEl.timeoutId)
        }

        statusEl.textContent = message
        statusEl.className = `status-message status-${type}`
        statusEl.style.display = "block"

        // Set timeout to hide the message (increased to 10 seconds)
        statusEl.timeoutId = setTimeout(() => {
          statusEl.style.display = "none"
          statusEl.timeoutId = null
        }, 10000)
      }

      // Clear status message immediately
      function clearStatus() {
        const statusEl = document.getElementById("statusMessage")
        if (statusEl.timeoutId) {
          clearTimeout(statusEl.timeoutId)
          statusEl.timeoutId = null
        }
        statusEl.style.display = "none"
        statusEl.textContent = ""
      }

      // Generate preview
      async function generatePreview() {
        const form = document.getElementById("bewerbungForm")
        const formDataObj = new FormData(form)
        formData = Object.fromEntries(formDataObj)

        showStatus("Vorschau wird generiert...", "info")

        // Show preview immediately
        await showPreview("bewerbung")

        // Simulate preview generation
        setTimeout(() => {
          showStatus("Vorschau erfolgreich generiert!", "success")
        }, 1000)
      }

      // Show preview tab
      // Функція автоматичного розподілу контенту на сторінки
      function createMultiPagePreview(content) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = content;
        tempDiv.style.position = 'absolute';
        tempDiv.style.top = '-9999px';
        tempDiv.style.width = '170mm'; // 210mm - 40mm padding
        tempDiv.style.fontSize = '11pt';
        tempDiv.style.lineHeight = '1.5';
        tempDiv.style.fontFamily = 'Times New Roman, serif';
        tempDiv.className = 'document-preview';
        document.body.appendChild(tempDiv);

        const maxHeight = 257; // 297mm - 40mm padding = 257mm approx
        const pages = [];
        const elements = Array.from(tempDiv.children);

        let currentPageContent = [];
        let currentHeight = 0;

        for (let element of elements) {
          const elementHeight = element.offsetHeight + 10; // додаємо відступ

          // Якщо елемент не поміщається на поточній сторінці
          if (currentHeight + elementHeight > maxHeight && currentPageContent.length > 0) {
            pages.push(currentPageContent.join(''));
            currentPageContent = [];
            currentHeight = 0;
          }

          currentPageContent.push(element.outerHTML);
          currentHeight += elementHeight;
        }

        // Додаємо останню сторінку
        if (currentPageContent.length > 0) {
          pages.push(currentPageContent.join(''));
        }

        document.body.removeChild(tempDiv);

        // Створюємо HTML для декількох сторінок
        return pages.map((pageContent, index) => `
          <div class="document-page">
            <div class="document-preview">
              ${pageContent}
            </div>
          </div>
        `).join('');
      }

      async function showPreview(type) {
        try {
          // Update current preview type
          currentPreviewType = type

          console.log(
            "showPreview called with type:",
            type,
            "currentLanguage:",
            currentLanguage,
            "currentPreviewType set to:",
            currentPreviewType
          )

          // Ensure translations are loaded
          if (!translations[currentLanguage]) {
            console.log("Loading translations for", currentLanguage)
            await loadTranslations(currentLanguage)
          }

          // Double check that translations are loaded
          if (!translations[currentLanguage]) {
            console.error("Failed to load translations for", currentLanguage)
            return
          }

          // Add delay to ensure translations are fully loaded
          console.log("Waiting for translations to be fully loaded...")
          await new Promise(resolve => setTimeout(resolve, 150))

          // Debug translations
          console.log("Available translations:", Object.keys(translations))
          console.log("Current language translations:", translations[currentLanguage])
          if (translations[currentLanguage]) {
            console.log(
              "lebenslaufInputValues:",
              translations[currentLanguage].lebenslaufInputValues
            )
          }

          // Save current state
          saveFormData()
          const tabs = document.querySelectorAll(".preview-tab")
          tabs.forEach(tab => tab.classList.remove("active"))

          // Find the correct tab and activate it
          const targetTab = Array.from(tabs).find(tab =>
            tab.textContent.includes(type === "bewerbung" ? "Anschreiben" : "Lebenslauf")
          )
          console.log("targetTab found:", targetTab)
          if (targetTab) {
            targetTab.classList.add("active")
          }

          if (type === "bewerbung") {
            const previewTitle = getTranslation("preview.letter") || "Vorschau des Anschreibens"

            // Get translated content based on current language
            let motivation =
              formData.motivation ||
              getTranslation("contentValues.motivation") ||
              getTranslation("content.motivation") ||
              "mit großem Interesse habe ich Ihre Stellenanzeige gelesen..."
            console.log("Motivation in showPreview:", motivation)
            console.log("Current language:", currentLanguage)
            console.log(
              "Translation for contentValues.motivation:",
              getTranslation("contentValues.motivation")
            )
            let qualifications =
              formData.qualifications ||
              getTranslation("contentValues.qualifications") ||
              getTranslation("content.qualifications") ||
              "Als zuverlässige und verantwortungsbewusste Person..."
            let tasks =
              formData.tasks ||
              getTranslation("contentValues.tasks") ||
              getTranslation("content.tasks") ||
              "Die in Ihrer Ausschreibung genannten Aufgaben..."
            let future =
              formData.future ||
              getTranslation("contentValues.future") ||
              getTranslation("content.future") ||
              ""
            let availability =
              formData.availability ||
              getTranslation("contentValues.availability") ||
              getTranslation("content.availability") ||
              "Ich stehe Ihnen ab sofort zur Verfügung..."

            // Get translated greeting
            let greeting =
              formData.greeting ||
              getTranslation("fieldValues.greeting") ||
              getTranslation("form.greetingPlaceholder") ||
              "Sehr geehrter Herr Frank Güllmeister,"
            console.log("Greeting in showPreview:", greeting)

            // Force refresh translations if language changed
            if (translations[currentLanguage]) {
              const content = translations[currentLanguage].content
              if (content) {
                if (!formData.motivation) motivation = content.motivation || motivation
                if (!formData.qualifications)
                  qualifications = content.qualifications || qualifications
                if (!formData.tasks) tasks = content.tasks || tasks
                if (!formData.future) future = content.future || future
                if (!formData.availability) availability = content.availability || availability
              }
            }

            console.log("Updating previewContent with bewerbung content")
            console.log("Form data in showPreview:", formData)
            console.log("Full name:", formData.fullName)
            console.log("Address:", formData.address)
            console.log("Email:", formData.email)
            console.log("Phone:", formData.phone)

            // Check if we have real data or should show placeholders
            const hasRealData =
              formData.fullName && formData.address && formData.email && formData.phone
            console.log("Has real data:", hasRealData)

            // Get translated field values for preview
            const translatedFullName =
              getTranslation("fieldValues.fullName") || formData.fullName || "Vollständiger Name *"
            const translatedAddress =
              getTranslation("fieldValues.address") || formData.address || "Adresse *"
            const translatedEmail =
              getTranslation("fieldValues.email") || formData.email || "E-Mail *"
            const translatedPhone =
              getTranslation("fieldValues.phone") || formData.phone || "Telefon *"

            console.log("Translated values for preview:", {
              fullName: translatedFullName,
              address: translatedAddress,
              email: translatedEmail,
              phone: translatedPhone
            })

            document.getElementById("previewContent").innerHTML = `
                  <div class="document-preview">
                    <div class="sender-section">
                      <div class="sender-info">
                        <strong>${translatedFullName}</strong><br>
                        ${translatedAddress}<br>
                        ${translatedEmail}<br>
                        Tel: ${translatedPhone}
                      </div>

                      <div class="date">
                        ${getTranslation("fieldValues.date") || `Magdeburg, den ${new Date().toLocaleDateString("de-DE", {day: "2-digit", month: "2-digit", year: "numeric"})}`}
                      </div>
                    </div>

                    <div class="recipient">
                      <strong>${getTranslation("fieldValues.company") || formData.company || "Universitätsklinikum Magdeburg A.ö.R."}</strong><br>
                      ${getTranslation("fieldValues.contactName") || formData.contactName || "Herrn Frank Güllmeister"}<br>
                      ${getTranslation("fieldValues.contactAddress") || formData.contactAddress}<br>
                      ${getTranslation("fieldValues.contactPhone") || formData.contactPhone ? `Tel: ${getTranslation("fieldValues.contactPhone") || formData.contactPhone}` : ""}<br>
                      ${getTranslation("fieldValues.contactEmail") || formData.contactEmail ? `E-Mail: ${getTranslation("fieldValues.contactEmail") || formData.contactEmail}` : ""}
                    </div>

                    <div class="subject" style="color: ${formData.subjectColor || "#1a5490"}; font-weight: bold; font-size: 14pt; margin: 15mm 0 0 0; text-align: left;">
                      ${getTranslation("fieldValues.subject") || formData.subject || "Bewerbung als Mitarbeiter im Stationsservice"}<br>
                      ${formData.jobNumber && formData.jobNumber.length > 0 ? `${getTranslation("fieldValues.jobNumberLabel") || "Ihre Ausschreibung Nr.:"} ${getTranslation("fieldValues.jobNumberValue") || formData.jobNumber}` : ""}
                    </div>
                    <div class="content">
                      <p>${greeting}</p>
                      <p>${motivation}</p>
                      <p>${qualifications}</p>
                      <p>${tasks}</p>
                      ${future ? `<p>${future}</p>` : ""}
                      <p>${availability}</p>
                      <p style="white-space: pre-line;">${formData.closing || getTranslation("contentValues.closing") || ""}</p>
                      <p style="white-space: pre-line;">${formData.signature || getTranslation("contentValues.signature") || ""}</p>
                    </div>

                  </div>
                `
          } else if (type === "lebenslauf") {
            console.log("Generating lebenslauf preview")
            console.log("Full formData object:", formData)
            console.log("Global photo data:", globalPhotoData)
            console.log("Photo data:", formData.lebenslaufPhoto ? "Present" : "Missing")
            console.log("Photo value:", formData.lebenslaufPhoto)
            console.log(
              "Photo starts with data:image/:",
              formData.lebenslaufPhoto && typeof formData.lebenslaufPhoto === "string"
                ? formData.lebenslaufPhoto.startsWith("data:image/")
                : false
            )
            console.log(
              "Photo starts with blob:",
              formData.lebenslaufPhoto && typeof formData.lebenslaufPhoto === "string"
                ? formData.lebenslaufPhoto.startsWith("blob:")
                : false
            )
            console.log(
              "Photo condition check:",
              formData.lebenslaufPhoto &&
                typeof formData.lebenslaufPhoto === "string" &&
                (formData.lebenslaufPhoto.startsWith("data:image/") ||
                  formData.lebenslaufPhoto.startsWith("blob:"))
            )
            console.log(
              "Global photo condition check:",
              globalPhotoData &&
                (globalPhotoData.startsWith("data:image/") || globalPhotoData.startsWith("blob:"))
            )
            console.log("Final photo URL for display:", formData.lebenslaufPhoto || globalPhotoData)
            const previewTitle = getTranslation("preview.cv") || "Vorschau des Lebenslaufs"
            console.log("Updating previewContent with lebenslauf content")
            document.getElementById("previewContent").innerHTML = `
                  <div class="document-preview">
                    <style>
                      .document-preview h1 {
                        color: #1a5490;
                        font-size: 24pt;
                        border-bottom: 3px solid #1a5490;
                        padding-bottom: 5mm;
                        text-align: left;
                      }
                      .document-preview .header-with-photo {
                        display: flex;
                        align-items: flex-start;
                        gap: 10mm;
                        margin-bottom: 10mm;
                      }
                      .document-preview .photo-container {
                        flex-shrink: 0;
                        width: 40mm;
                        height: 50mm;
                        position: relative;
                        overflow: hidden;
                      }
                      .document-preview .photo-container img {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        border-radius: 2mm;
                        border: 1px solid #ddd;
                        display: block;
                        position: absolute;
                        top: 0;
                        left: 0;
                      }
                      .document-preview .photo-placeholder {
                        width: 100%;
                        height: 100%;
                        background: #f0f0f0;
                        border: 2px dashed #ccc;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: #666;
                        font-size: 10pt;
                        border-radius: 2mm;
                        position: absolute;
                        top: 0;
                        left: 0;
                      }
                      .document-preview .name-container {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                      }
                      .document-preview h2 {
                        color: #2c5aa0;
                        font-size: 14pt;
                        margin-top: 8mm;
                        border-bottom: 1px solid #2c5aa0;
                        padding-bottom: 2mm;
                        text-align: left;
                      }
                      .document-preview .header-info {
                        color: #666;
                        font-size: 12pt;
                        margin-bottom: 10mm;
                        text-align: left;
                      }
                      .document-preview .grid {
                        display: grid;
                        grid-template-columns: 50mm auto;
                        gap: 5mm;
                        margin: 5mm 0;
                      }
                      .document-preview .label {
                        font-weight: bold;
                        color: #555;
                        text-align: left;
                      }
                      .document-preview .grid > div:not(.label) {
                        text-align: left;
                      }
                      .document-preview ul {
                        margin: 5mm 0;
                        padding-left: 6mm;
                        text-align: left;
                      }
                      .document-preview li {
                        margin: 2mm 0;
                        text-align: left;
                      }
                      .document-preview .experience-item {
                        margin-bottom: 8mm;
                        padding: 3mm;
                        background: #f8f8f8;
                        border-left: 3px solid #2c5aa0;
                        text-align: left;
                      }
                      .document-preview p {
                        text-align: left;
                      }
                      .document-preview .date-info {
                        margin-top: 15mm;
                        text-align: center;
                        color: #666;
                        font-size: 10pt;
                      }
                    </style>
                    <div class="header-with-photo">
                      <div class="photo-container">
                         ${(() => {
                           console.log("=== PHOTO DISPLAY DEBUG START ===")
                           console.log("formData:", formData)
                           console.log("globalPhotoData:", globalPhotoData)

                           const photoUrl = globalPhotoData || formData.lebenslaufPhoto
                           console.log("Selected photoUrl:", photoUrl)
                           console.log("PhotoUrl type:", typeof photoUrl)

                           if (!photoUrl) {
                             console.log("No photo URL found - showing placeholder")
                             return `<div class="photo-placeholder">Kein Foto</div>`
                           }

                           // Ensure photoUrl is a string
                           if (typeof photoUrl !== "string") {
                             console.log(
                               "PhotoUrl is not a string, type:",
                               typeof photoUrl,
                               "value:",
                               photoUrl
                             )
                             return `<div class="photo-placeholder">Kein Foto</div>`
                           }

                           const isValidUrl =
                             photoUrl.startsWith("data:image/") || photoUrl.startsWith("blob:")
                           console.log("Is valid URL:", isValidUrl)

                           if (isValidUrl) {
                             console.log(
                               "Rendering IMG element with URL:",
                               photoUrl.substring(0, 50) + "..."
                             )
                             return `<img src="${photoUrl}" alt="Foto" style="width: 100%; height: 100%; object-fit: cover; border-radius: 2mm; border: 1px solid #ddd; display: block; position: absolute; top: 0; left: 0;" />`
                           } else {
                             console.log("Invalid URL - showing placeholder")
                             return `<div class="photo-placeholder">Kein Foto</div>`
                           }
                         })()}
                      </div>
                      <div class="name-container">
                        <h1>${(getTranslation("fieldValues.fullName") || formData.lebenslaufFullName || getTranslation("lebenslaufInputValues.fullName") || getTranslation("lebenslaufValues.fullName") || formData.fullName || "MYKOLA VUTOV").toUpperCase()}</h1>
                        <div class="header-info">
                          ${getTranslation("fieldValues.position") || getTranslation("lebenslaufValues.position") || formData.position || "Mitarbeiter im Stationsservice"}
                        </div>
                      </div>
                    </div>

                    <h2>${(() => {
                      const translation = getTranslation("lebenslaufHeaders.personalData")
                      console.log(
                        "Personal Data Translation:",
                        translation,
                        "Current Language:",
                        currentLanguage
                      )
                      return translation || "PERSÖNLICHE DATEN"
                    })()}</h2>
                    <div class="grid">
                      <div class="label">${getTranslation("lebenslaufLabels.birthDate") || "Geburtsdatum:"}</div>
                      <div>${getTranslation("fieldValues.birthDate") || (formData.birthDate ? new Date(formData.birthDate).toLocaleDateString("de-DE", {day: "2-digit", month: "2-digit", year: "numeric"}) : "19.12.1985")}</div>
                      <div class="label">${getTranslation("lebenslaufLabels.address") || "Adresse:"}</div>
                      <div>${getTranslation("fieldValues.address") || getTranslation("lebenslaufValues.address") || formData.address || "Am Unterhorstweg 1B, 39122 Magdeburg"}</div>
                      <div class="label">${getTranslation("lebenslaufLabels.phone") || "Telefon:"}</div>
                      <div>${getTranslation("fieldValues.phone") || getTranslation("lebenslaufValues.phone") || formData.phone || "+49 151 64317833"}</div>
                      <div class="label">${getTranslation("lebenslaufLabels.email") || "E-Mail:"}</div>
                      <div>${getTranslation("fieldValues.email") || getTranslation("lebenslaufValues.email") || formData.email || "vutov_mkola@icloud.com"}</div>
                      <div class="label">${getTranslation("lebenslaufLabels.nationality") || "Staatsangehörigkeit:"}</div>
                      <div>${getTranslation("fieldValues.nationality") || getTranslation("lebenslaufValues.nationality") || formData.nationality || "Ukrainisch"}</div>
                      <div class="label">${getTranslation("lebenslaufLabels.residenceStatus") || "Aufenthaltsstatus:"}</div>
                      <div>${getTranslation("fieldValues.residenceStatus") || getTranslation("lebenslaufLabels.residenceStatusValue") || "Aufenthaltserlaubnis vorhanden"}</div>
                    </div>

                    <h2>${getTranslation("lebenslaufHeaders.professionalQualification") || "BERUFLICHE QUALIFIKATION"}</h2>
                    <p>
                      ${getTranslation("lebenslaufInputValues.summary") || getTranslation("lebenslaufValues.experience") || "Engagierter und zuverlässiger Mitarbeiter mit ausgeprägtem Verantwortungsbewusstsein und hoher Motivation für die Arbeit im Gesundheitswesen. Bereit für neue Herausforderungen im Stationsservice mit Fokus auf Hygiene, Organisation und patientenorientierten Service."}
                    </p>

                    <h2>${getTranslation("lebenslaufHeaders.coreCompetencies") || "KERNKOMPETENZEN"}</h2>
                    <ul>
                      <li>${getTranslation("lebenslaufInputValues.skills") || getTranslation("lebenslaufValues.skills") || "Ausgeprägtes Hygienebewusstsein und Sorgfalt, Zuverlässigkeit und Verantwortungsbewusstsein, Teamfähigkeit und Kommunikationsstärke, Körperliche Belastbarkeit und Flexibilität, Organisationstalent und strukturierte Arbeitsweise, Empathischer Umgang mit kranken Menschen, Schnelle Auffassungsgabe und Lernbereitschaft"}</li>
                    </ul>

                    <h2>${getTranslation("lebenslaufHeaders.workExperience") || "BERUFSERFAHRUNG"}</h2>
                    <div class="experience-item">
                      <div style="white-space: pre-line;">${getTranslation("lebenslaufInputValues.experience") || getTranslation("lebenslaufValues.workExperience") || "Buchhalter | ZSU, Ukraine\nApril 2022 - Oktober 2024\nVerwaltung und Organisation von Arbeitsabläufen, Sorgfältige Dokumentenverwaltung, Teamkoordination und Kommunikation"}</div>
                    </div>

                    <h2>${getTranslation("lebenslaufHeaders.education") || "AUSBILDUNG"}</h2>
                    <div class="experience-item">
                      <div style="white-space: pre-line;">${getTranslation("lebenslaufInputValues.education") || getTranslation("lebenslaufValues.educationDetails") || "Diplom-Ingenieur\nNationale Technische Universität, Poltava, Ukraine\n2006 - 2011"}</div>
                    </div>

                    <h2>${getTranslation("lebenslaufHeaders.languageSkills") || "SPRACHKENNTNISSE"}</h2>
                    <div style="white-space: pre-line;">${getTranslation("lebenslaufInputValues.languages") || getTranslation("lebenslaufValues.languageSkills") || "Ukrainisch - Muttersprache\nRussisch - Verhandlungssicher\nDeutsch - B1 Niveau (in kontinuierlicher Verbesserung)\nBulgarisch - Gute Kenntnisse\nEnglisch - Grundkenntnisse"}</div>

                    <h2>${getTranslation("lebenslaufHeaders.additionalQualifications") || "ZUSÄTZLICHE QUALIFIKATIONEN"}</h2>
                    <div style="white-space: pre-line;">${getTranslation("lebenslaufInputValues.additional") || getTranslation("lebenslaufValues.additionalSkills") || "Führerschein Klasse B\nGesundheitlich fit und belastbar\nBereitschaft zur Schichtarbeit\nFlexibilität bei Arbeitszeiten (Vollzeit/Teilzeit)\nSofortige Verfügbarkeit"}</div>

                    <div class="date-info">
                      Magdeburg, ${new Date().toLocaleDateString("de-DE", {year: "numeric", month: "long"})}
                    </div>
                    </div>
                  </div>
                `
          }
        } catch (error) {
          console.error("Error in showPreview:", error)
          document.getElementById("previewContent").innerHTML = `
                  <div class="status-error">
                    <h3>Fehler beim Laden der Vorschau</h3>
                    <p>Es ist ein Fehler beim Laden der Vorschau aufgetreten: ${error.message}</p>
                  </div>
                `
        }
      }

      // Generate documents (Vanilla JS version)
      async function generateDocuments() {
        const form = document.getElementById("bewerbungForm")
        const formDataObj = new FormData(form)
        formData = Object.fromEntries(formDataObj)

        // Додаємо фото до formData якщо воно є
        if (globalPhotoData) {
          formData.photo = globalPhotoData
          formData.lebenslaufPhoto = globalPhotoData
        }

        console.log("Generate Documents - FormData with photo:", {
          hasPhoto: !!formData.photo,
          hasLebenslaufPhoto: !!formData.lebenslaufPhoto,
          globalPhotoData: !!globalPhotoData
        })

        showStatus("Dokumente werden generiert...", "info")

        try {
          // Generate HTML content
          const bewerbungHtml = generateBewerbungHTML(formData)
          const lebenslaufHtml = generateLebenslaufHTML(formData)

          // Create timestamp and filename
          const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, 19)
          const name = formData.fullName ? formData.fullName.replace(/\s+/g, "_") : "Dokument"

          // Generate all formats
          const promises = []

          // HTML files
          promises.push(
            downloadFile(`Bewerbung_${name}_${timestamp}.html`, bewerbungHtml, "text/html")
          )
          promises.push(
            downloadFile(`Lebenslauf_${name}_${timestamp}.html`, lebenslaufHtml, "text/html")
          )

          // PDF files
          promises.push(generatePDF(bewerbungHtml, `Bewerbung_${name}_${timestamp}.pdf`))
          promises.push(generatePDF(lebenslaufHtml, `Lebenslauf_${name}_${timestamp}.pdf`))

          // DOCX files
          promises.push(generateDOCX(bewerbungHtml, `Bewerbung_${name}_${timestamp}.docx`))
          promises.push(generateDOCX(lebenslaufHtml, `Lebenslauf_${name}_${timestamp}.docx`))

          // Wait for all downloads to complete
          await Promise.allSettled(promises)

          showStatus(
            "Alle Dokumente erfolgreich erstellt und heruntergeladen! (HTML, PDF, DOCX)",
            "success"
          )

          // Update status message
          const statusEl = document.getElementById("statusMessage")
          statusEl.innerHTML = `
                  <div style="margin-top: 10px;">
                    <strong>✅ Erfolgreich erstellt:</strong><br>
                    • HTML-Dateien (für Browser-Anzeige)<br>
                    • PDF-Dateien (für Druck und E-Mail)<br>
                    • DOCX-Dateien (für Microsoft Word)<br><br>
                    <strong>Hinweis:</strong> PDF und DOCX werden automatisch generiert.
                    DOCX-Dateien öffnen sich direkt in Microsoft Word.
                  </div>
                `
        } catch (error) {
          console.error("Error generating documents:", error)
          showStatus(`Fehler: ${error.message}`, "error")
        }
      }

      // Print document function
      function printDocument() {
        console.log("printDocument function called")
        const activeTab = document.querySelector(".preview-tab.active")
        if (!activeTab) {
          showStatus("Bitte wählen Sie zuerst ein Dokument aus", "error")
          return
        }

        // Get the preview content
        const previewContent = document.getElementById("previewContent")
        if (!previewContent) {
          showStatus("Kein Inhalt zum Drucken gefunden", "error")
          return
        }

        // Create a new window for printing
        console.log("Creating print window...")
        const printWindow = window.open(
          "",
          "_blank",
          "width=800,height=600,scrollbars=yes,resizable=yes"
        )

        if (!printWindow) {
          console.error("Failed to open print window - popup blocked?")
          showStatus("Popup wurde blockiert. Bitte erlauben Sie Popups für diese Seite.", "error")
          return
        }

        console.log("Print window created:", printWindow)
        printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="${currentLanguage}">
                <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>Drucken - ${activeTab.textContent}</title>
                  <style>
                    body {
                      font-family: Arial, sans-serif;
                      margin: 0;
                      padding: 20mm;
                      background: white;
                      color: #333;
                      line-height: 1.6;
                    }
                    .document {
                      max-width: 210mm;
                      margin: 0 auto;
                      background: white;
                      padding: 0;
                    }
                    .header {
                      margin-bottom: 20mm;
                    }
                    .sender-section {
                      display: flex;
                      justify-content: space-between;
                      align-items: flex-start;
                      margin-bottom: 8mm;
                      padding-bottom: 3mm;
                    }
                    .sender-info {
                      font-size: 11pt;
                      flex: 1;
                    }
                    .date {
                      text-align: right;
                      font-size: 11pt;
                      margin-left: 20mm;
                      white-space: nowrap;
                      flex-shrink: 0;
                    }
                    .recipient {
                      font-size: 11pt;
                      margin-bottom: 15mm;
                    }
                    .content {
                      font-size: 12pt;
                      line-height: 1.6;
                    }
                    .content h2 {
                      font-size: 14pt;
                      font-weight: bold;
                      margin: 15mm 0 5mm 0;
                      color: #333;
                    }
                    .content h3 {
                      font-size: 12pt;
                      font-weight: bold;
                      margin: 10mm 0 3mm 0;
                      color: #333;
                    }
                    .content p {
                      margin: 3mm 0;
                      text-align: justify;
                    }
                    .signature {
                      margin-top: 15mm;
                      font-size: 12pt;
                    }
                    /* Lebenslauf styles */
                    h1 {
                      color: #1a5490;
                      font-size: 24pt;
                      border-bottom: 3px solid #1a5490;
                      padding-bottom: 5mm;
                      text-align: left;
                    }
                    h2 {
                      color: #2c5aa0;
                      font-size: 14pt;
                      margin-top: 8mm;
                      border-bottom: 1px solid #2c5aa0;
                      padding-bottom: 2mm;
                      text-align: left;
                    }
                    .header-info {
                      color: #666;
                      font-size: 12pt;
                      margin-bottom: 10mm;
                      text-align: left;
                    }
                    .grid {
                      display: grid;
                      grid-template-columns: 50mm auto;
                      gap: 5mm;
                      margin: 5mm 0;
                    }
                    .label {
                      font-weight: bold;
                      color: #555;
                      text-align: left;
                    }
                    .grid > div:not(.label) {
                      text-align: left;
                    }
                    ul {
                      margin: 5mm 0;
                      padding-left: 6mm;
                      text-align: left;
                    }
                    li {
                      margin: 2mm 0;
                      text-align: left;
                    }
                    .experience-item {
                      margin-bottom: 8mm;
                      padding: 3mm;
                      background: #f8f8f8;
                      border-left: 3px solid #2c5aa0;
                      text-align: left;
                    }
                    p {
                      text-align: left;
                    }
                    .date-info {
                      margin-top: 15mm;
                      text-align: center;
                      color: #666;
                      font-size: 10pt;
                    }
                    @media print {
                      body { margin: 0; padding: 0; }
                      .document { max-width: none; margin: 0; }
                    }
                  </style>
                </head>
                <body>
                  <div class="document">
                    ${previewContent.innerHTML}
                  </div>
                </body>
                </html>
              `)

        printWindow.document.close()

        // Immediately try to focus the window
        console.log("Attempting to focus print window immediately...")
        try {
          printWindow.focus()
          console.log("Window focused successfully")
        } catch (e) {
          console.log("Could not focus window immediately:", e)
        }

        // Wait for content to load, then print
        printWindow.onload = function () {
          console.log("Print window loaded, attempting to focus...")

          // Multiple attempts to focus the window
          const focusWindow = () => {
            try {
              printWindow.focus()
              console.log("Window focused in onload")

              // Try to bring window to front
              if (printWindow.focus) {
                printWindow.focus()
              }

              // Try to bring window to front on different browsers
              try {
                printWindow.moveTo(0, 0)
                printWindow.resizeTo(screen.width, screen.height)
                console.log("Window positioned and resized")
              } catch (e) {
                console.log("Could not position window:", e)
              }

              // Try to focus using different methods
              try {
                printWindow.blur()
                printWindow.focus()
                console.log("Window focused with blur/focus method")
              } catch (e) {
                console.log("Blur/focus method failed:", e)
              }
            } catch (e) {
              console.log("Focus attempt failed:", e)
            }
          }

          // Try to focus immediately
          focusWindow()

          // Try again after a short delay
          setTimeout(focusWindow, 50)

          // Try again after another delay
          setTimeout(focusWindow, 100)

          // Small delay to ensure window is focused before printing
          setTimeout(() => {
            console.log("Attempting to print...")
            printWindow.print()

            // Close window after printing (with delay)
            setTimeout(() => {
              console.log("Closing print window...")
              printWindow.close()
            }, 1000)
          }, 200)
        }

        // Additional focus attempt after window creation
        setTimeout(() => {
          console.log("Additional focus attempt after 500ms...")
          try {
            printWindow.focus()
            console.log("Additional focus successful")
          } catch (e) {
            console.log("Additional focus failed:", e)
          }
        }, 500)

        showStatus("Druckdialog wird geöffnet...", "info")
      }

      // Generate Bewerbung HTML
      function generateBewerbungHTML(data) {
        const currentDate =
          getTranslation("fieldValues.date") ||
          new Date().toLocaleDateString("de-DE", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric"
          })
        const jobNumber =
          data.jobNumber && data.jobNumber.length > 0
            ? `<br>${getTranslation("fieldValues.jobNumberLabel") || "Ihre Ausschreibung Nr.:"} ${getTranslation("fieldValues.jobNumberValue") || data.jobNumber}`
            : ""

        // Get translated greeting
        const greeting =
          data.greeting ||
          getTranslation("form.greetingPlaceholder") ||
          "Sehr geehrter Herr Frank Güllmeister,"

        return `<!doctype html>
      <html lang="de">
        <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <title>Bewerbung - ${data.fullName}</title>
          <style>
            @page {
              size: A4;
              margin: 20mm;
            }
            body {
              font-family: "Arial", sans-serif;
              font-size: 11pt;
              line-height: 1.5;
              color: #333;
              margin: 0;
            }
            .sender-section {
              display: flex;
              justify-content: space-between;
              align-items: flex-start;
              margin-bottom: 8mm;
              padding-bottom: 2mm;
            }
            .sender-info {
              font-size: 11pt;
              color: #333;
              flex: 1;
            }
            .recipient {
              margin-bottom: 10mm;
              margin-top: 8mm;
              font-size: 11pt;
            }
            .date {
              text-align: right;
              margin-left: 20mm;
              white-space: nowrap;
              font-size: 11pt;
              color: #333;
            }
            .subject {
              font-weight: bold;
              margin: 10mm 0;
            }
            .content p {
              margin-bottom: 8mm;
              text-align: justify;
            }
            .signature {
              margin-top: 20mm;
            }
            .attachments {
              margin-top: 15mm;
            }
          </style>
        </head>
        <body>
          <div class="sender-section">
            <div class="sender-info">
              <strong>${data.fullName}</strong><br />
              ${data.address}<br>
              ${data.email}<br>
              Tel: ${data.phone}
            </div>

            <div class="date">Magdeburg, den ${currentDate}</div>
          </div>

          <div class="recipient">
            <strong>${data.company}</strong><br />
            Personalmanagement<br />
            ${data.contactName || ""}<br />
            ${data.contactAddress || ""}<br />
            ${data.contactPhone ? `Tel: ${data.contactPhone}` : ""}<br />
            ${data.contactEmail ? `E-Mail: ${data.contactEmail}` : ""}
          </div>

          <div class="subject" style="color: ${data.subjectColor || "#1a5490"}; font-weight: bold; font-size: 14pt; margin: 15mm 0; text-align: left;">
            ${data.subject || "Bewerbung als Mitarbeiter im Stationsservice"}${jobNumber}
          </div>

          <div class="content">
            <p>${greeting}</p>

            <p>${data.motivation}</p>

            <p>${data.qualifications}</p>

            <p>${data.tasks}</p>

            ${data.future ? `<p>${data.future}</p>` : ""}

            <p>${data.availability}</p>
            <p style="white-space: pre-line;">${data.closing}</p>
            <p style="white-space: pre-line;">${data.signature}</p>
          </div>

        </body>
      </html>`
      }

      // Generate Lebenslauf HTML
      function generateLebenslaufHTML(data) {
        const birthDate = new Date(data.birthDate).toLocaleDateString("de-DE", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric"
        })
        const currentMonth = new Date().toLocaleDateString("de-DE", {
          year: "numeric",
          month: "long"
        })

        return `<!doctype html>
      <html lang="de">
        <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <title>Lebenslauf - ${data.fullName}</title>
          <style>
            @page {
              size: A4;
              margin: 15mm;
            }
            body {
              font-family: "Arial", sans-serif;
              font-size: 11pt;
              line-height: 1.4;
              color: #333;
            }
            h1 {
              color: #1a5490;
              font-size: 24pt;
              border-bottom: 3px solid #1a5490;
              padding-bottom: 5mm;
            }
            h2 {
              color: #2c5aa0;
              font-size: 14pt;
              margin-top: 8mm;
              border-bottom: 1px solid #2c5aa0;
              padding-bottom: 2mm;
            }
            .header-info {
              color: #666;
              font-size: 12pt;
              margin-bottom: 10mm;
            }
            .grid {
              display: grid;
              grid-template-columns: 50mm auto;
              gap: 5mm;
              margin: 5mm 0;
            }
            .label {
              font-weight: bold;
              color: #555;
            }
            ul {
              margin: 5mm 0;
              padding-left: 6mm;
            }
            li {
              margin: 2mm 0;
            }
            .experience-item {
              margin-bottom: 8mm;
              padding: 3mm;
              background: #f8f8f8;
              border-left: 3px solid #2c5aa0;
            }

            /* Стилі для фото в заголовку */
            .header-with-photo {
              display: flex;
              gap: 5mm;
              margin-bottom: 10mm;
              align-items: flex-start;
            }

            .photo-container {
              width: 35mm;
              height: 45mm;
              border: 2px solid #1a5490;
              border-radius: 3px;
              overflow: hidden;
              background: #f8f9fa;
              position: relative;
              flex-shrink: 0;
            }

            .photo-container img {
              width: 100%;
              height: 100%;
              object-fit: cover;
            }

            .photo-placeholder {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              height: 100%;
              color: #666;
              font-size: 10pt;
              text-align: center;
              background: #f0f8ff;
            }

            .name-container {
              flex: 1;
            }

            .name-container h1 {
              margin-top: 0;
            }
          </style>
        </head>
        <body>
          <!-- Заголовок з фото -->
          <div class="header-with-photo">
            <div class="photo-container">
              ${(() => {
                // Отримуємо фото з даних або глобальної змінної
                const photoUrl = data.photo || globalPhotoData || data.lebenslaufPhoto;
                console.log("PDF Generation - Photo URL:", photoUrl);

                if (photoUrl && typeof photoUrl === "string" && (photoUrl.startsWith("data:image/") || photoUrl.startsWith("blob:"))) {
                  return `<img src="${photoUrl}" alt="Foto" />`;
                } else {
                  return `<div class="photo-placeholder">📷<br>Kein Foto</div>`;
                }
              })()}
            </div>
            <div class="name-container">
              <h1 style="text-align: left;">${data.fullName.toUpperCase()}</h1>
              <div class="header-info" style="text-align: left;">Bewerbung für ${data.position || 'Stationsservice'}</div>
            </div>
          </div>

          <h2>PERSÖNLICHE DATEN</h2>
          <div class="grid">
            <div class="label">Geburtsdatum:</div>
            <div>${birthDate}</div>
            <div class="label">Adresse:</div>
            <div>${data.address}</div>
            <div class="label">Telefon:</div>
            <div>${data.phone}</div>
            <div class="label">E-Mail:</div>
            <div>${data.email}</div>
            <div class="label">Staatsangehörigkeit:</div>
            <div>${data.nationality}</div>
            <div class="label">Aufenthaltsstatus:</div>
            <div>Aufenthaltserlaubnis vorhanden</div>
          </div>

          <h2>BERUFLICHE QUALIFIKATION</h2>
          <p>
            Engagierter und zuverlässiger Mitarbeiter mit ausgeprägtem
            Verantwortungsbewusstsein und hoher Motivation für die Arbeit im
            Gesundheitswesen. Bereit für neue Herausforderungen im Stationsservice mit
            Fokus auf Hygiene, Organisation und patientenorientierten Service.
          </p>

          <h2>KERNKOMPETENZEN</h2>
          <ul>
            <li>Ausgeprägtes Hygienebewusstsein und Sorgfalt</li>
            <li>Zuverlässigkeit und Verantwortungsbewusstsein</li>
            <li>Teamfähigkeit und Kommunikationsstärke</li>
            <li>Körperliche Belastbarkeit und Flexibilität</li>
            <li>Organisationstalent und strukturierte Arbeitsweise</li>
            <li>Empathischer Umgang mit kranken Menschen</li>
            <li>Schnelle Auffassungsgabe und Lernbereitschaft</li>
          </ul>

          <h2>BERUFSERFAHRUNG</h2>
          <div class="experience-item">
            <strong>Buchhalter</strong> | ZSU, Ukraine<br />
            <em>April 2022 - Oktober 2024</em>
            <ul>
              <li>Verwaltung und Organisation von Arbeitsabläufen</li>
              <li>Sorgfältige Dokumentenverwaltung</li>
              <li>Teamkoordination und Kommunikation</li>
            </ul>
          </div>

          <div class="experience-item">
            <strong>Verschiedene Tätigkeiten</strong> | Ukraine<br />
            <em>2011 - 2022</em>
            <ul>
              <li>Kundenservice und Betreuung</li>
              <li>Administrative Aufgaben</li>
              <li>Teamarbeit in verschiedenen Bereichen</li>
            </ul>
          </div>

          <h2>AUSBILDUNG</h2>
          <div class="experience-item">
            <strong>Diplom-Ingenieur</strong><br />
            Nationale Technische Universität, Poltava, Ukraine<br />
            <em>2006 - 2011</em>
          </div>

          <h2>SPRACHKENNTNISSE</h2>
          <ul>
            <li>Ukrainisch - Muttersprache</li>
            <li>Russisch - Verhandlungssicher</li>
            <li>Deutsch - B1 Niveau (in kontinuierlicher Verbesserung)</li>
            <li>Bulgarisch - Gute Kenntnisse</li>
            <li>Englisch - Grundkenntnisse</li>
          </ul>

          <h2>ZUSÄTZLICHE QUALIFIKATIONEN</h2>
          <ul>
            <li>Führerschein Klasse B</li>
            <li>Gesundheitlich fit und belastbar</li>
            <li>Bereitschaft zur Schichtarbeit</li>
            <li>Flexibilität bei Arbeitszeiten (Vollzeit/Teilzeit)</li>
            <li>Sofortige Verfügbarkeit</li>
          </ul>

          <div
            style="margin-top: 15mm; text-align: center; color: #666; font-size: 10pt"
          >
            Magdeburg, ${currentMonth}
          </div>
        </body>
      </html>`
      }

      // Download file function with directory picker
      async function downloadFile(filename, content, mimeType) {
        const blob = new Blob([content], {type: mimeType})

        // Try File System Access API first (modern browsers)
        if ("showSaveFilePicker" in window) {
          try {
            const fileHandle = await window.showSaveFilePicker({
              suggestedName: filename,
              types: [
                {
                  description: getFileDescription(mimeType),
                  accept: {[mimeType]: [getFileExtension(mimeType)]}
                }
              ]
            })

            const writable = await fileHandle.createWritable()
            await writable.write(blob)
            await writable.close()

            showStatus(`Datei gespeichert: ${filename}`, "success")
            return
          } catch (error) {
            if (error.name !== "AbortError") {
              console.warn("File System Access API failed, falling back to download:", error)
            } else {
              showStatus("Speichern abgebrochen", "info")
              return
            }
          }
        }

        // Fallback to traditional download
        const url = URL.createObjectURL(blob)
        const link = document.createElement("a")
        link.href = url
        link.download = filename
        document.body.appendChild(link)
        link.click()
        document.body.removeChild(link)
        URL.revokeObjectURL(url)

        showStatus(`Datei heruntergeladen: ${filename}`, "success")
      }

      // Get file description based on MIME type
      function getFileDescription(mimeType) {
        switch (mimeType) {
          case "text/html":
            return "HTML-Dokument"
          case "application/pdf":
            return "PDF-Dokument"
          case "application/vnd.openxmlformats-officedocument.wordprocessingml.document":
            return "Word-Dokument"
          default:
            return "Dokument"
        }
      }

      // Get file extension based on MIME type
      function getFileExtension(mimeType) {
        switch (mimeType) {
          case "text/html":
            return ".html"
          case "application/pdf":
            return ".pdf"
          case "application/vnd.openxmlformats-officedocument.wordprocessingml.document":
            return ".docx"
          default:
            return ""
        }
      }

      // Check if File System Access API is supported
      function isFileSystemAccessSupported() {
        return "showSaveFilePicker" in window
      }

      // Show browser compatibility info
      function showBrowserCompatibility() {
        const isSupported = isFileSystemAccessSupported()
        const message = isSupported
          ? "✅ Ihr Browser unterstützt die Auswahl des Speicherorts für Dateien"
          : "ℹ️ Ihr Browser unterstützt die automatische Speicherort-Auswahl nicht. Dateien werden im Download-Ordner gespeichert."

        showStatus(message, isSupported ? "success" : "info")
      }

      // Generate PDF using jsPDF
      async function generatePDF(htmlContent, filename) {
        let tempContainer = null
        try {
          // Create a temporary container
          tempContainer = document.createElement("div")
          tempContainer.innerHTML = htmlContent
          tempContainer.style.position = "absolute"
          tempContainer.style.left = "-9999px"
          tempContainer.style.top = "-9999px"
          tempContainer.style.width = "210mm"
          tempContainer.style.fontSize = "11pt"
          tempContainer.style.fontFamily = "Arial, sans-serif"
          tempContainer.style.lineHeight = "1.4"
          tempContainer.style.color = "#333"
          document.body.appendChild(tempContainer)

          // Load jsPDF dynamically with fallback
          let PDF
          try {
            await loadScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js")

            if (typeof window.jsPDF !== "undefined" && window.jsPDF.jsPDF) {
              PDF = window.jsPDF.jsPDF
            } else {
              throw new Error("Primary CDN failed")
            }
          } catch (error) {
            console.warn("Primary jsPDF CDN failed, trying alternative:", error)

            // Try alternative CDN
            await loadScript("https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js")

            if (typeof window.jsPDF !== "undefined" && window.jsPDF.jsPDF) {
              PDF = window.jsPDF.jsPDF
            } else {
              throw new Error("All jsPDF CDNs failed to load")
            }
          }

          console.log("Creating PDF with jsPDF...")
          const pdf = new PDF({
            orientation: "portrait",
            unit: "mm",
            format: "a4"
          })
          console.log("PDF object created successfully")

          // Add content to PDF
          pdf.html(tempContainer, {
            callback: async function (doc) {
              try {
                // Try to use File System Access API for PDF
                if ("showSaveFilePicker" in window) {
                  const fileHandle = await window.showSaveFilePicker({
                    suggestedName: filename,
                    types: [
                      {
                        description: "PDF-Dokument",
                        accept: {"application/pdf": [".pdf"]}
                      }
                    ]
                  })

                  const pdfBlob = doc.output("blob")
                  const writable = await fileHandle.createWritable()
                  await writable.write(pdfBlob)
                  await writable.close()

                  showStatus(`PDF gespeichert: ${filename}`, "success")
                } else {
                  // Fallback to traditional save
                  doc.save(filename)
                  showStatus(`PDF heruntergeladen: ${filename}`, "success")
                }
              } catch (error) {
                if (error.name !== "AbortError") {
                  console.warn("File System Access API failed, using fallback:", error)
                  doc.save(filename)
                  showStatus(`PDF heruntergeladen: ${filename}`, "success")
                } else {
                  showStatus("PDF-Speichern abgebrochen", "info")
                }
              }

              if (tempContainer && document.body.contains(tempContainer)) {
                document.body.removeChild(tempContainer)
              }
            },
            x: 15,
            y: 15,
            width: 180,
            windowWidth: 800
          })
        } catch (error) {
          console.error("Error generating PDF:", error)
          showStatus("Fehler beim Generieren der PDF-Datei", "error")

          // Clean up temp container
          if (tempContainer && document.body.contains(tempContainer)) {
            document.body.removeChild(tempContainer)
          }

          // Try alternative PDF generation
          console.log("Trying alternative PDF generation...")
          try {
            generatePDFAlternative(htmlContent, filename)
          } catch (altError) {
            console.error("Alternative PDF generation also failed:", altError)
            showStatus(
              "PDF-Generierung fehlgeschlagen. Bitte verwenden Sie die HTML-Dateien und konvertieren Sie diese manuell.",
              "error"
            )
          }
        }
      }

      // Alternative PDF generation using print dialog
      function generatePDFAlternative(htmlContent, filename) {
        try {
          // Create a new window for printing
          const printWindow = window.open(
            "",
            "_blank",
            "width=800,height=600,scrollbars=yes,resizable=yes"
          )

          if (!printWindow) {
            showStatus("Popup wurde blockiert. Bitte erlauben Sie Popups für diese Seite.", "error")
            return
          }

          printWindow.document.write(`
                  <!DOCTYPE html>
                  <html lang="de">
                  <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>PDF - ${filename}</title>
                    <style>
                      @page {
                        size: A4;
                        margin: 15mm;
                      }
                      body {
                        font-family: Arial, sans-serif;
                        font-size: 11pt;
                        line-height: 1.4;
                        color: #333;
                        margin: 0;
                        padding: 0;
                      }
                      .document {
                        max-width: none;
                        margin: 0;
                      }
                      h1 {
                        color: #1a5490;
                        font-size: 24pt;
                        border-bottom: 3px solid #1a5490;
                        padding-bottom: 5mm;
                        text-align: left;
                      }
                      h2 {
                        color: #2c5aa0;
                        font-size: 14pt;
                        margin-top: 8mm;
                        border-bottom: 1px solid #2c5aa0;
                        padding-bottom: 2mm;
                        text-align: left;
                      }
                      .header-info {
                        color: #666;
                        font-size: 12pt;
                        margin-bottom: 10mm;
                        text-align: left;
                      }
                      .grid {
                        display: grid;
                        grid-template-columns: 50mm auto;
                        gap: 5mm;
                        margin: 5mm 0;
                      }
                      .label {
                        font-weight: bold;
                        color: #555;
                        text-align: left;
                      }
                      .grid > div:not(.label) {
                        text-align: left;
                      }
                      ul {
                        margin: 5mm 0;
                        padding-left: 6mm;
                        text-align: left;
                      }
                      li {
                        margin: 2mm 0;
                        text-align: left;
                      }
                      .experience-item {
                        margin-bottom: 8mm;
                        padding: 3mm;
                        background: #f8f8f8;
                        border-left: 3px solid #2c5aa0;
                        text-align: left;
                      }
                      p {
                        text-align: left;
                      }
                      .date-info {
                        margin-top: 15mm;
                        text-align: center;
                        color: #666;
                        font-size: 10pt;
                      }
                      .sender-section {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 8mm;
                        padding-bottom: 3mm;
                      }
                      .sender-info {
                        font-size: 11pt;
                        color: #333;
                        flex: 1;
                      }
                      .date {
                        text-align: right;
                        font-size: 11pt;
                        color: #333;
                        margin-left: 20mm;
                        white-space: nowrap;
                        flex-shrink: 0;
                      }
                      @media print {
                        body { margin: 0; padding: 0; }
                        .document { max-width: none; margin: 0; }
                      }
                    </style>
                  </head>
                  <body>
                    <div class="document">
                      ${htmlContent}
                    </div>
                  </body>
                  </html>
                `)

          printWindow.document.close()

          // Focus and print
          printWindow.onload = function () {
            printWindow.focus()
            setTimeout(() => {
              printWindow.print()
              setTimeout(() => {
                printWindow.close()
              }, 1000)
            }, 100)
          }

          showStatus("PDF-Druckdialog geöffnet. Bitte wählen Sie 'Als PDF speichern'.", "info")
        } catch (error) {
          console.error("Error generating PDF alternative:", error)
          showStatus("Fehler beim Öffnen des PDF-Druckdialogs", "error")
        }
      }

      // Convert HTML to DOCX using client-side library
      async function htmlToDocx(htmlContent) {
        try {
          // Clean HTML content for better DOCX conversion
          const cleanHtml = htmlContent
            .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, "") // Remove style tags
            .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, "") // Remove script tags
            .replace(/class="[^"]*"/gi, "") // Remove class attributes
            .replace(/style="[^"]*"/gi, "") // Remove inline styles
            .replace(/data-[^=]*="[^"]*"/gi, "") // Remove data attributes
            .replace(/\s+/g, " ") // Normalize whitespace
            .trim()

          // Use html-docx-js library to convert HTML to DOCX
          const docxBlob = htmlDocx.asBlob(cleanHtml, {
            orientation: "portrait",
            margins: {
              top: 720,
              right: 720,
              bottom: 720,
              left: 720
            }
          })

          return docxBlob
        } catch (error) {
          console.error("Error converting HTML to DOCX:", error)
          throw new Error("Failed to convert HTML to DOCX format")
        }
      }

      // Generate DOCX using client-side conversion
      async function generateDOCX(htmlContent, filename) {
        try {
          console.log("Generating DOCX document...")
          showStatus("DOCX wird generiert...", "info")

          // Convert HTML to DOCX using client-side library
          if (typeof htmlDocx === "undefined") {
            throw new Error(
              "html-docx-js library not loaded. Please check your internet connection."
            )
          }
          const docxBlob = htmlDocx.asBlob(htmlContent)
          console.log("DOCX generated successfully, size:", docxBlob.size, "bytes")

          // Try File System Access API first
          if ("showSaveFilePicker" in window) {
            try {
              const fileHandle = await window.showSaveFilePicker({
                suggestedName: filename,
                types: [
                  {
                    description: "Word-Dokument",
                    accept: {
                      "application/vnd.openxmlformats-officedocument.wordprocessingml.document": [
                        ".docx"
                      ]
                    }
                  }
                ]
              })

              const writable = await fileHandle.createWritable()
              await writable.write(docxBlob)
              await writable.close()

              showStatus(`✅ DOCX gespeichert: ${filename}`, "success")
              return
            } catch (error) {
              if (error.name !== "AbortError") {
                console.warn("File System Access API failed, using fallback:", error)
              } else {
                showStatus("DOCX-Speichern abgebrochen", "info")
                return
              }
            }
          }

          // Fallback to traditional download
          const url = URL.createObjectURL(docxBlob)
          const link = document.createElement("a")
          link.href = url
          link.download = filename
          document.body.appendChild(link)
          link.click()
          document.body.removeChild(link)
          URL.revokeObjectURL(url)

          showStatus(`✅ DOCX heruntergeladen: ${filename}`, "success")
        } catch (error) {
          console.error("Error generating DOCX:", error)

          // Try fallback method
          console.log("Trying fallback DOCX generation...")
          const fallbackSuccess = window.generateSimpleDOCX(htmlContent, filename)

          if (fallbackSuccess) {
            showStatus(
              `✅ Документ збережено як RTF: ${filename.replace(".docx", ".rtf")}`,
              "success"
            )
          } else {
            let errorMessage = "DOCX-Generierung fehlgeschlagen. Bitte versuchen Sie es erneut."
            if (error.message.includes("html-docx-js library not loaded")) {
              errorMessage =
                "Бібліотека для генерації DOCX не завантажена. Перевірте наявність файлу html-docx.js."
            } else if (error.message.includes("html-docx-js")) {
              errorMessage = "Помилка бібліотеки html-docx-js. Спробуйте інший формат документа."
            }

            showStatus(errorMessage, "error")
          }
        }
      }

      // Alternative DOCX generation using RTF format (Word-compatible)
      function generateDOCXAlternative(htmlContent, filename) {
        try {
          // Create a simple text version for Word
          const tempDiv = document.createElement("div")
          tempDiv.innerHTML = htmlContent

          // Extract text content and format it better
          let textContent = tempDiv.textContent || tempDiv.innerText || ""

          // Clean up the text content
          textContent = textContent
            .replace(/\s+/g, " ") // Replace multiple spaces with single space
            .replace(/\n\s*\n/g, "\n\n") // Clean up multiple newlines
            .trim()

          // Create a professional RTF content with proper formatting
          const rtfContent = `{\\rtf1\\ansi\\deff0
      {\\fonttbl {\\f0 Times New Roman;}{\\f1 Arial;}}
      {\\colortbl;\\red0\\green0\\blue0;\\red26\\green84\\blue144;\\red44\\green90\\blue160;\\red128\\green128\\green128;}
      {\\stylesheet {\\s0\\snext0 Normal;}{\\s1\\snext1 Heading 1;}{\\s2\\snext2 Heading 2;}}
      \\margl1440\\margr1440\\margt1440\\margb1440
      \\f0\\fs22
      ${textContent.replace(/\n/g, "\\par ").replace(/\r/g, "").replace(/\s+/g, " ").trim()}
      }`

          const blob = new Blob([rtfContent], {
            type: "application/rtf"
          })

          // Try File System Access API first
          if ("showSaveFilePicker" in window) {
            try {
              const fileHandle = window.showSaveFilePicker({
                suggestedName: filename.replace(".docx", ".rtf"),
                types: [
                  {
                    description: "RTF-Dokument",
                    accept: {"application/rtf": [".rtf"]}
                  }
                ]
              })

              const writable = fileHandle.createWritable()
              writable.write(blob)
              writable.close()

              showStatus(
                `Word-Dokument gespeichert: ${filename.replace(".docx", ".rtf")} (RTF-Format)`,
                "success"
              )
              return
            } catch (error) {
              if (error.name !== "AbortError") {
                console.warn("File System Access API failed, using fallback:", error)
              } else {
                showStatus("RTF-Speichern abgebrochen", "info")
                return
              }
            }
          }

          // Fallback to traditional download
          const url = URL.createObjectURL(blob)
          const link = document.createElement("a")
          link.href = url
          link.download = filename.replace(".docx", ".rtf")
          document.body.appendChild(link)
          link.click()
          document.body.removeChild(link)
          URL.revokeObjectURL(url)

          showStatus(
            `Word-Dokument heruntergeladen: ${filename.replace(".docx", ".rtf")} (RTF-Format, öffnet in Word)`,
            "success"
          )
        } catch (error) {
          console.error("Error generating RTF alternative:", error)
          showStatus("Alternative DOCX-Generierung fehlgeschlagen", "error")
        }
      }

      // Load external script dynamically
      function loadScript(src) {
        return new Promise((resolve, reject) => {
          // Check if script is already loaded
          const existingScript = document.querySelector(`script[src="${src}"]`)
          if (existingScript) {
            resolve(window)
            return
          }

          const script = document.createElement("script")
          script.src = src
          script.async = true
          script.type = "module" // Add module type for ES modules

          // Add crossOrigin only for external CDNs
          if (src.startsWith("http")) {
            script.crossOrigin = "anonymous"
          }

          script.onload = () => {
            console.log(`Script loaded successfully: ${src}`)
            // Wait a bit for the library to initialize
            setTimeout(() => resolve(window), 100)
          }

          script.onerror = error => {
            console.error(`Failed to load script: ${src}`, error)
            reject(new Error(`Failed to load script: ${src}`))
          }

          document.head.appendChild(script)
        })
      }

      // Convert HTML content to DOCX format
      function convertHTMLToDOCX(htmlContent, docx) {
        const tempDiv = document.createElement("div")
        tempDiv.innerHTML = htmlContent

        const elements = []

        // Process each element
        function processElement(element) {
          if (element.nodeType === Node.TEXT_NODE) {
            if (element.textContent.trim()) {
              elements.push(
                new docx.TextRun({
                  text: element.textContent,
                  size: 22 // 11pt in half-points
                })
              )
            }
            return
          }

          const tagName = element.tagName?.toLowerCase()

          switch (tagName) {
            case "h1":
              elements.push(
                new docx.Paragraph({
                  children: [
                    new docx.TextRun({
                      text: element.textContent,
                      bold: true,
                      size: 32,
                      color: "1a5490"
                    })
                  ],
                  spacing: {after: 200}
                })
              )
              break

            case "h2":
              elements.push(
                new docx.Paragraph({
                  children: [
                    new docx.TextRun({
                      text: element.textContent,
                      bold: true,
                      size: 28,
                      color: "2c5aa0"
                    })
                  ],
                  spacing: {after: 200}
                })
              )
              break

            case "p":
              const paragraphChildren = []
              Array.from(element.childNodes).forEach(child => {
                if (child.nodeType === Node.TEXT_NODE) {
                  if (child.textContent.trim()) {
                    paragraphChildren.push(
                      new docx.TextRun({
                        text: child.textContent,
                        size: 22
                      })
                    )
                  }
                } else if (child.tagName?.toLowerCase() === "br") {
                  paragraphChildren.push(new docx.TextRun({text: "\n"}))
                }
              })

              if (paragraphChildren.length > 0) {
                elements.push(
                  new docx.Paragraph({
                    children: paragraphChildren,
                    spacing: {after: 200}
                  })
                )
              }
              break

            case "ul":
              Array.from(element.querySelectorAll("li")).forEach(li => {
                elements.push(
                  new docx.Paragraph({
                    children: [
                      new docx.TextRun({
                        text: `• ${li.textContent}`,
                        size: 22
                      })
                    ],
                    spacing: {after: 100}
                  })
                )
              })
              break

            case "li":
              elements.push(
                new docx.Paragraph({
                  children: [
                    new docx.TextRun({
                      text: `• ${element.textContent}`,
                      size: 22
                    })
                  ],
                  spacing: {after: 100}
                })
              )
              break

            default:
              // Process child elements
              Array.from(element.childNodes).forEach(child => {
                processElement(child)
              })
          }
        }

        processElement(tempDiv)
        return elements
      }

      // Generate PDF only
      async function generatePDFOnly() {
        const form = document.getElementById("bewerbungForm")
        const formDataObj = new FormData(form)
        formData = Object.fromEntries(formDataObj)

        // Додаємо фото до formData якщо воно є
        if (globalPhotoData) {
          formData.photo = globalPhotoData
          formData.lebenslaufPhoto = globalPhotoData
        }

        console.log("Generate PDF - FormData with photo:", {
          hasPhoto: !!formData.photo,
          hasLebenslaufPhoto: !!formData.lebenslaufPhoto,
          globalPhotoData: !!globalPhotoData
        })

        showStatus("PDF-Dokumente werden generiert...", "info")

        try {
          const bewerbungHtml = generateBewerbungHTML(formData)
          const lebenslaufHtml = generateLebenslaufHTML(formData)

          const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, 19)
          const name = formData.fullName ? formData.fullName.replace(/\s+/g, "_") : "Dokument"

          // Try jsPDF first, fallback to print dialog
          try {
            await generatePDF(bewerbungHtml, `Bewerbung_${name}_${timestamp}.pdf`)
            await generatePDF(lebenslaufHtml, `Lebenslauf_${name}_${timestamp}.pdf`)
            showStatus("PDF-Dokumente erfolgreich erstellt!", "success")
          } catch (pdfError) {
            console.warn("jsPDF failed, using print dialog:", pdfError)
            showStatus("Verwende Druckdialog für PDF-Erstellung...", "info")

            // Use print dialog as fallback
            generatePDFAlternative(bewerbungHtml, `Bewerbung_${name}_${timestamp}.pdf`)
            setTimeout(() => {
              generatePDFAlternative(lebenslaufHtml, `Lebenslauf_${name}_${timestamp}.pdf`)
            }, 1000)
          }
        } catch (error) {
          console.error("Error generating PDF:", error)
          showStatus(`Fehler beim Generieren der PDF-Dateien: ${error.message}`, "error")
        }
      }

      // Generate DOCX only
      async function generateDOCXOnly() {
        const form = document.getElementById("bewerbungForm")
        const formDataObj = new FormData(form)
        formData = Object.fromEntries(formDataObj)

        // Додаємо фото до formData якщо воно є
        if (globalPhotoData) {
          formData.photo = globalPhotoData
          formData.lebenslaufPhoto = globalPhotoData
        }

        console.log("Generate DOCX - FormData with photo:", {
          hasPhoto: !!formData.photo,
          hasLebenslaufPhoto: !!formData.lebenslaufPhoto,
          globalPhotoData: !!globalPhotoData
        })

        showStatus("DOCX-Dokumente werden generiert...", "info")

        try {
          const bewerbungHtml = generateBewerbungHTML(formData)
          const lebenslaufHtml = generateLebenslaufHTML(formData)

          const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, 19)
          const name = formData.fullName ? formData.fullName.replace(/\s+/g, "_") : "Dokument"

          // Generate DOCX documents
          await generateDOCX(bewerbungHtml, `Bewerbung_${name}_${timestamp}.docx`)

          setTimeout(async () => {
            await generateDOCX(lebenslaufHtml, `Lebenslauf_${name}_${timestamp}.docx`)
            showStatus("DOCX-Dokumente erfolgreich erstellt!", "success")
          }, 1000)
        } catch (error) {
          console.error("Error generating DOCX documents:", error)
          showStatus(`Fehler beim Generieren der DOCX-Dateien: ${error.message}`, "error")
        }
      }

      // Reset form
      function resetForm() {
        document.getElementById("bewerbungForm").reset()
        formData = {}
        document.getElementById("previewContent").innerHTML = `
                <div class="preview-placeholder">
                  <div class="icon">📄</div>
                  <p>${getTranslation("preview.placeholder") || "Die Vorschau wird automatisch aktualisiert, während Sie die Felder ausfüllen."}</p>
                </div>
              `
        showStatus("Formular wurde zurückgesetzt", "info")
      }

      // Language and translation functionality
      let currentLanguage = "de"
      let translations = {}
      let originalContent = {} // Store original content for each field

      // Load translations
      async function loadTranslations(lang) {
        console.log("loadTranslations called with lang:", lang)
        try {
          const response = await fetch(`locales/${lang}.json?v=20250914`)
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`)
          }
          translations[lang] = await response.json()
          console.log("Translations loaded for", lang, ":", translations[lang])
          console.log("lebenslaufInputValues:", translations[lang].lebenslaufInputValues)

          // Add delay to ensure translations are fully processed
          console.log("Waiting for translations to be fully processed...")
          await new Promise(resolve => setTimeout(resolve, 100))
        } catch (error) {
          console.error(`Failed to load translations for ${lang}:`, error)
        }
      }

      // Change language - simplified version
      async function changeLanguage(lang) {
        const newLang = lang || document.getElementById("languageSelect")?.value
        console.log("changeLanguage called with:", newLang, "current:", currentLanguage)

        if (newLang !== currentLanguage) {
          // Store current active tab before language change
          const currentActiveTab = currentPreviewType
          console.log("Storing current active tab:", currentActiveTab)

          currentLanguage = newLang
          console.log("Language changed to:", currentLanguage)

          // Load translations if not already loaded
          if (!translations[newLang]) {
            console.log("Loading translations for new language:", newLang)
            await loadTranslations(newLang)
          }

          // Verify translations are loaded
          if (!translations[newLang]) {
            console.error("Failed to load translations for new language:", newLang)
            return
          }

          // Update document language
          document.documentElement.lang = newLang

          // Update active language flag
          const languageFlags = document.querySelectorAll(".language-flag")
          languageFlags.forEach(flag => {
            flag.classList.remove("active")
            if (flag.getAttribute("data-lang") === newLang) {
              flag.classList.add("active")
            }
          })

          // Reset showing original flag
          showingOriginal = false

          // Translate all elements
          console.log("Calling translatePage()")
          translatePage()

          // Translate all form field values
          console.log("Calling translateFormFields()")
          console.log("Current language in translateFormFields:", currentLanguage)
          console.log("Translations available in translateFormFields:", Object.keys(translations))
          console.log(
            "Current language translations in translateFormFields:",
            translations[currentLanguage]
          )
          await translateFormFields()

          // Re-add event listeners after translation
          console.log("Calling addFormEventListeners()")
          addFormEventListeners()

          // Save current state
          console.log("Calling saveFormData()")
          saveFormData()

          // Add delay to ensure translations are applied
          console.log("Waiting for translations to be applied...")
          await new Promise(resolve => setTimeout(resolve, 200))

          // Note: We don't automatically reload data from JSON file when changing language
          // because translateFormFields() already sets the correct values from translations
          // Users can manually click "Load Data" button if they want to load from JSON files
          console.log("Using translation values for language change - JSON data not auto-reloaded")

          // Перекласти введений користувачем текст на нову мову
          console.log("Translating user inputs to new language:", newLang)
          try {
            await translateAllUserInputs(newLang)
          } catch (error) {
            console.error("Error translating user inputs:", error)
          }

          // Update preview with current active tab
          console.log("Updating preview for current tab:", currentActiveTab)
          console.log("Current language before showPreview:", currentLanguage)
          console.log("Translations available:", Object.keys(translations))
          console.log("Current language translations:", translations[currentLanguage])
          await showPreview(currentActiveTab)
        }
      }

      // Translate form field values
      async function translateFormFields() {
        console.log("=== translateFormFields called ===")
        console.log("Current language:", currentLanguage)
        console.log("Available translations:", Object.keys(translations))
        console.log("Current language translations:", translations[currentLanguage])

        // Get all form fields that need translation
        const fieldsToTranslate = [
          {id: "fullName", key: "form.fullName"},
          {id: "address", key: "form.address"},
          {id: "phone", key: "form.phone"},
          {id: "email", key: "form.email"},
          {id: "birthDate", key: "form.birthDate"},
          {id: "nationality", key: "form.nationality"},
          {id: "position", key: "form.position"},
          {id: "company", key: "form.company"},
          {id: "jobNumber", key: "form.jobNumber"},
          {id: "contactName", key: "form.contactName"},
          {id: "contactAddress", key: "form.contactAddress"},
          {id: "contactPhone", key: "form.contactPhone"},
          {id: "contactEmail", key: "form.contactEmail"},
          {id: "subject", key: "form.subject"},
          {id: "greeting", key: "form.greetingPlaceholder"},
          {id: "motivation", key: "form.motivationPlaceholder"},
          {id: "qualifications", key: "form.qualificationsPlaceholder"},
          {id: "tasks", key: "form.tasksPlaceholder"},
          {id: "future", key: "form.futurePlaceholder"},
          {id: "availability", key: "form.availabilityPlaceholder"},
          {id: "closing", key: "form.closing"},
          {id: "signature", key: "form.signature"}
        ]

        // Translate main form fields
        fieldsToTranslate.forEach(field => {
          const element = document.getElementById(field.id)
          if (element) {
            const translatedValue = getTranslation(field.key)
            const translatedFieldValue = getTranslation(`fieldValues.${field.id}`)
            const translatedContentValue = getTranslation(`contentValues.${field.id}`)
            console.log(
              `Field ${field.id}: current value="${element.value}", placeholder="${element.placeholder}", translated="${translatedValue}", fieldValue="${translatedFieldValue}", contentValue="${translatedContentValue}"`
            )
            if (translatedValue && !showingOriginal) {
              console.log(`Translating ${field.id}:`, translatedValue)
              // Update placeholder
              element.placeholder = translatedValue
              console.log(`Set placeholder for ${field.id}: ${translatedValue}`)

              // Update field value - prioritize contentValues for textarea fields
              // Only set value if field is empty or if we're explicitly changing language
              const valueToUse = translatedContentValue || translatedFieldValue
              if (valueToUse && (!element.value || element.value.trim() === "")) {
                element.value = valueToUse
                console.log(`Set value for ${field.id}: ${valueToUse}`)
              } else if (valueToUse && element.value && element.value.trim() !== "") {
                console.log(
                  `Field ${field.id} already has value "${element.value}", not overwriting with "${valueToUse}"`
                )
              }
            }
          } else {
            console.log(`Element ${field.id} not found`)
          }
        })

        // Translate Lebenslauf section fields
        const lebenslaufSection = document.getElementById("lebenslaufSection")
        console.log("🔍 lebenslaufSection found:", lebenslaufSection)
        if (lebenslaufSection) {
          const lebenslaufFields = [
            {
              id: "lebenslaufFullName",
              key: "form.fullName",
              valueKey: "lebenslaufInputValues.fullName"
            },
            {
              id: "lebenslaufAddress",
              key: "form.address",
              valueKey: "lebenslaufInputValues.address"
            },
            {id: "lebenslaufPhone", key: "form.phone", valueKey: "lebenslaufInputValues.phone"},
            {id: "lebenslaufEmail", key: "form.email", valueKey: "lebenslaufInputValues.email"},
            {
              id: "lebenslaufBirthDate",
              key: "form.birthDate",
              valueKey: "lebenslaufInputValues.birthDate"
            },
            {
              id: "lebenslaufNationality",
              key: "form.nationality",
              valueKey: "lebenslaufInputValues.nationality"
            },
            {
              id: "lebenslaufSummary",
              key: "form.motivationPlaceholder",
              valueKey: "lebenslaufInputValues.summary"
            },
            {
              id: "lebenslaufSkills",
              key: "form.qualificationsPlaceholder",
              valueKey: "lebenslaufInputValues.skills"
            },
            {
              id: "lebenslaufExperience",
              key: "form.qualificationsPlaceholder",
              valueKey: "lebenslaufInputValues.experience"
            },
            {
              id: "lebenslaufEducation",
              key: "form.qualificationsPlaceholder",
              valueKey: "lebenslaufInputValues.education"
            },
            {
              id: "lebenslaufLanguages",
              key: "form.qualificationsPlaceholder",
              valueKey: "lebenslaufInputValues.languages"
            },
            {
              id: "lebenslaufAdditional",
              key: "form.qualificationsPlaceholder",
              valueKey: "lebenslaufInputValues.additional"
            }
          ]

          lebenslaufFields.forEach(field => {
            const element = document.getElementById(field.id)
            console.log(`🔍 Field ${field.id} found:`, element)
            if (element) {
              const translatedValue = getTranslation(field.key)
              const translatedFieldValue = getTranslation(field.valueKey)

              // Get field name without "lebenslauf" prefix
              const fieldName = field.id.replace("lebenslauf", "")
              const camelCaseFieldName = fieldName.charAt(0).toLowerCase() + fieldName.slice(1)

              const translatedContentValue = getTranslation(`contentValues.${camelCaseFieldName}`)
              const translatedLebenslaufValue = getTranslation(
                `lebenslaufValues.${camelCaseFieldName}`
              )
              const translatedLebenslaufInputValue = getTranslation(
                `lebenslaufInputValues.${camelCaseFieldName}`
              )

              console.log(`=== Field ${field.id} ===`)
              console.log(`Current value: "${element.value}"`)
              console.log(`Placeholder: "${element.placeholder}"`)
              console.log(`translatedValue (placeholder): "${translatedValue}"`)
              console.log(`translatedFieldValue (new valueKey): "${translatedFieldValue}"`)
              console.log(`translatedContentValue: "${translatedContentValue}"`)
              console.log(`translatedLebenslaufValue: "${translatedLebenslaufValue}"`)
              console.log(`translatedLebenslaufInputValue: "${translatedLebenslaufInputValue}"`)

              // Special logging for lebenslaufFullName
              if (field.id === "lebenslaufFullName") {
                console.log("🔍 Special logging for lebenslaufFullName:")
                console.log("Field key:", field.key)
                console.log("Looking for lebenslaufInputValues.fullName")
                console.log(
                  "Available lebenslaufInputValues:",
                  translations[currentLanguage]?.lebenslaufInputValues
                )
                console.log(
                  "lebenslaufInputValues.fullName:",
                  translations[currentLanguage]?.lebenslaufInputValues?.fullName
                )
              }

              if (translatedValue && !showingOriginal) {
                console.log(`Translating Lebenslauf ${field.id}:`, translatedValue)
                // Update placeholder
                element.placeholder = translatedValue

                // Update field value - prioritize new valueKey for Lebenslauf fields
                const valueToUse =
                  translatedFieldValue ||
                  translatedLebenslaufInputValue ||
                  translatedLebenslaufValue ||
                  translatedContentValue

                console.log(`=== Value Selection for ${field.id} ===`)
                console.log(`translatedFieldValue (priority): "${translatedFieldValue}"`)
                console.log(`translatedLebenslaufInputValue: "${translatedLebenslaufInputValue}"`)
                console.log(`translatedLebenslaufValue: "${translatedLebenslaufValue}"`)
                console.log(`translatedContentValue: "${translatedContentValue}"`)
                console.log(`Selected valueToUse: "${valueToUse}"`)

                if (valueToUse) {
                  // Only set value if field is empty or if we're explicitly changing language
                  if (!element.value || element.value.trim() === "") {
                    element.value = valueToUse
                    console.log(`✅ Set value for Lebenslauf ${field.id}: ${valueToUse}`)
                  } else {
                    console.log(
                      `Field ${field.id} already has value "${element.value}", not overwriting with "${valueToUse}"`
                    )
                  }

                  // Add event to track if value gets changed later
                  const originalValue = valueToUse
                  const observer = new MutationObserver(mutations => {
                    mutations.forEach(mutation => {
                      if (mutation.type === "attributes" && mutation.attributeName === "value") {
                        console.log(
                          `⚠️ Value changed for ${field.id}: "${originalValue}" -> "${element.value}"`
                        )
                      }
                    })
                  })
                  observer.observe(element, {attributes: true, attributeFilter: ["value"]})

                  // Also listen for input events
                  element.addEventListener("input", () => {
                    console.log(
                      `⚠️ Input event for ${field.id}: "${originalValue}" -> "${element.value}"`
                    )
                  })
                } else {
                  console.log(`❌ No translation found for Lebenslauf ${field.id}`)
                }
              }
            }
          })
        }

        // Add delay to ensure all translations are applied
        console.log("Waiting for all translations to be applied...")
        await new Promise(resolve => setTimeout(resolve, 100))

        console.log("=== translateFormFields completed ===")
      }

      // Translate page
      function translatePage() {
        const elements = document.querySelectorAll("[data-translate]")
        elements.forEach(element => {
          const key = element.getAttribute("data-translate")
          const translation = getTranslation(key)
          if (translation) {
            if (element.tagName === "INPUT" && element.type === "submit") {
              element.value = translation
            } else if (element.tagName === "INPUT" && element.placeholder) {
              element.placeholder = translation
            } else {
              element.textContent = translation
            }
          }
        })
      }

      // Initialize theme
      async function initializeTheme() {
        // Use localStorage for theme management (no backend needed for GitHub Pages)
        const savedTheme = localStorage.getItem("theme") || "light"
        document.documentElement.setAttribute("data-theme", savedTheme)
        updateThemeVariables(savedTheme)

        // Update theme toggle icon
        const themeIcon = document.querySelector(".theme-icon")
        if (themeIcon) {
          themeIcon.textContent = savedTheme === "dark" ? "☀️" : "🌙"
        }

        // Add click event listener to theme toggle
        const themeToggle = document.getElementById("themeToggle")
        if (themeToggle) {
          themeToggle.addEventListener("click", toggleTheme)
        }
      }

      // Toggle theme
      function toggleTheme() {
        try {
          console.log("Toggling theme...")
          const currentTheme = document.documentElement.getAttribute("data-theme")
          const newTheme = currentTheme === "dark" ? "light" : "dark"

          console.log("Current theme:", currentTheme)
          console.log("New theme:", newTheme)

          // Update theme immediately
          document.documentElement.setAttribute("data-theme", newTheme)
          localStorage.setItem("theme", newTheme)

          // Update icon
          const themeIcon = document.querySelector(".theme-icon")
          if (themeIcon) {
            themeIcon.textContent = newTheme === "dark" ? "☀️" : "🌙"
            console.log("Updated icon to:", themeIcon.textContent)
          }

          // Update theme variables
          updateThemeVariables(newTheme)

          // Add transition class for smooth theme change
          document.body.classList.add("theme-transitioning")
          setTimeout(() => {
            document.body.classList.remove("theme-transitioning")
          }, 300)

          // Save current state
          saveFormData()

          // Theme is automatically saved to localStorage (no backend needed for GitHub Pages)
          console.log("Theme saved to localStorage:", newTheme)
        } catch (error) {
          console.error("Error toggling theme:", error)
        }
      }

      // Translate form content
      async function translateFormContent() {
        const contentElements = document.querySelectorAll("[data-translate-content]")
        contentElements.forEach(element => {
          const key = element.getAttribute("data-translate-content")
          const translation = getTranslation(key)
          if (translation) {
            // Store original content if not already stored
            if (!originalContent[element.id]) {
              originalContent[element.id] = element.value
            }
            element.value = translation
          }
        })

        // Update greeting field with translation
        const greetingField = document.getElementById("greeting")
        if (greetingField) {
          const translatedGreeting = getTranslation("form.greetingPlaceholder")
          if (translatedGreeting) {
            greetingField.value = translatedGreeting
          }
        }

        // Update preview after translation
        await updatePreview()

        // Force update preview with new language
        setTimeout(async () => {
          const activeTab = document.querySelector(".preview-tab.active")
          if (activeTab) {
            if (
              activeTab.textContent.includes("Anschreiben") ||
              activeTab.textContent.includes("Cover Letter") ||
              activeTab.textContent.includes("Лист заявки")
            ) {
              await showPreview("bewerbung")
            } else if (
              activeTab.textContent.includes("Lebenslauf") ||
              activeTab.textContent.includes("Resume") ||
              activeTab.textContent.includes("Резюме")
            ) {
              await showPreview("lebenslauf")
            }
          }
        }, 100)
      }

      // Restore original content
      async function restoreOriginalContent() {
        const contentElements = document.querySelectorAll("[data-translate-content]")
        contentElements.forEach(element => {
          if (originalContent[element.id]) {
            element.value = originalContent[element.id]
          }
        })

        // Update preview after restoring original content
        await updatePreview()
      }

      // Toggle between translated and original content
      let showingOriginal = false
      async function toggleTranslation() {
        const toggleBtn = document.getElementById("toggleTranslationBtn")

        if (showingOriginal) {
          // Show translated content
          await translateFormContent()
          toggleBtn.textContent =
            getTranslation("buttons.toggleTranslation") || "🔄 Original anzeigen"
          showingOriginal = false
        } else {
          // Show original content
          await restoreOriginalContent()
          toggleBtn.textContent = "🔄 Übersetzung anzeigen"
          showingOriginal = true
        }
      }

      // Get translation by key
      function getTranslation(key) {
        console.log("getTranslation called with key:", key, "currentLanguage:", currentLanguage)
        const keys = key.split(".")
        let translation = translations[currentLanguage]
        console.log("translations[currentLanguage]:", translation)

        // Special logging for lebenslaufInputValues
        if (key.includes("lebenslaufInputValues")) {
          console.log("🔍 Looking for lebenslaufInputValues key:", key)
          console.log(
            "Available lebenslaufInputValues:",
            translations[currentLanguage]?.lebenslaufInputValues
          )
        }

        if (!translation) {
          console.error("No translations loaded for language:", currentLanguage)
          return null
        }

        for (const k of keys) {
          if (translation && translation[k]) {
            translation = translation[k]
          } else {
            console.log("Translation not found for key:", key, "at level:", k)
            console.log(
              "Available keys at this level:",
              translation ? Object.keys(translation) : "translation is null"
            )
            return null
          }
        }

        console.log("Final translation for", key, ":", translation)
        return translation
      }

      // Initialize mobile menu
      function initializeMobileMenu() {
        const mobileMenuBtn = document.getElementById("mobileMenuBtn")
        const mobileMenuOverlay = document.getElementById("mobileMenuOverlay")
        const mobileMenuPanel = document.getElementById("mobileMenuPanel")
        const mobileThemeToggle = document.getElementById("mobileThemeToggle")

        if (!mobileMenuBtn || !mobileMenuOverlay || !mobileMenuPanel) {
          console.warn("Mobile menu elements not found")
          return
        }

        // Toggle mobile menu
        function toggleMobileMenu() {
          const isOpen = mobileMenuPanel.classList.contains("active")

          if (isOpen) {
            closeMobileMenu()
          } else {
            openMobileMenu()
          }
        }

        function openMobileMenu() {
          mobileMenuOverlay.style.display = "block"
          mobileMenuPanel.classList.add("active")
          mobileMenuBtn.classList.add("active")
          mobileMenuBtn.innerHTML = "✕"
          document.body.style.overflow = "hidden"

          // Add animation
          setTimeout(() => {
            mobileMenuOverlay.classList.add("active")
          }, 10)
        }

        function closeMobileMenu() {
          mobileMenuOverlay.classList.remove("active")
          mobileMenuPanel.classList.remove("active")
          mobileMenuBtn.classList.remove("active")
          mobileMenuBtn.innerHTML = "☰"
          document.body.style.overflow = ""

          setTimeout(() => {
            mobileMenuOverlay.style.display = "none"
          }, 300)
        }

        // Event listeners
        mobileMenuBtn.addEventListener("click", toggleMobileMenu)
        mobileMenuOverlay.addEventListener("click", closeMobileMenu)

        // Close menu when clicking on mobile theme toggle
        if (mobileThemeToggle) {
          mobileThemeToggle.addEventListener("click", () => {
            toggleTheme()
            closeMobileMenu()
          })
        }

        // Close menu when clicking on language flags in mobile menu
        const mobileLanguageFlags = mobileMenuPanel.querySelectorAll(".language-flag")
        mobileLanguageFlags.forEach(flag => {
          flag.addEventListener("click", () => {
            closeMobileMenu()
          })
        })

        // Close menu when clicking on form tab buttons in mobile menu
        const mobileFormTabs = mobileMenuPanel.querySelectorAll(".form-tab-button")
        mobileFormTabs.forEach(tab => {
          tab.addEventListener("click", () => {
            closeMobileMenu()
          })
        })

        // Close menu when clicking on action buttons in mobile menu
        const mobileActionButtons = mobileMenuPanel.querySelectorAll(".btn-success, .btn-secondary")
        mobileActionButtons.forEach(btn => {
          if (btn.onclick) {
            const originalOnclick = btn.onclick
            btn.onclick = function () {
              originalOnclick.call(this)
              closeMobileMenu()
            }
          }
        })

        // Close menu on escape key
        document.addEventListener("keydown", e => {
          if (e.key === "Escape" && mobileMenuPanel.classList.contains("active")) {
            closeMobileMenu()
          }
        })

        // Handle window resize
        window.addEventListener("resize", () => {
          if (window.innerWidth > 480 && mobileMenuPanel.classList.contains("active")) {
            closeMobileMenu()
          }
        })
      }

      // ===== АВТОМАТИЧНИЙ ПЕРЕКЛАД ТЕКСТУ =====

      // Кеш для перекладів щоб уникнути повторних запитів
      const translationCache = new Map()

      // Функція для автоматичного перекладу тексту
      async function translateText(text, targetLang, sourceLang = 'auto') {
        if (!text || text.trim() === '') return text

        // Створюємо ключ для кешу
        const cacheKey = `${sourceLang}-${targetLang}-${text}`
        if (translationCache.has(cacheKey)) {
          return translationCache.get(cacheKey)
        }

        try {
          // Використовуємо MyMemory API з додатковими параметрами та обробкою помилок
          const encodedText = encodeURIComponent(text.substring(0, 500)) // Обмежити довжину тексту
          const url = `https://api.mymemory.translated.net/get?q=${encodedText}&langpair=${sourceLang}|${targetLang}&de=example@email.com`

          const response = await fetch(url, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'User-Agent': 'ResumeGenerator/1.0'
            }
          })

          if (!response.ok) {
            console.warn(`Translation API returned status ${response.status}`)
            return text
          }

          const data = await response.json()

          if (data.responseStatus === 200 && data.responseData && data.responseData.translatedText) {
            let translatedText = data.responseData.translatedText

            // Очистити результат від можливих артефактів
            translatedText = translatedText.trim()

            // Перевірити, чи переклад не є тим самим текстом
            if (translatedText.toLowerCase() !== text.toLowerCase()) {
              translationCache.set(cacheKey, translatedText)
              return translatedText
            } else {
              console.info('Translation returned same text, using original')
              return text
            }
          } else {
            console.warn('Translation failed with response:', data)
            return text
          }
        } catch (error) {
          console.error('Translation error:', error)
          // Спробувати альтернативний сервіс як fallback
          return await translateTextFallback(text, targetLang, sourceLang)
        }
      }

      // Резервна функція перекладу через LibreTranslate (якщо доступний)
      async function translateTextFallback(text, targetLang, sourceLang = 'auto') {
        try {
          console.log('Trying fallback translation method')

          // Простий словник для основних фраз
          const basicDictionary = {
            'de': {
              'Name': 'Name',
              'Address': 'Adresse',
              'Phone': 'Telefon',
              'Email': 'E-Mail',
              'Experience': 'Berufserfahrung',
              'Education': 'Ausbildung',
              'Skills': 'Fähigkeiten'
            },
            'en': {
              'Name': 'Name',
              'Adresse': 'Address',
              'Telefon': 'Phone',
              'E-Mail': 'Email',
              'Berufserfahrung': 'Experience',
              'Ausbildung': 'Education',
              'Fähigkeiten': 'Skills'
            },
            'uk': {
              'Name': "Ім'я",
              'Address': 'Адреса',
              'Phone': 'Телефон',
              'Email': 'Пошта',
              'Experience': 'Досвід',
              'Education': 'Освіта',
              'Skills': 'Навички'
            }
          }

          if (basicDictionary[targetLang] && basicDictionary[targetLang][text]) {
            return basicDictionary[targetLang][text]
          }

          return text // Повернути оригінальний текст якщо переклад недоступний
        } catch (error) {
          console.error('Fallback translation failed:', error)
          return text
        }
      }

      // Функція для перекладу вмісту поля вводу
      async function translateInputField(element, targetLang) {
        if (!element || !element.value) return

        const originalText = element.value.trim()
        if (originalText === '' || originalText.length < 2) return

        // Пропустити поля з датами, емейлами, телефонами
        if (element.type === 'email' || element.type === 'tel' || element.type === 'date') return
        if (originalText.includes('@') || originalText.match(/^\+?[\d\s\-\(\)]+$/)) return

        let isTranslating = false
        try {
          // Уникнути подвійного виконання
          if (element.dataset.translating === 'true') return
          element.dataset.translating = 'true'
          isTranslating = true

          // Показуємо індикатор завантаження
          const originalPlaceholder = element.placeholder || ''
          const originalTitle = element.title || ''
          element.style.opacity = '0.7'
          element.style.background = '#fff3cd'
          element.title = 'Переклад...'

          const translatedText = await translateText(originalText, targetLang)

          if (translatedText && translatedText !== originalText && translatedText.length > 1) {
            element.value = translatedText

            // Додати візуальну індикацію успішного перекладу
            element.style.background = '#d1f2eb'
            setTimeout(() => {
              element.style.background = ''
            }, 2000)

            // Тригеримо подію для оновлення превью
            element.dispatchEvent(new Event('input', { bubbles: true }))
            console.log(`Translated: "${originalText}" -> "${translatedText}"`)
          } else {
            // Індикація що переклад не потрібен
            element.style.background = '#f8f9fa'
            setTimeout(() => {
              element.style.background = ''
            }, 1000)
          }
        } catch (error) {
          console.error('Field translation error:', error)
          // Показати помилку
          element.style.background = '#f8d7da'
          setTimeout(() => {
            element.style.background = ''
          }, 2000)
        } finally {
          // Прибираємо індикатор завантаження
          element.style.opacity = '1'
          element.title = originalTitle
          element.dataset.translating = 'false'
        }
      }

      // Функція для перекладу всіх текстових полів форми
      async function translateAllUserInputs(targetLang) {
        console.log(`Translating all user inputs to: ${targetLang}`)

        // Знаходимо всі текстові поля та textarea, які користувач може заповнити
        const inputFields = document.querySelectorAll('input[type="text"], textarea')
        const fieldsToTranslate = []

        // Фільтруємо поля які потрібно перекласти
        inputFields.forEach(field => {
          if (field.readOnly || field.disabled) return
          if (!field.value || field.value.trim().length < 2) return
          // Пропускаємо поля з емейлами, телефонами тощо
          if (field.value.includes('@') || field.value.match(/^\+?[\d\s\-\(\)]+$/)) return
          fieldsToTranslate.push(field)
        })

        if (fieldsToTranslate.length === 0) {
          console.log('No fields to translate')
          return
        }

        console.log(`Found ${fieldsToTranslate.length} fields to translate`)

        // Перекладаємо поля з обмеженою паралельністю
        const batchSize = 3 // Максимум 3 поля одночасно
        for (let i = 0; i < fieldsToTranslate.length; i += batchSize) {
          const batch = fieldsToTranslate.slice(i, i + batchSize)

          // Перекласти batch паралельно
          await Promise.all(batch.map(field => translateInputField(field, targetLang)))

          // Невелика затримка між батчами
          if (i + batchSize < fieldsToTranslate.length) {
            await new Promise(resolve => setTimeout(resolve, 500))
          }
        }

        console.log('All user inputs translated')

        // Показати повідомлення користувачу
        const statusMessage = document.createElement('div')
        statusMessage.className = 'status-message status-success'
        statusMessage.textContent = `Переклад завершено: ${fieldsToTranslate.length} полів`
        statusMessage.style.position = 'fixed'
        statusMessage.style.top = '20px'
        statusMessage.style.right = '20px'
        statusMessage.style.zIndex = '10000'
        document.body.appendChild(statusMessage)

        setTimeout(() => {
          statusMessage.remove()
        }, 3000)
      }

      // ===== СИСТЕМА СТИЛІВ РЕЗЮМЕ =====

      let currentResumeStyle = 'modern-professional'
      let currentLayout = 'single-column'

      // Функція для зміни стилю резюме
      function applyResumeStyle(style, layout) {
        console.log(`Applying resume style: ${style}, layout: ${layout}`)

        // Отримати контейнер превью
        const previewSection = document.querySelector('.preview-section')
        if (!previewSection) return

        // Видалити всі попередні класи стилів
        const styleClasses = [
          'resume-style-modern-professional',
          'resume-style-minimalist',
          'resume-style-creative-blue',
          'resume-style-elegant-serif',
          'resume-style-tech-modern',
          'resume-style-classic-formal',
          'resume-style-artistic-gradient',
          'resume-style-corporate-clean',
          'resume-style-startup-bold',
          'resume-style-academic-traditional'
        ]

        const layoutClasses = [
          'layout-single-column',
          'layout-two-column'
        ]

        // Видалити старі класи
        previewSection.classList.remove(...styleClasses, ...layoutClasses)

        // Додати новий стиль і layout
        previewSection.classList.add(`resume-style-${style}`)
        previewSection.classList.add(`layout-${layout}`)

        // Зберегти поточний стиль
        currentResumeStyle = style
        currentLayout = layout

        // Оновити превью
        updatePreviewOnInput()
      }

      // Функція для оновлення генерації HTML з новим стилем
      function generateStyledLebenslaufHTML(data) {
        // Базова HTML структура
        let htmlContent = generateLebenslaufHTML(data)

        // Додати класи стилю до HTML
        const styleClasses = `resume-style-${currentResumeStyle} layout-${currentLayout}`

        // Замінити body class
        htmlContent = htmlContent.replace('<body>', `<body class="${styleClasses}">`)

        // Додати стилі CSS в head
        const additionalCSS = `
          <style>
            /* Вставити CSS стилі для вибраного стилю */
            ${getResumeStyleCSS(currentResumeStyle, currentLayout)}
          </style>
        `

        // Вставити додаткові стилі перед закриттям head
        htmlContent = htmlContent.replace('</head>', additionalCSS + '</head>')

        return htmlContent
      }

      // Функція для отримання CSS стилів
      function getResumeStyleCSS(style, layout) {
        // Тут повернемо CSS для конкретного стилю
        // (Це спрощена версія, в реальності краще зберігати CSS у окремих файлах)
        return `
          .${style} { /* CSS стилі для ${style} */ }
          .${layout} { /* CSS стилі для ${layout} */ }
        `
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", async function () {
        console.log("=== DOMContentLoaded event triggered ===")
        console.log("Current timestamp:", new Date().toISOString())
        console.log("Document ready state:", document.readyState)

        // Load default language translations
        await loadTranslations("de")

        // Translate form fields after loading translations
        await translateFormFields()

        // Initialize theme
        await initializeTheme()

        // Initialize mobile menu
        initializeMobileMenu()

        // Try to load saved data first
        const dataLoaded = loadFormData()

        // Initialize form tabs
        console.log("Initializing form tabs with currentPreviewType:", currentPreviewType)
        switchFormTab(currentPreviewType)

        // Load data for Lebenslauf if it's the initial tab
        // Data loading is now handled by the save/load buttons in the form

        // Ensure the correct tab is active
        setTimeout(() => {
          const activeTab = document.querySelector(".form-tab-button.active")
          console.log(
            "Active tab after initialization:",
            activeTab ? activeTab.textContent : "none"
          )
        }, 100)

        // Add click handlers for form tabs
        const formTabButtons = document.querySelectorAll(".form-tab-button")
        formTabButtons.forEach(button => {
          button.addEventListener("click", function () {
            const tabName = this.getAttribute("onclick").match(/switchFormTab\('(\w+)'\)/)[1]
            switchFormTab(tabName)
          })
        })

        // Initialize form and add event listeners
        initializeForm()

        // Initialize photo upload functionality
        console.log("=== About to initialize photo upload functions ===")
        console.log("Current timestamp:", new Date().toISOString())

        // Check if elements exist before initializing
        const lebenslaufPhotoInput = document.getElementById("lebenslaufPhoto")
        const lebenslaufPhotoPreview = document.getElementById("photoPreview")
        const anschreibenPhotoInput = document.getElementById("anschreibenPhoto")
        const anschreibenPhotoPreview = document.getElementById("anschreibenPhotoPreview")

        console.log("Lebenslauf photo input exists:", !!lebenslaufPhotoInput)
        console.log("Lebenslauf photo preview exists:", !!lebenslaufPhotoPreview)
        console.log("Anschreiben photo input exists:", !!anschreibenPhotoInput)
        console.log("Anschreiben photo preview exists:", !!anschreibenPhotoPreview)

        initializePhotoUpload()

        // Initialize Anschreiben photo upload functionality
        console.log("=== About to initialize Anschreiben photo upload function ===")
        initializeAnschreibenPhotoUpload()

        // Add click handlers for language flags
        const languageFlags = document.querySelectorAll(".language-flag")
        languageFlags.forEach(flag => {
          flag.addEventListener("click", function () {
            const lang = this.getAttribute("data-lang")

            // Update active flag
            languageFlags.forEach(f => f.classList.remove("active"))
            this.classList.add("active")

            // Change language
            changeLanguage(lang)
          })
        })

        // Add click handler for translate button
        const translateButton = document.getElementById("translateButton")
        if (translateButton) {
          translateButton.addEventListener("click", async function () {
            console.log("Manual translation button clicked")

            // Показати індикацію завантаження
            const originalIcon = this.innerHTML
            this.innerHTML = '<span class="translate-icon">⏳</span>'
            this.disabled = true

            try {
              // Отримати поточну мову інтерфейсу
              const currentLang = currentLanguage || 'de'
              await translateAllUserInputs(currentLang)

              // Показати успішне завершення
              this.innerHTML = '<span class="translate-icon">✅</span>'
              setTimeout(() => {
                this.innerHTML = originalIcon
              }, 2000)
            } catch (error) {
              console.error("Manual translation failed:", error)
              // Показати помилку
              this.innerHTML = '<span class="translate-icon">❌</span>'
              setTimeout(() => {
                this.innerHTML = originalIcon
              }, 2000)
            } finally {
              this.disabled = false
            }
          })
        }

        // Add event handlers for resume style selector
        const styleDropdown = document.getElementById("resumeStyle")
        const layoutRadios = document.querySelectorAll('input[name="layout"]')

        if (styleDropdown) {
          styleDropdown.addEventListener("change", function() {
            const selectedStyle = this.value
            const selectedLayout = document.querySelector('input[name="layout"]:checked')?.value || 'single-column'
            applyResumeStyle(selectedStyle, selectedLayout)
            console.log(`Style changed to: ${selectedStyle}`)
          })
        }

        layoutRadios.forEach(radio => {
          radio.addEventListener("change", function() {
            if (this.checked) {
              const selectedLayout = this.value
              const selectedStyle = styleDropdown?.value || 'modern-professional'
              applyResumeStyle(selectedStyle, selectedLayout)
              console.log(`Layout changed to: ${selectedLayout}`)
            }
          })
        })

        // Initialize with default style
        applyResumeStyle(currentResumeStyle, currentLayout)

        // Show initial preview
        updatePreviewOnInput()

        // Initialize form with default values and event listeners
        initializeForm()

        // Event listeners are now handled by addFormEventListeners()
        // No need for duplicate listeners here

        // Auto-generate preview on page load with saved or default values
        setTimeout(async () => {
          await showPreview(currentPreviewType)
        }, 500)
      })

      // Debug functions for testing (available in browser console)
      window.debugGetTranslation = getTranslation
      window.debugShowStatus = showStatus
      window.debugPopulateForm = populateFormWithLebenslaufData

      console.log("Debug functions available:")
      console.log("- debugGetTranslation('key') - Test translation")
      console.log("- debugShowStatus('message', 'type') - Test status display")
      console.log("- debugPopulateForm(data) - Test form population")
    </script>
  </body>
</html>
